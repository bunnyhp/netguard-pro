{% extends "base.html" %}

{% block title %}{{ table_name }} - NetGuard Pro{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">üîí {{ table_name }}</h4>
            </div>
            <div class="card-body">
                <a href="/suricata/{{ category }}" class="btn btn-secondary mb-3">‚Üê Back to {{ category|capitalize }}</a>
                <p><strong>Events:</strong> {{ data|length }}</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                {% if data %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover table-sm" id="dataTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Timestamp</th>
                                
                                {% if category == 'alerts' %}
                                <th>Source IP</th>
                                <th>Src Port</th>
                                <th>Dest IP</th>
                                <th>Dst Port</th>
                                <th>Proto</th>
                                <th>Signature</th>
                                <th>Category</th>
                                <th>Severity</th>
                                <th>Action</th>
                                
                                {% elif category == 'http' %}
                                <th>Source IP</th>
                                <th>Dest IP</th>
                                <th>Method</th>
                                <th>Host</th>
                                <th>URL</th>
                                <th>Status</th>
                                <th>User Agent</th>
                                <th>Content Type</th>
                                <th>Length</th>
                                
                                {% elif category == 'dns' %}
                                <th>Source IP</th>
                                <th>Dest IP</th>
                                <th>Type</th>
                                <th>Query Name</th>
                                <th>Record Type</th>
                                <th>Response Code</th>
                                <th>Response Data</th>
                                <th>TTL</th>
                                
                                {% elif category == 'tls' %}
                                <th>Source IP</th>
                                <th>Src Port</th>
                                <th>Dest IP</th>
                                <th>Dst Port</th>
                                <th>SNI</th>
                                <th>Subject</th>
                                <th>Issuer</th>
                                <th>Version</th>
                                <th>Valid From</th>
                                <th>Valid To</th>
                                
                                {% elif category == 'files' %}
                                <th>Source IP</th>
                                <th>Dest IP</th>
                                <th>Filename</th>
                                <th>File Type</th>
                                <th>State</th>
                                <th>Size</th>
                                <th>Stored</th>
                                
                                {% elif category == 'flow' %}
                                <th>Source IP</th>
                                <th>Src Port</th>
                                <th>Dest IP</th>
                                <th>Dst Port</th>
                                <th>Proto</th>
                                <th>Pkts ‚Üí</th>
                                <th>Pkts ‚Üê</th>
                                <th>Bytes ‚Üí</th>
                                <th>Bytes ‚Üê</th>
                                <th>Duration</th>
                                <th>State</th>
                                
                                {% elif category == 'ssh' %}
                                <th>Source IP</th>
                                <th>Src Port</th>
                                <th>Dest IP</th>
                                <th>Dst Port</th>
                                <th>Client Software</th>
                                <th>Server Software</th>
                                <th>Client Protocol</th>
                                <th>Server Protocol</th>
                                
                                {% elif category == 'smtp' %}
                                <th>Source IP</th>
                                <th>Dest IP</th>
                                <th>HELO</th>
                                <th>Mail From</th>
                                <th>Rcpt To</th>
                                
                                {% elif category == 'ftp' %}
                                <th>Source IP</th>
                                <th>Dest IP</th>
                                <th>Command</th>
                                <th>Command Data</th>
                                <th>Reply</th>
                                <th>Completion Code</th>
                                
                                {% elif category == 'anomaly' %}
                                <th>Source IP</th>
                                <th>Dest IP</th>
                                <th>Type</th>
                                <th>Event</th>
                                <th>Code</th>
                                
                                {% elif category == 'stats' %}
                                <th>Uptime</th>
                                <th>Packets</th>
                                <th>Bytes</th>
                                <th>Dropped</th>
                                <th>Invalid</th>
                                <th>IPv4</th>
                                <th>IPv6</th>
                                <th>TCP</th>
                                <th>UDP</th>
                                {% endif %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in data %}
                            <tr>
                                <td>{{ row.id }}</td>
                                <td><small>{{ row.timestamp }}</small></td>
                                
                                {% if category == 'alerts' %}
                                <td><code>{{ row.src_ip }}</code></td>
                                <td>{{ row.src_port }}</td>
                                <td><code>{{ row.dest_ip }}</code></td>
                                <td>{{ row.dest_port }}</td>
                                <td><span class="badge bg-secondary">{{ row.proto }}</span></td>
                                <td><small>{{ row.alert_signature }}</small></td>
                                <td><span class="badge bg-info">{{ row.alert_category }}</span></td>
                                <td>
                                    {% if row.alert_severity == 1 %}
                                    <span class="badge bg-danger">High</span>
                                    {% elif row.alert_severity == 2 %}
                                    <span class="badge bg-warning">Medium</span>
                                    {% else %}
                                    <span class="badge bg-info">Low</span>
                                    {% endif %}
                                </td>
                                <td><span class="badge bg-success">{{ row.alert_action }}</span></td>
                                
                                {% elif category == 'http' %}
                                <td><code>{{ row.src_ip }}</code></td>
                                <td><code>{{ row.dest_ip }}</code></td>
                                <td><span class="badge bg-primary">{{ row.http_method }}</span></td>
                                <td><strong>{{ row.http_hostname }}</strong></td>
                                <td><small>{{ row.http_url }}</small></td>
                                <td>
                                    {% if row.http_status and row.http_status >= 200 and row.http_status < 300 %}
                                    <span class="badge bg-success">{{ row.http_status }}</span>
                                    {% elif row.http_status and row.http_status >= 400 %}
                                    <span class="badge bg-danger">{{ row.http_status }}</span>
                                    {% else %}
                                    <span class="badge bg-secondary">{{ row.http_status }}</span>
                                    {% endif %}
                                </td>
                                <td><small>{{ row.http_user_agent|truncate(40) }}</small></td>
                                <td><small>{{ row.http_content_type }}</small></td>
                                <td>{{ row.http_length }}</td>
                                
                                {% elif category == 'dns' %}
                                <td><code>{{ row.src_ip }}</code></td>
                                <td><code>{{ row.dest_ip }}</code></td>
                                <td><span class="badge bg-info">{{ row.dns_type }}</span></td>
                                <td><strong>{{ row.dns_rrname }}</strong></td>
                                <td><span class="badge bg-secondary">{{ row.dns_rrtype }}</span></td>
                                <td>{{ row.dns_rcode }}</td>
                                <td><code>{{ row.dns_rdata|truncate(40) }}</code></td>
                                <td>{{ row.dns_ttl }}</td>
                                
                                {% elif category == 'tls' %}
                                <td><code>{{ row.src_ip }}</code></td>
                                <td>{{ row.src_port }}</td>
                                <td><code>{{ row.dest_ip }}</code></td>
                                <td>{{ row.dest_port }}</td>
                                <td><strong>{{ row.tls_sni }}</strong></td>
                                <td><small>{{ row.tls_subject|truncate(30) }}</small></td>
                                <td><small>{{ row.tls_issuerdn|truncate(30) }}</small></td>
                                <td><span class="badge bg-info">{{ row.tls_version }}</span></td>
                                <td><small>{{ row.tls_notbefore }}</small></td>
                                <td><small>{{ row.tls_notafter }}</small></td>
                                
                                {% elif category == 'files' %}
                                <td><code>{{ row.src_ip }}</code></td>
                                <td><code>{{ row.dest_ip }}</code></td>
                                <td><strong>{{ row.file_filename }}</strong></td>
                                <td><small>{{ row.file_magic|truncate(25) }}</small></td>
                                <td><span class="badge bg-info">{{ row.file_state }}</span></td>
                                <td>{{ row.file_size|filesizeformat if row.file_size else '-' }}</td>
                                <td>{{ '‚úì' if row.file_stored else '‚úó' }}</td>
                                
                                {% elif category == 'flow' %}
                                <td><code>{{ row.src_ip }}</code></td>
                                <td>{{ row.src_port }}</td>
                                <td><code>{{ row.dest_ip }}</code></td>
                                <td>{{ row.dest_port }}</td>
                                <td><span class="badge bg-secondary">{{ row.proto }}</span></td>
                                <td>{{ row.flow_pkts_toserver }}</td>
                                <td>{{ row.flow_pkts_toclient }}</td>
                                <td>{{ row.flow_bytes_toserver|filesizeformat if row.flow_bytes_toserver else '-' }}</td>
                                <td>{{ row.flow_bytes_toclient|filesizeformat if row.flow_bytes_toclient else '-' }}</td>
                                <td>{{ row.flow_age }}s</td>
                                <td><span class="badge bg-info">{{ row.flow_state }}</span></td>
                                
                                {% elif category == 'ssh' %}
                                <td><code>{{ row.src_ip }}</code></td>
                                <td>{{ row.src_port }}</td>
                                <td><code>{{ row.dest_ip }}</code></td>
                                <td>{{ row.dest_port }}</td>
                                <td><small>{{ row.ssh_client_software }}</small></td>
                                <td><small>{{ row.ssh_server_software }}</small></td>
                                <td>{{ row.ssh_client_proto }}</td>
                                <td>{{ row.ssh_server_proto }}</td>
                                
                                {% elif category == 'smtp' %}
                                <td><code>{{ row.src_ip }}</code></td>
                                <td><code>{{ row.dest_ip }}</code></td>
                                <td>{{ row.smtp_helo }}</td>
                                <td>{{ row.smtp_mail_from }}</td>
                                <td>{{ row.smtp_rcpt_to }}</td>
                                
                                {% elif category == 'ftp' %}
                                <td><code>{{ row.src_ip }}</code></td>
                                <td><code>{{ row.dest_ip }}</code></td>
                                <td><span class="badge bg-primary">{{ row.ftp_command }}</span></td>
                                <td>{{ row.ftp_command_data }}</td>
                                <td><small>{{ row.ftp_reply }}</small></td>
                                <td>{{ row.ftp_completion_code }}</td>
                                
                                {% elif category == 'anomaly' %}
                                <td><code>{{ row.src_ip }}</code></td>
                                <td><code>{{ row.dest_ip }}</code></td>
                                <td><span class="badge bg-warning">{{ row.anomaly_type }}</span></td>
                                <td>{{ row.anomaly_event }}</td>
                                <td>{{ row.anomaly_code }}</td>
                                
                                {% elif category == 'stats' %}
                                <td>{{ row.uptime }}s</td>
                                <td>{{ row.packets|default(0) }}</td>
                                <td>{{ row.bytes|filesizeformat if row.bytes else '-' }}</td>
                                <td>{{ row.packets_dropped|default(0) }}</td>
                                <td>{{ row.invalid|default(0) }}</td>
                                <td>{{ row.decoder_ipv4|default(0) }}</td>
                                <td>{{ row.decoder_ipv6|default(0) }}</td>
                                <td>{{ row.decoder_tcp|default(0) }}</td>
                                <td>{{ row.decoder_udp|default(0) }}</td>
                                {% endif %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-info">
                    No events available in this table.
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    $('#dataTable').DataTable({
        "order": [[0, "desc"]],
        "pageLength": 50,
        "lengthMenu": [[25, 50, 100, 500, -1], [25, 50, 100, 500, "All"]],
        "scrollX": true,
        "columnDefs": [
            { "width": "50px", "targets": 0 },
            { "width": "150px", "targets": 1 }
        ]
    });
});
</script>

<style>
.ip-address {
    font-family: 'Courier New', monospace;
    font-size: 0.9em;
}
.table-sm td {
    padding: 0.3rem;
    vertical-align: middle;
}
.badge {
    font-size: 0.8em;
}
code {
    font-size: 0.85em;
}
</style>
{% endblock %}
