# ðŸ”‘ AI API Key Setup Guide

## Quick Setup

You need to add API keys for at least ONE of these services (all are FREE):

### ðŸ¥‡ **Option 1: Google Gemini** (RECOMMENDED - Primary)
- **Free Tier:** 15 requests/minute
- **Speed:** Fast (~2-3 seconds)
- **Accuracy:** Excellent

**Get Your Key:**
1. Go to: https://aistudio.google.com/app/apikey
2. Click "Create API Key"
3. Copy the key

**Add to NetGuard:**
```bash
sqlite3 /home/jarvis/NetGuard/network.db \
  "UPDATE ai_config SET value='YOUR_GEMINI_API_KEY' WHERE key='gemini_api_key';"
```

---

### ðŸ¥ˆ **Option 2: Groq** (RECOMMENDED - Fallback)
- **Free Tier:** 30 requests/minute
- **Speed:** VERY Fast (~500ms)
- **Models:** Llama 3.3 70B, Kimi K2

**Get Your Key:**
1. Go to: https://console.groq.com/keys
2. Sign up (free)
3. Create API key

**Add to NetGuard:**
```bash
sqlite3 /home/jarvis/NetGuard/network.db \
  "UPDATE ai_config SET value='YOUR_GROQ_API_KEY' WHERE key='groq_api_key';"
```

---

### ðŸ¥‰ **Option 3: OpenRouter** (Optional - More Models)
- **Free Tier:** Unlimited on free models
- **Speed:** Varies by model
- **Models:** DeepSeek R1, Qwen Coder 480B, DeepSeek V3.1, Llama 3.1 405B

**Get Your Key:**
1. Go to: https://openrouter.ai/keys
2. Sign up (free)
3. Create API key
4. Add credits (free models don't use credits)

**Add to NetGuard:**
```bash
sqlite3 /home/jarvis/NetGuard/network.db \
  "UPDATE ai_config SET value='YOUR_OPENROUTER_API_KEY' WHERE key='openrouter_api_key';"
```

---

## ðŸŽ¯ Recommended Setup (Best Reliability)

**Add ALL THREE for 99.9% uptime:**

```bash
# 1. Add Gemini (Primary)
sqlite3 /home/jarvis/NetGuard/network.db \
  "UPDATE ai_config SET value='YOUR_GEMINI_KEY_HERE' WHERE key='gemini_api_key';"

# 2. Add Groq (Fallback 1)
sqlite3 /home/jarvis/NetGuard/network.db \
  "UPDATE ai_config SET value='YOUR_GROQ_KEY_HERE' WHERE key='groq_api_key';"

# 3. Add OpenRouter (Fallback 2)
sqlite3 /home/jarvis/NetGuard/network.db \
  "UPDATE ai_config SET value='YOUR_OPENROUTER_KEY_HERE' WHERE key='openrouter_api_key';"

# 4. Enable AI analysis
sqlite3 /home/jarvis/NetGuard/network.db \
  "UPDATE ai_config SET value='1' WHERE key='ai_enabled';"
```

---

## ðŸš€ Test Your Setup

**Run manual analysis:**
```bash
cd /home/jarvis/NetGuard
python3 scripts/ai_service_connector.py
```

**Expected Output:**
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
NetGuard Pro - Multi-AI Analysis Cycle
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Step 1: Exporting network data...
âœ“ Exported 141 packets
Step 2: Analyzing with AI models...
ðŸ¤– Trying Gemini 2.0 Flash...
âœ… Success with Gemini 2.0 Flash!
Step 3: Storing AI predictions...
âœ“ Stored AI results from Gemini 2.0 Flash: 2 alerts, 1 threats
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… AI Analysis Complete!
   Model Used: Gemini 2.0 Flash
   Threat Level: LOW
   Health Score: 85/100
   Threats: 1
   Alerts: 2
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ðŸ”„ How Fallback Works

The system tries models in this order until one succeeds:

1. **Gemini 2.0 Flash** (if API key set)
2. **Groq Llama 3.3 70B** (if Gemini fails)
3. **Groq Kimi K2** (if Llama fails)
4. **OpenRouter DeepSeek R1** (if Groq fails)
5. **OpenRouter Qwen 3 Coder 480B** (if DeepSeek fails)
6. **OpenRouter DeepSeek V3.1** (if Qwen fails)
7. **Groq Llama 3.1 70B** (alternative)
8. **OpenRouter Llama 3.1 405B** (last resort)

**Result:** Near 100% uptime even if one service is down!

---

## ðŸ“Š View Results

After running analysis, view results in:
- **AI Dashboard:** http://192.168.1.161:8080/ai-dashboard
- **Main Dashboard:** http://192.168.1.161:8080/

---

## âš™ï¸ Automatic Analysis (Cron Job)

**Run AI analysis every 5 minutes:**

```bash
# Edit crontab
crontab -e

# Add this line:
*/5 * * * * cd /home/jarvis/NetGuard && python3 scripts/ai_service_connector.py >> /home/jarvis/NetGuard/logs/ai_analysis.log 2>&1
```

**Or use systemd timer** (recommended):

```bash
# Create timer
sudo tee /etc/systemd/system/ai-analysis.timer << 'EOF'
[Unit]
Description=NetGuard AI Analysis Timer
Requires=ai-analysis.service

[Timer]
OnBootSec=5min
OnUnitActiveSec=5min

[Install]
WantedBy=timers.target
EOF

# Create service
sudo tee /etc/systemd/system/ai-analysis.service << 'EOF'
[Unit]
Description=NetGuard AI Analysis Service
After=network.target

[Service]
Type=oneshot
User=jarvis
WorkingDirectory=/home/jarvis/NetGuard
ExecStart=/usr/bin/python3 /home/jarvis/NetGuard/scripts/ai_service_connector.py
StandardOutput=append:/home/jarvis/NetGuard/logs/ai_analysis.log
StandardError=append:/home/jarvis/NetGuard/logs/ai_analysis.log

[Install]
WantedBy=multi-user.target
EOF

# Enable and start
sudo systemctl daemon-reload
sudo systemctl enable ai-analysis.timer
sudo systemctl start ai-analysis.timer

# Check status
sudo systemctl status ai-analysis.timer
```

---

## ðŸ” Check Current Configuration

```bash
sqlite3 /home/jarvis/NetGuard/network.db \
  "SELECT key, CASE WHEN value LIKE 'YOUR_API_KEY%' THEN 'âŒ NOT SET' ELSE 'âœ… SET' END as status, description FROM ai_config WHERE key LIKE '%key%';"
```

**Expected Output:**
```
gemini_api_key|âœ… SET|Google Gemini 2.0 Flash API Key
groq_api_key|âœ… SET|Groq API Key (Llama, Kimi)
openrouter_api_key|âœ… SET|OpenRouter API Key (DeepSeek, Qwen)
```

---

## ðŸ’° Cost (All FREE!)

| Service | Free Tier | Cost Per Analysis | Daily Cost |
|---------|-----------|-------------------|------------|
| Gemini 2.0 Flash | 15 RPM | $0 | $0 |
| Groq (Llama/Kimi) | 30 RPM | $0 | $0 |
| OpenRouter (Free Models) | Unlimited | $0 | $0 |

**Estimated Usage:**
- Analysis every 5 minutes
- 288 analyses per day
- **TOTAL COST: $0/month** ðŸŽ‰

---

## ðŸ› ï¸ Troubleshooting

### "No API keys configured"
**Solution:** Add at least one API key using commands above

### "All AI models failed"
**Possible Causes:**
1. API key not set correctly
2. API key invalid or expired
3. Rate limit exceeded (wait 1 minute)
4. Internet connection issue

**Check logs:**
```bash
python3 /home/jarvis/NetGuard/scripts/ai_service_connector.py
```

### "Gemini error: API key not valid"
**Solution:**
1. Regenerate key at https://aistudio.google.com/app/apikey
2. Update database:
```bash
sqlite3 /home/jarvis/NetGuard/network.db \
  "UPDATE ai_config SET value='NEW_KEY' WHERE key='gemini_api_key';"
```

### Rate Limit Exceeded
**Solution:** System automatically falls back to next available model

---

## ðŸŽ¯ Summary

**Minimum Setup (1 API key):**
- Get Gemini key â†’ Add to database â†’ Enable AI â†’ Test

**Recommended Setup (All 3 keys):**
- Gemini (primary) + Groq (fast fallback) + OpenRouter (many models)

**Result:**
- 100% free
- 99.9% uptime
- Real-time threat detection
- Beautiful dashboard
- No coding required!

---

## ðŸ“§ Support

**View documentation:**
- `/home/jarvis/NetGuard/AI_INTEGRATION_COMPLETE.md`
- `/home/jarvis/NetGuard/AI_SYSTEM_PROMPT.md`

**Need help?** Run the connector script manually to see detailed error messages:
```bash
cd /home/jarvis/NetGuard
python3 scripts/ai_service_connector.py
```

