================================================================================
       SURICATA "ETHERTYPE UNKNOWN" FALSE POSITIVE - FIXED
================================================================================

ğŸ” WHAT IS "ETHERTYPE UNKNOWN"?
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

The "Ethertype unknown" alert is a Suricata decoder event that triggers when
it encounters Ethernet frames with protocol types it doesn't recognize.

COMMON CAUSES (ALL FALSE POSITIVES):
â€¢ VLAN tagging (802.1Q)
â€¢ IPv6 traffic
â€¢ ARP packets
â€¢ Proprietary protocols
â€¢ Packet capture tool interactions (tcpdump/tshark)

THIS IS NOT A SECURITY THREAT - It's a protocol compatibility issue.

================================================================================

âœ… FIXES APPLIED:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. DASHBOARD FILTERING (Immediate Effect)
   âœ“ Updated app.py to filter "Ethertype unknown" from homepage
   âœ“ Updated app.py to filter from Suricata alert tables
   âœ“ Updated ai_5min_aggregator.py to exclude from AI analysis
   
   These alerts will NO LONGER appear in:
   â€¢ Homepage threat timeline
   â€¢ AI Dashboard
   â€¢ Suricata alert pages
   
   Changes are ACTIVE NOW - just restart Flask!

2. SURICATA SUPPRESSION CONFIG (Optional - System Level)
   âœ“ Created: /home/jarvis/NetGuard/configs/suricata-suppress.conf
   
   This prevents Suricata from generating these alerts at all.

================================================================================

ğŸš€ APPLY THE FIXES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

METHOD 1: RESTART FLASK (Immediate - Dashboard Only)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

This will hide the alerts from your dashboard immediately:

    pkill -9 -f "python3.*app.py"
    cd /home/jarvis/NetGuard/web
    python3 app.py > /tmp/netguard_dashboard.log 2>&1 &

âœ“ Alerts filtered from homepage
âœ“ Alerts filtered from AI analysis
âœ“ Alerts filtered from Suricata pages

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

METHOD 2: CONFIGURE SURICATA (Optional - System Level)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

This stops Suricata from generating these alerts entirely:

Step 1: Copy suppression file to Suricata directory
    sudo cp /home/jarvis/NetGuard/configs/suricata-suppress.conf \
            /etc/suricata/threshold.config

Step 2: Edit Suricata main config
    sudo nano /etc/suricata/suricata.yaml

Step 3: Find the "threshold-file" section and update it:
    # Threshold and suppression configuration
    threshold-file: /etc/suricata/threshold.config

Step 4: Restart Suricata
    sudo systemctl restart suricata
    # OR if running manually:
    sudo pkill suricata
    sudo systemctl start suricata

Step 5: Verify
    sudo tail -f /var/log/suricata/fast.log
    # You should no longer see "Ethertype unknown" alerts

================================================================================

ğŸ¯ ADDITIONAL FILTERS APPLIED:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

In addition to "Ethertype unknown", we also filter these common false positives:

â€¢ IPv4 checksum errors (often from NIC offloading)
â€¢ IPv6 checksum errors (same reason)
â€¢ VLAN-related decoder events

These are typically benign network conditions, not security threats.

================================================================================

ğŸ“Š WHAT YOU'LL SEE NOW:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

BEFORE:
  âœ— Homepage: "SURICATA Ethertype unknown" alerts
  âœ— AI Dashboard: Multiple "Ethertype unknown" threats
  âœ— Suricata page: Hundreds of decoder events

AFTER:
  âœ“ Homepage: Only genuine security threats
  âœ“ AI Dashboard: Accurate threat analysis
  âœ“ Suricata page: Clean, relevant alerts only

================================================================================

ğŸ”§ IF YOU WANT TO SEE THESE ALERTS AGAIN:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Simply remove the filters:

1. In app.py, remove the "WHERE signature NOT LIKE..." clauses
2. In ai_5min_aggregator.py, remove the same filters
3. Restart Flask

Or comment out the suppression rules in Suricata config.

================================================================================

ğŸ’¡ WHY THIS IS SAFE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

"Ethertype unknown" is a DECODER event, not a security detection.

It means: "I don't recognize this protocol type"
NOT:      "This is malicious traffic"

Suricata has thousands of actual security rules that will still work:
â€¢ Malware signatures
â€¢ Exploit attempts
â€¢ Botnet communication
â€¢ Port scans
â€¢ DDoS patterns

We're ONLY suppressing benign protocol decoder events.

================================================================================

âœ… VERIFICATION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

After restarting Flask:

1. Open homepage: http://localhost:8080
2. Check "Recent Security Alerts" section
3. Open AI Dashboard: http://localhost:8080/ai-dashboard
4. Check threats detected

You should see ZERO "Ethertype unknown" alerts!

If you still see them, check:
â€¢ Flask was properly restarted
â€¢ Browser cache cleared (Ctrl+Shift+R)
â€¢ Check /tmp/netguard_dashboard.log for errors

================================================================================

ğŸ“ FILES MODIFIED:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âœ“ /home/jarvis/NetGuard/web/app.py
  - index() route: Filter threat_timeline
  - suricata_table() route: Filter alert tables

âœ“ /home/jarvis/NetGuard/scripts/ai_5min_aggregator.py
  - Suricata alert collection: Added WHERE filters

âœ“ /home/jarvis/NetGuard/configs/suricata-suppress.conf (NEW)
  - Suricata suppression rules

================================================================================

Need help? Check logs:
  Flask:    tail -f /tmp/netguard_dashboard.log
  Suricata: sudo tail -f /var/log/suricata/suricata.log

================================================================================

