{"fsPath":"\\home\\jarvis\\NetGuard\\web\\templates\\network_topology.html","fileUuid":"5b97acc7-1603-41a8-8b50-d3ebebcf5b64","fileSizeBytes":18367,"numLines":559,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":560,"addedLines":["{% extends \"base.html\" %}","","{% block title %}Network Topology - NetGuard Pro{% endblock %}","","{% block content %}","<style>","    .topology-container {","        background: #0a0a0a;","        border: 2px solid #2a2a2a;","        border-radius: 12px;","        padding: 20px;","        margin-bottom: 20px;","        position: relative;","    }","    ","    #network-graph {","        width: 100%;","        height: 700px;","        border-radius: 8px;","        background: radial-gradient(circle at center, #1a1a1a 0%, #0a0a0a 100%);","        position: relative;","    }","    ","    .node {","        cursor: pointer;","        transition: all 0.3s ease;","    }","    ","    .node:hover {","        stroke-width: 4px;","    }","    ","    .node-label {","        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto;","        font-size: 11px;","        fill: #ddd;","        text-anchor: middle;","        pointer-events: none;","        text-shadow: 0 0 3px #000, 0 0 3px #000;","    }","    ","    .link {","        stroke: #00d4ff;","        stroke-opacity: 0.3;","        stroke-width: 1.5px;","    }","    ","    .link-active {","        stroke-opacity: 0.8;","        stroke-width: 3px;","    }","    ","    .device-details {","        background: #1a1a1a;","        border: 2px solid #00d4ff;","        border-radius: 12px;","        padding: 20px;","        margin-top: 20px;","        display: none;","    }","    ","    .device-details.show {","        display: block;","        animation: slideIn 0.3s ease-out;","    }","    ","    @keyframes slideIn {","        from {","            opacity: 0;","            transform: translateY(-20px);","        }","        to {","            opacity: 1;","            transform: translateY(0);","        }","    }","    ","    .legend {","        position: absolute;","        top: 30px;","        right: 30px;","        background: rgba(26, 26, 26, 0.95);","        border: 1px solid #2a2a2a;","        border-radius: 8px;","        padding: 15px;","        min-width: 200px;","        backdrop-filter: blur(10px);","    }","    ","    .legend-item {","        display: flex;","        align-items: center;","        margin-bottom: 10px;","        font-size: 0.85rem;","        color: #ddd;","    }","    ","    .legend-item:last-child {","        margin-bottom: 0;","    }","    ","    .legend-color {","        width: 20px;","        height: 20px;","        border-radius: 50%;","        margin-right: 10px;","        border: 2px solid #fff;","    }","    ","    .topology-controls {","        display: flex;","        gap: 10px;","        margin-bottom: 20px;","        flex-wrap: wrap;","    }","    ","    .control-btn {","        background: var(--bg-card);","        border: 1px solid var(--border-color);","        color: var(--text-primary);","        padding: 8px 16px;","        border-radius: 6px;","        cursor: pointer;","        transition: all 0.3s ease;","        font-size: 0.9rem;","    }","    ","    .control-btn:hover {","        background: var(--primary-color);","        color: #000;","        border-color: var(--primary-color);","    }","    ","    .control-btn.active {","        background: var(--primary-color);","        color: #000;","        border-color: var(--primary-color);","    }","    ","    .stats-bar {","        display: grid;","        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));","        gap: 15px;","        margin-bottom: 20px;","    }","    ","    .stat-box {","        background: #1a1a1a;","        border: 1px solid #2a2a2a;","        border-radius: 8px;","        padding: 15px;","        text-align: center;","    }","    ","    .stat-box-label {","        font-size: 0.8rem;","        color: #888;","        text-transform: uppercase;","        margin-bottom: 8px;","    }","    ","    .stat-box-value {","        font-size: 1.8rem;","        font-weight: 700;","        color: #00d4ff;","    }","</style>","","<div class=\"row mb-4\">","    <div class=\"col-12\">","        <div class=\"card\" style=\"border: 2px solid var(--primary-color);\">","            <div class=\"card-header\" style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff;\">","                <h4 class=\"mb-0\">","                    <i class=\"fas fa-project-diagram\"></i> Network Topology Map","                </h4>","            </div>","            <div class=\"card-body\">","                <p class=\"mb-0\" style=\"color: var(--text-secondary);\">","                    Interactive visualization of your network devices and connections. Click on devices for detailed information.","                </p>","            </div>","        </div>","    </div>","</div>","","<!-- Statistics Bar -->","<div class=\"stats-bar\">","    <div class=\"stat-box\">","        <div class=\"stat-box-label\"><i class=\"fas fa-laptop\"></i> Total Devices</div>","        <div class=\"stat-box-value\" id=\"total-devices\">{{ devices|length }}</div>","    </div>","    <div class=\"stat-box\">","        <div class=\"stat-box-label\"><i class=\"fas fa-microchip\"></i> IoT Devices</div>","        <div class=\"stat-box-value\" id=\"iot-devices\">{{ devices|selectattr('device_type', 'equalto', 'IoT')|list|length }}</div>","    </div>","    <div class=\"stat-box\">","        <div class=\"stat-box-label\"><i class=\"fas fa-network-wired\"></i> Active Connections</div>","        <div class=\"stat-box-value\" id=\"active-connections\">{{ connections|length if connections else 0 }}</div>","    </div>","    <div class=\"stat-box\">","        <div class=\"stat-box-label\"><i class=\"fas fa-shield-alt\"></i> Avg Security</div>","        <div class=\"stat-box-value\">{{ (devices|map(attribute='security_score')|sum / devices|length)|round(0)|int if devices else 0 }}</div>","    </div>","</div>","","<!-- Topology Controls -->","<div class=\"topology-controls\">","    <button class=\"control-btn active\" onclick=\"resetZoom()\">","        <i class=\"fas fa-compress-arrows-alt\"></i> Reset View","    </button>","    <button class=\"control-btn\" onclick=\"toggleLabels()\">","        <i class=\"fas fa-tag\"></i> Toggle Labels","    </button>","    <button class=\"control-btn\" onclick=\"filterByType('all')\">","        <i class=\"fas fa-filter\"></i> Show All","    </button>","    <button class=\"control-btn\" onclick=\"filterByType('IoT')\">","        <i class=\"fas fa-microchip\"></i> IoT Only","    </button>","    <button class=\"control-btn\" onclick=\"filterByType('vulnerable')\">","        <i class=\"fas fa-exclamation-triangle\"></i> Vulnerable","    </button>","    <button class=\"control-btn\" onclick=\"exportTopology()\">","        <i class=\"fas fa-download\"></i> Export SVG","    </button>","</div>","","<!-- Network Graph Container -->","<div class=\"topology-container\">","    <div id=\"network-graph\"></div>","    ","    <!-- Legend -->","    <div class=\"legend\">","        <div style=\"font-weight: 600; color: #00d4ff; margin-bottom: 15px; font-size: 0.95rem;\">","            <i class=\"fas fa-info-circle\"></i> Device Types","        </div>","        <div class=\"legend-item\">","            <div class=\"legend-color\" style=\"background: #ff6b6b;\"></div>","            <span>IoT Devices</span>","        </div>","        <div class=\"legend-item\">","            <div class=\"legend-color\" style=\"background: #4ecdc4;\"></div>","            <span>Mobile Devices</span>","        </div>","        <div class=\"legend-item\">","            <div class=\"legend-color\" style=\"background: #45b7d1;\"></div>","            <span>Computers</span>","        </div>","        <div class=\"legend-item\">","            <div class=\"legend-color\" style=\"background: #ffa500;\"></div>","            <span>Network Equipment</span>","        </div>","        <div class=\"legend-item\">","            <div class=\"legend-color\" style=\"background: #666;\"></div>","            <span>Unknown</span>","        </div>","        <div style=\"margin-top: 15px; padding-top: 15px; border-top: 1px solid #2a2a2a;\">","            <div class=\"legend-item\" style=\"margin-bottom: 5px;\">","                <div style=\"width: 30px; height: 3px; background: #00d4ff; margin-right: 10px;\"></div>","                <span style=\"font-size: 0.8rem;\">Active Connection</span>","            </div>","            <div class=\"legend-item\">","                <div style=\"width: 20px; height: 20px; border: 3px solid #f44336; border-radius: 50%; margin-right: 10px;\"></div>","                <span style=\"font-size: 0.8rem;\">Vulnerable</span>","            </div>","        </div>","    </div>","</div>","","<!-- Device Details Panel -->","<div id=\"device-details\" class=\"device-details\">","    <div class=\"row\">","        <div class=\"col-md-8\">","            <h4 style=\"color: #00d4ff; margin-bottom: 20px;\">","                <i class=\"fas fa-info-circle\"></i> <span id=\"detail-name\">Device Details</span>","            </h4>","            <div class=\"row\">","                <div class=\"col-md-6 mb-3\">","                    <div style=\"color: #888; font-size: 0.85rem; margin-bottom: 5px;\">IP Address</div>","                    <div style=\"color: #fff; font-weight: 600;\" id=\"detail-ip\">-</div>","                </div>","                <div class=\"col-md-6 mb-3\">","                    <div style=\"color: #888; font-size: 0.85rem; margin-bottom: 5px;\">MAC Address</div>","                    <div style=\"color: #fff; font-weight: 600; font-family: monospace;\" id=\"detail-mac\">-</div>","                </div>","                <div class=\"col-md-6 mb-3\">","                    <div style=\"color: #888; font-size: 0.85rem; margin-bottom: 5px;\">Device Type</div>","                    <div style=\"color: #fff; font-weight: 600;\" id=\"detail-type\">-</div>","                </div>","                <div class=\"col-md-6 mb-3\">","                    <div style=\"color: #888; font-size: 0.85rem; margin-bottom: 5px;\">Vendor</div>","                    <div style=\"color: #fff; font-weight: 600;\" id=\"detail-vendor\">-</div>","                </div>","                <div class=\"col-md-6 mb-3\">","                    <div style=\"color: #888; font-size: 0.85rem; margin-bottom: 5px;\">Last Seen</div>","                    <div style=\"color: #fff; font-weight: 600;\" id=\"detail-lastseen\">-</div>","                </div>","                <div class=\"col-md-6 mb-3\">","                    <div style=\"color: #888; font-size: 0.85rem; margin-bottom: 5px;\">Security Score</div>","                    <div style=\"font-size: 1.5rem; font-weight: 700;\" id=\"detail-score\">-</div>","                </div>","            </div>","        </div>","        <div class=\"col-md-4\">","            <div style=\"text-align: center; padding: 20px; background: #0a0a0a; border-radius: 8px;\">","                <div style=\"font-size: 4rem; margin-bottom: 10px;\" id=\"detail-icon\">","                    <i class=\"fas fa-microchip\"></i>","                </div>","                <div style=\"color: #888; font-size: 0.9rem;\" id=\"detail-category\">Device Category</div>","            </div>","        </div>","    </div>","    <div class=\"mt-3\">","        <a href=\"/iot-devices\" class=\"btn btn-primary\">","            <i class=\"fas fa-list\"></i> View All Devices","        </a>","        <button class=\"btn btn-secondary\" onclick=\"closeDetails()\">","            <i class=\"fas fa-times\"></i> Close","        </button>","    </div>","</div>","","<!-- Load D3.js -->","<script src=\"https://d3js.org/d3.v7.min.js\"></script>","","<script>","    // Device data from Flask","    const devicesData = {{ devices|tojson }};","    const connectionsData = {{ connections|tojson if connections else '[]'|safe }};","    ","    // Color mapping for device types","    const typeColors = {","        'IoT': '#ff6b6b',","        'Mobile': '#4ecdc4',","        'Computer': '#45b7d1',","        'Network': '#ffa500',","        'Unknown': '#666'","    };","    ","    // Graph dimensions","    const width = document.getElementById('network-graph').clientWidth;","    const height = 700;","    ","    let labelsVisible = true;","    let currentFilter = 'all';","    ","    // Create SVG","    const svg = d3.select('#network-graph')","        .append('svg')","        .attr('width', width)","        .attr('height', height);","    ","    // Add zoom behavior","    const g = svg.append('g');","    const zoom = d3.zoom()","        .scaleExtent([0.1, 4])","        .on('zoom', (event) => {","            g.attr('transform', event.transform);","        });","    svg.call(zoom);","    ","    // Prepare nodes","    const nodes = devicesData.map(d => ({","        id: d.ip_address,","        name: d.hostname || d.ip_address,","        type: d.device_type || 'Unknown',","        category: d.device_category || 'Unknown',","        score: d.security_score || 50,","        mac: d.mac_address || 'N/A',","        vendor: d.vendor || 'Unknown',","        last_seen: d.last_seen || 'N/A',","        vulnerable: d.security_score < 70","    }));","    ","    // Prepare links (connections between devices)","    const links = [];","    ","    // Find router/gateway (usually .1)","    const gateway = nodes.find(n => n.id.endsWith('.1')) || nodes[0];","    ","    // Create star topology: all devices connect to gateway","    nodes.forEach(node => {","        if (node.id !== gateway.id) {","            links.push({","                source: gateway.id,","                target: node.id,","                strength: Math.random() * 5 + 1","            });","        }","    });","    ","    // Create force simulation","    const simulation = d3.forceSimulation(nodes)","        .force('link', d3.forceLink(links).id(d => d.id).distance(150))","        .force('charge', d3.forceManyBody().strength(-300))","        .force('center', d3.forceCenter(width / 2, height / 2))","        .force('collision', d3.forceCollide().radius(40));","    ","    // Draw links","    const link = g.append('g')","        .selectAll('line')","        .data(links)","        .enter()","        .append('line')","        .attr('class', 'link')","        .style('stroke-width', d => d.strength);","    ","    // Draw nodes","    const node = g.append('g')","        .selectAll('g')","        .data(nodes)","        .enter()","        .append('g')","        .attr('class', 'node')","        .call(d3.drag()","            .on('start', dragstarted)","            .on('drag', dragged)","            .on('end', dragended));","    ","    // Add circles to nodes","    node.append('circle')","        .attr('r', d => d.id === gateway.id ? 30 : 20)","        .attr('fill', d => typeColors[d.type] || '#666')","        .attr('stroke', d => d.vulnerable ? '#f44336' : '#fff')","        .attr('stroke-width', d => d.vulnerable ? 3 : 2)","        .style('filter', d => d.vulnerable ? 'drop-shadow(0 0 10px #f44336)' : 'none');","    ","    // Add device icons","    node.append('text')","        .attr('text-anchor', 'middle')","        .attr('dy', 5)","        .style('font-size', d => d.id === gateway.id ? '20px' : '14px')","        .style('fill', '#fff')","        .style('pointer-events', 'none')","        .text(d => {","            if (d.type === 'Network') return 'ðŸŒ';","            if (d.type === 'IoT') return 'ðŸ’¡';","            if (d.type === 'Mobile') return 'ðŸ“±';","            if (d.type === 'Computer') return 'ðŸ’»';","            return 'â“';","        });","    ","    // Add labels","    const labels = node.append('text')","        .attr('class', 'node-label')","        .attr('dy', 35)","        .text(d => d.name.length > 15 ? d.name.substring(0, 15) + '...' : d.name);","    ","    // Add node click handler","    node.on('click', (event, d) => {","        showDeviceDetails(d);","        event.stopPropagation();","    });","    ","    // Update positions on simulation tick","    simulation.on('tick', () => {","        link","            .attr('x1', d => d.source.x)","            .attr('y1', d => d.source.y)","            .attr('x2', d => d.target.x)","            .attr('y2', d => d.target.y);","        ","        node.attr('transform', d => `translate(${d.x},${d.y})`);","    });","    ","    // Drag functions","    function dragstarted(event, d) {","        if (!event.active) simulation.alphaTarget(0.3).restart();","        d.fx = d.x;","        d.fy = d.y;","    }","    ","    function dragged(event, d) {","        d.fx = event.x;","        d.fy = event.y;","    }","    ","    function dragended(event, d) {","        if (!event.active) simulation.alphaTarget(0);","        d.fx = null;","        d.fy = null;","    }","    ","    // Show device details","    function showDeviceDetails(device) {","        document.getElementById('detail-name').textContent = device.name;","        document.getElementById('detail-ip').textContent = device.id;","        document.getElementById('detail-mac').textContent = device.mac;","        document.getElementById('detail-type').textContent = device.type;","        document.getElementById('detail-vendor').textContent = device.vendor;","        document.getElementById('detail-category').textContent = device.category;","        document.getElementById('detail-lastseen').textContent = device.last_seen;","        ","        const scoreElem = document.getElementById('detail-score');","        scoreElem.textContent = device.score;","        scoreElem.style.color = device.score >= 80 ? '#4caf50' : device.score >= 50 ? '#ff9800' : '#f44336';","        ","        // Set icon based on type","        const iconMap = {","            'IoT': 'fa-microchip',","            'Mobile': 'fa-mobile-alt',","            'Computer': 'fa-desktop',","            'Network': 'fa-network-wired',","            'Unknown': 'fa-question-circle'","        };","        document.getElementById('detail-icon').innerHTML = `<i class=\"fas ${iconMap[device.type] || 'fa-microchip'}\"></i>`;","        ","        document.getElementById('device-details').classList.add('show');","    }","    ","    function closeDetails() {","        document.getElementById('device-details').classList.remove('show');","    }","    ","    // Control functions","    function resetZoom() {","        svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity);","    }","    ","    function toggleLabels() {","        labelsVisible = !labelsVisible;","        labels.style('display', labelsVisible ? 'block' : 'none');","    }","    ","    function filterByType(type) {","        currentFilter = type;","        ","        node.style('opacity', d => {","            if (type === 'all') return 1;","            if (type === 'vulnerable') return d.vulnerable ? 1 : 0.2;","            return d.type === type ? 1 : 0.2;","        });","        ","        link.style('opacity', d => {","            if (type === 'all') return 0.3;","            if (type === 'vulnerable') {","                return (d.source.vulnerable || d.target.vulnerable) ? 0.6 : 0.1;","            }","            return (d.source.type === type || d.target.type === type) ? 0.6 : 0.1;","        });","    }","    ","    function exportTopology() {","        const svgData = document.querySelector('#network-graph svg').outerHTML;","        const blob = new Blob([svgData], {type: 'image/svg+xml'});","        const url = URL.createObjectURL(blob);","        const link = document.createElement('a');","        link.href = url;","        link.download = 'network-topology.svg';","        link.click();","    }","    ","    // Auto-refresh every 2 minutes","    setTimeout(() => location.reload(), 120000);","</script>","","{% endblock %}","",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000001,1000003,1000004,1000005,1000006,1000007,1000008,1000009,1000010,1000011,1000012,1000013,1000014,1000015,1000016,1000017,1000018,1000011,1000012,1000013,1000019,1000020,1000021,1000012,1000013,1000022,1000023,1000012,1000013,1000024,1000025,1000026,1000027,1000028,1000029,1000030,1000012,1000013,1000031,1000032,1000033,1000034,1000012,1000013,1000035,1000036,1000037,1000012,1000013,1000038,1000039,1000040,1000008,1000009,1000041,1000042,1000012,1000013,1000043,1000044,1000045,1000012,1000013,1000046,1000047,1000048,1000049,1000050,1000051,1000052,1000053,1000050,1000012,1000013,1000054,1000055,1000056,1000057,1000058,1000059,1000017,1000060,1000061,1000062,1000012,1000013,1000063,1000064,1000065,1000066,1000067,1000068,1000012,1000013,1000069,1000070,1000012,1000013,1000071,1000072,1000073,1000074,1000075,1000076,1000012,1000013,1000077,1000064,1000078,1000010,1000079,1000012,1000013,1000080,1000081,1000082,1000083,1000084,1000085,1000020,1000021,1000086,1000012,1000013,1000087,1000088,1000089,1000090,1000012,1000013,1000091,1000088,1000089,1000090,1000012,1000013,1000092,1000093,1000094,1000095,1000010,1000012,1000013,1000096,1000039,1000059,1000017,1000060,1000097,1000012,1000013,1000098,1000099,1000100,1000101,1000102,1000012,1000013,1000103,1000104,1000105,1000106,1000012,1000107,1000001,1000108,1000109,1000110,1000111,1000112,1000113,1000114,1000115,1000116,1000117,1000118,1000119,1000115,1000120,1000121,1000122,1000001,1000123,1000124,1000125,1000126,1000127,1000121,1000125,1000128,1000129,1000121,1000125,1000130,1000131,1000121,1000125,1000132,1000133,1000121,1000122,1000001,1000134,1000135,1000136,1000137,1000138,1000139,1000140,1000138,1000141,1000142,1000138,1000143,1000144,1000138,1000145,1000146,1000138,1000147,1000148,1000138,1000122,1000001,1000149,1000150,1000151,1000013,1000152,1000153,1000154,1000155,1000120,1000156,1000157,1000158,1000120,1000156,1000159,1000160,1000120,1000156,1000161,1000162,1000120,1000156,1000163,1000164,1000120,1000156,1000165,1000166,1000120,1000167,1000168,1000169,1000170,1000115,1000171,1000172,1000173,1000115,1000120,1000121,1000122,1000001,1000174,1000175,1000176,1000177,1000178,1000179,1000180,1000181,1000182,1000183,1000184,1000185,1000182,1000186,1000187,1000185,1000182,1000188,1000189,1000185,1000182,1000190,1000191,1000185,1000182,1000192,1000193,1000185,1000182,1000194,1000195,1000185,1000115,1000120,1000196,1000197,1000198,1000199,1000185,1000200,1000115,1000120,1000121,1000201,1000202,1000203,1000204,1000205,1000206,1000207,1000121,1000122,1000001,1000208,1000209,1000001,1000210,1000211,1000212,1000213,1000013,1000214,1000215,1000216,1000217,1000218,1000219,1000220,1000221,1000013,1000222,1000223,1000224,1000013,1000225,1000226,1000013,1000227,1000228,1000229,1000230,1000231,1000013,1000232,1000233,1000234,1000235,1000236,1000237,1000238,1000239,1000013,1000240,1000241,1000242,1000243,1000244,1000245,1000246,1000247,1000248,1000249,1000250,1000251,1000013,1000252,1000253,1000013,1000254,1000255,1000013,1000256,1000257,1000258,1000259,1000260,1000261,1000262,1000263,1000050,1000264,1000013,1000265,1000266,1000267,1000268,1000269,1000270,1000013,1000271,1000272,1000273,1000274,1000275,1000276,1000277,1000278,1000013,1000279,1000280,1000281,1000282,1000275,1000283,1000284,1000285,1000286,1000287,1000288,1000013,1000289,1000290,1000291,1000292,1000293,1000294,1000295,1000013,1000296,1000297,1000298,1000299,1000300,1000301,1000302,1000303,1000304,1000305,1000306,1000307,1000308,1000238,1000013,1000309,1000310,1000311,1000312,1000313,1000013,1000314,1000315,1000316,1000317,1000264,1000013,1000318,1000319,1000320,1000321,1000322,1000323,1000324,1000325,1000326,1000264,1000013,1000327,1000328,1000329,1000330,1000331,1000012,1000013,1000332,1000333,1000334,1000012,1000013,1000335,1000336,1000337,1000338,1000012,1000013,1000339,1000340,1000341,1000342,1000343,1000344,1000345,1000346,1000347,1000325,1000348,1000349,1000350,1000325,1000351,1000352,1000353,1000354,1000355,1000356,1000357,1000358,1000359,1000325,1000360,1000012,1000013,1000361,1000362,1000012,1000013,1000363,1000364,1000365,1000012,1000013,1000366,1000367,1000368,1000012,1000013,1000369,1000370,1000325,1000371,1000372,1000373,1000374,1000238,1000325,1000375,1000376,1000377,1000378,1000379,1000380,1000238,1000012,1000013,1000381,1000382,1000383,1000384,1000385,1000386,1000387,1000388,1000012,1000013,1000389,1000390,1000391,1000001,1000392,1000001,1000001]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}