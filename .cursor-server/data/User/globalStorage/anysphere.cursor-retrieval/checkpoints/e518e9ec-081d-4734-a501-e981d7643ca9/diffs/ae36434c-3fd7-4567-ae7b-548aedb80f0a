{"fsPath":"\\home\\jarvis\\NetGuard\\scripts\\suricata_collector.py","fileUuid":"ae36434c-3fd7-4567-ae7b-548aedb80f0a","fileSizeBytes":31232,"numLines":822,"diffChanges":[{"originalStartLineNumberOneIndexed":29,"originalEndLineNumberExclusiveOneIndexed":30,"modifiedStartLineNumberOneIndexed":29,"modifiedEndLineNumberExclusiveOneIndexed":30,"addedLines":["    level=logging.DEBUG,"],"tokenizedAddedLines":[1000449]},{"originalStartLineNumberOneIndexed":54,"originalEndLineNumberExclusiveOneIndexed":54,"modifiedStartLineNumberOneIndexed":54,"modifiedEndLineNumberExclusiveOneIndexed":59,"addedLines":["def save_positions_dict(positions_dict):","    \"\"\"Save multiple positions at once\"\"\"","    with open(POSITION_FILE, 'w') as f:","        json.dump(positions_dict, f, indent=2)",""],"tokenizedAddedLines":[1000450,1000451,45,1000452,6]},{"originalStartLineNumberOneIndexed":598,"originalEndLineNumberExclusiveOneIndexed":598,"modifiedStartLineNumberOneIndexed":603,"modifiedEndLineNumberExclusiveOneIndexed":605,"addedLines":["        logging.debug(f\"{category}: Processing {len(new_lines)} new lines from position {last_position}\")","        "],"tokenizedAddedLines":[1000453,262]},{"originalStartLineNumberOneIndexed":674,"originalEndLineNumberExclusiveOneIndexed":674,"modifiedStartLineNumberOneIndexed":681,"modifiedEndLineNumberExclusiveOneIndexed":783,"addedLines":["def process_all_categories(log_file):","    \"\"\"Process EVE log file for ALL categories in a single pass\"\"\"","    try:","        if not os.path.exists(log_file):","            return 0","        ","        # Get current position","        positions = load_positions()","        last_position = positions.get(log_file, 0)","        ","        # Open file and seek to last position","        with open(log_file, 'r') as f:","            f.seek(last_position)","            new_lines = f.readlines()","            new_position = f.tell()","        ","        if not new_lines:","            return 0","        ","        logging.debug(f\"Processing {len(new_lines)} new lines from position {last_position}\")","        ","        # Connect to database","        conn = sqlite3.connect(DB_PATH)","        ","        # Prepare tables and counters for each category","        timestamp_str = datetime.now().strftime('%Y%m%d_%H%M%S')","        category_data = {}","        for category in CATEGORIES:","            table_name = f\"suricata_{category}_{timestamp_str}\"","            category_data[category] = {","                'table_name': table_name,","                'inserted_count': 0,","                'table_created': False","            }","        ","        # Process all events in a single pass","        for line in new_lines:","            line = line.strip()","            if not line:","                continue","            ","            try:","                event = json.loads(line)","                event_type = event.get('event_type', '')","                ","                # Route event to appropriate category","                category = None","                if event_type == 'alert':","                    category = 'alerts'","                elif event_type == 'http':","                    category = 'http'","                elif event_type == 'dns':","                    category = 'dns'","                elif event_type == 'tls':","                    category = 'tls'","                elif event_type == 'fileinfo':","                    category = 'files'","                elif event_type == 'flow':","                    category = 'flow'","                elif event_type == 'ssh':","                    category = 'ssh'","                elif event_type == 'smtp':","                    category = 'smtp'","                elif event_type == 'ftp':","                    category = 'ftp'","                elif event_type == 'anomaly':","                    category = 'anomaly'","                elif event_type == 'stats':","                    category = 'stats'","                ","                if category and category in category_data:","                    # Create table if not yet created","                    if not category_data[category]['table_created']:","                        create_table_if_not_exists(conn, category, category_data[category]['table_name'])","                        category_data[category]['table_created'] = True","                    ","                    # Insert event","                    if insert_event(conn, category, category_data[category]['table_name'], event):","                        category_data[category]['inserted_count'] += 1","                        ","            except json.JSONDecodeError:","                continue","        ","        conn.commit()","        conn.close()","        ","        # Save new position","        save_position(log_file, new_position)","        ","        # Log results for each category","        total_inserted = 0","        for category, data in category_data.items():","            if data['inserted_count'] > 0:","                logging.info(f\"âœ“ {category}: Inserted {data['inserted_count']} events into '{data['table_name']}'\")","                total_inserted += data['inserted_count']","        ","        return total_inserted","        ","    except Exception as e:","        logging.error(f\"Error processing log: {e}\")","        return 0",""],"tokenizedAddedLines":[1000454,1000455,260,365,366,262,367,368,369,262,370,371,372,373,374,262,375,366,262,1000456,262,379,380,262,1000457,377,1000458,1000459,1000460,1000461,1000462,1000463,1000464,1000465,262,1000466,385,386,387,388,389,390,391,394,392,1000467,1000468,1000469,1000470,1000471,1000472,1000473,1000474,1000475,1000476,1000477,1000478,1000479,1000480,1000481,1000482,1000483,1000484,1000485,1000486,1000487,1000488,1000489,1000490,392,1000491,1000492,1000493,1000494,1000495,1000496,1000497,1000498,1000499,409,410,388,262,411,412,262,413,414,262,1000500,1000501,1000502,1000503,1000504,1000505,262,1000506,262,360,1000507,419,6]},{"originalStartLineNumberOneIndexed":694,"originalEndLineNumberExclusiveOneIndexed":700,"modifiedStartLineNumberOneIndexed":803,"modifiedEndLineNumberExclusiveOneIndexed":805,"addedLines":["            # Process ALL categories in a single pass through the file","            total_inserted = process_all_categories(eve_log)"],"tokenizedAddedLines":[1000508,1000509]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}