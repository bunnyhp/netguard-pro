{"fsPath":"\\home\\jarvis\\NetGuard\\web\\app.py","fileUuid":"ef012af6-7e35-4f48-b24c-1febbeff4358","fileSizeBytes":33502,"numLines":847,"diffChanges":[{"originalStartLineNumberOneIndexed":776,"originalEndLineNumberExclusiveOneIndexed":776,"modifiedStartLineNumberOneIndexed":776,"modifiedEndLineNumberExclusiveOneIndexed":842,"addedLines":["","@app.route('/flush-all-data', methods=['POST'])","def flush_all_data():","    \"\"\"Flush all capture data from all tools\"\"\"","    try:","        conn = get_db_connection()","        cursor = conn.cursor()","        ","        # Get all tables","        cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table'\")","        all_tables = [row['name'] for row in cursor.fetchall()]","        ","        # Tools to flush","        tool_prefixes = [","            'tshark_', 'tcpdump_', 'p0f_', 'argus_', 'ngrep_', ","            'netsniff_', 'httpry_', 'iftop_', 'nethogs_',","            'suricata_alerts_', 'suricata_flow_', 'suricata_http_', ","            'suricata_dns_', 'suricata_tls_', 'suricata_files_',","            'suricata_ssh_', 'suricata_smtp_', 'suricata_ftp_',","            'suricata_anomaly_', 'suricata_stats_'","        ]","        ","        deleted_tables = []","        kept_tables = []","        ","        for table in all_tables:","            # Skip template tables","            if table.endswith('_template'):","                kept_tables.append(table)","                continue","            ","            # Skip AI analysis and system tables","            if table in ['ai_analysis', 'ai_config', 'sqlite_sequence']:","                kept_tables.append(table)","                continue","            ","            # Check if table matches any tool prefix","            should_delete = False","            for prefix in tool_prefixes:","                if table.startswith(prefix):","                    should_delete = True","                    break","            ","            if should_delete:","                cursor.execute(f\"DELETE FROM {table}\")","                deleted_tables.append(table)","            else:","                kept_tables.append(table)","        ","        conn.commit()","        conn.close()","        ","        return jsonify({","            'success': True,","            'message': 'All capture data deleted successfully',","            'deleted_tables': len(deleted_tables),","            'kept_tables': len(kept_tables),","            'tables_deleted': deleted_tables","        })","        ","    except Exception as e:","        return jsonify({","            'success': False,","            'error': str(e)","        }), 500",""],"tokenizedAddedLines":[5,1000518,1000519,1000520,34,35,36,47,1000521,1000522,1000523,47,1000524,1000525,1000526,1000527,1000528,1000529,1000530,1000531,1000532,47,1000533,1000534,47,1000535,1000536,1000537,1000538,167,273,1000539,1000540,1000538,167,273,1000541,1000542,1000543,1000544,1000545,1000546,273,1000547,1000548,1000549,263,1000538,47,1000550,39,47,1000551,1000552,1000553,1000554,1000555,1000556,212,47,53,1000551,1000557,1000558,1000559,5]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}