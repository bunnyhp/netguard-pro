{"fsPath":"\\home\\jarvis\\NetGuard\\scripts\\init_ai_database.py","fileUuid":"0d4f5aba-5053-4957-b311-0668ef9db05c","fileSizeBytes":10579,"numLines":275,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":276,"addedLines":["#!/usr/bin/env python3","\"\"\"","NetGuard Pro - AI Database Schema Initialization","Creates tables for AI predictions, alerts, and device profiles","\"\"\"","","import sqlite3","import os","import logging","","DB_PATH = \"/home/jarvis/NetGuard/network.db\"","","logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')","","def create_ai_tables():","    \"\"\"Create AI-related tables without affecting existing tables\"\"\"","    ","    conn = sqlite3.connect(DB_PATH)","    cursor = conn.cursor()","    ","    try:","        # 1. AI Predictions Table - stores ML model outputs","        cursor.execute(\"\"\"","            CREATE TABLE IF NOT EXISTS ai_predictions (","                id INTEGER PRIMARY KEY AUTOINCREMENT,","                timestamp TEXT NOT NULL,","                analysis_window TEXT,","                threat_level TEXT,","                network_health_score INTEGER,","                threats_detected INTEGER DEFAULT 0,","                anomalies_detected INTEGER DEFAULT 0,","                alerts_generated INTEGER DEFAULT 0,","                threats_json TEXT,","                anomalies_json TEXT,","                patterns_json TEXT,","                dns_analysis_json TEXT,","                processing_time_ms INTEGER,","                created_at DATETIME DEFAULT CURRENT_TIMESTAMP","            )","        \"\"\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_ai_timestamp ON ai_predictions(timestamp)\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_ai_threat_level ON ai_predictions(threat_level)\")","        logging.info(\"‚úì Created ai_predictions table\")","        ","        # 2. AI Alerts Table - actionable security alerts","        cursor.execute(\"\"\"","            CREATE TABLE IF NOT EXISTS ai_alerts (","                id INTEGER PRIMARY KEY AUTOINCREMENT,","                alert_id TEXT UNIQUE NOT NULL,","                priority TEXT NOT NULL,","                title TEXT NOT NULL,","                message TEXT,","                threat_type TEXT,","                source_ip TEXT,","                target_ip TEXT,","                confidence REAL,","                indicators TEXT,","                recommended_action TEXT,","                auto_block INTEGER DEFAULT 0,","                resolved INTEGER DEFAULT 0,","                resolved_at DATETIME,","                resolved_by TEXT,","                timestamp TEXT NOT NULL,","                created_at DATETIME DEFAULT CURRENT_TIMESTAMP","            )","        \"\"\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_alert_priority ON ai_alerts(priority)\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_alert_resolved ON ai_alerts(resolved)\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_alert_timestamp ON ai_alerts(timestamp)\")","        logging.info(\"‚úì Created ai_alerts table\")","        ","        # 3. Device Profiles Table - learned baseline behavior","        cursor.execute(\"\"\"","            CREATE TABLE IF NOT EXISTS device_profiles (","                id INTEGER PRIMARY KEY AUTOINCREMENT,","                device_ip TEXT UNIQUE NOT NULL,","                mac_address TEXT,","                device_name TEXT,","                device_type TEXT,","                first_seen TEXT,","                last_updated TEXT,","                avg_daily_bytes INTEGER,","                std_daily_bytes INTEGER,","                avg_hourly_connections INTEGER,","                typical_protocols TEXT,","                common_destinations TEXT,","                typical_hours TEXT,","                baseline_json TEXT,","                profile_confidence REAL DEFAULT 0.0,","                days_observed INTEGER DEFAULT 0,","                created_at DATETIME DEFAULT CURRENT_TIMESTAMP","            )","        \"\"\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_device_ip ON device_profiles(device_ip)\")","        logging.info(\"‚úì Created device_profiles table\")","        ","        # 4. URL Classifications Table - domain risk scores","        cursor.execute(\"\"\"","            CREATE TABLE IF NOT EXISTS url_classifications (","                id INTEGER PRIMARY KEY AUTOINCREMENT,","                url TEXT,","                domain TEXT NOT NULL,","                risk_score REAL,","                category TEXT,","                threat_intel_match INTEGER DEFAULT 0,","                indicators TEXT,","                action TEXT,","                accessed_by TEXT,","                first_seen TEXT,","                last_seen TEXT,","                access_count INTEGER DEFAULT 1,","                created_at DATETIME DEFAULT CURRENT_TIMESTAMP","            )","        \"\"\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_domain ON url_classifications(domain)\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_risk_score ON url_classifications(risk_score)\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_category ON url_classifications(category)\")","        logging.info(\"‚úì Created url_classifications table\")","        ","        # 5. Threat Patterns Table - detected behavior patterns","        cursor.execute(\"\"\"","            CREATE TABLE IF NOT EXISTS threat_patterns (","                id INTEGER PRIMARY KEY AUTOINCREMENT,","                pattern_type TEXT NOT NULL,","                device_ip TEXT,","                confidence REAL,","                description TEXT,","                characteristics TEXT,","                first_detected TEXT,","                last_detected TEXT,","                occurrences INTEGER DEFAULT 1,","                severity TEXT,","                status TEXT DEFAULT 'active',","                created_at DATETIME DEFAULT CURRENT_TIMESTAMP","            )","        \"\"\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_pattern_device ON threat_patterns(device_ip)\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_pattern_type ON threat_patterns(pattern_type)\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_pattern_status ON threat_patterns(status)\")","        logging.info(\"‚úì Created threat_patterns table\")","        ","        # 6. AI Analysis History - audit trail","        cursor.execute(\"\"\"","            CREATE TABLE IF NOT EXISTS ai_analysis_history (","                id INTEGER PRIMARY KEY AUTOINCREMENT,","                timestamp TEXT NOT NULL,","                packets_analyzed INTEGER,","                devices_analyzed INTEGER,","                threats_found INTEGER,","                alerts_generated INTEGER,","                analysis_duration_ms INTEGER,","                success INTEGER DEFAULT 1,","                error_message TEXT,","                created_at DATETIME DEFAULT CURRENT_TIMESTAMP","            )","        \"\"\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_history_timestamp ON ai_analysis_history(timestamp)\")","        logging.info(\"‚úì Created ai_analysis_history table\")","        ","        # 7. AI Configuration Table - runtime settings","        cursor.execute(\"\"\"","            CREATE TABLE IF NOT EXISTS ai_config (","                id INTEGER PRIMARY KEY AUTOINCREMENT,","                key TEXT UNIQUE NOT NULL,","                value TEXT,","                description TEXT,","                updated_at DATETIME DEFAULT CURRENT_TIMESTAMP","            )","        \"\"\")","        logging.info(\"‚úì Created ai_config table\")","        ","        # Insert default configuration","        default_configs = [","            ('ai_service_url', 'http://localhost:5000', 'AI service endpoint URL'),","            ('analysis_interval', '300', 'Analysis interval in seconds (5 minutes)'),","            ('anomaly_threshold', '0.7', 'Anomaly detection threshold (0-1)'),","            ('alert_email', '', 'Email address for critical alerts'),","            ('auto_block_enabled', '0', 'Enable automatic IP blocking'),","            ('min_confidence', '0.75', 'Minimum confidence for alerts'),","            ('ai_enabled', '0', 'Enable/disable AI analysis'),","            ('learning_mode', '1', 'Enable device behavior learning')","        ]","        ","        for key, value, desc in default_configs:","            cursor.execute(\"\"\"","                INSERT OR IGNORE INTO ai_config (key, value, description) ","                VALUES (?, ?, ?)","            \"\"\", (key, value, desc))","        ","        logging.info(\"‚úì Inserted default AI configuration\")","        ","        conn.commit()","        logging.info(\"=\" * 60)","        logging.info(\"‚úÖ AI Database Schema Created Successfully!\")","        logging.info(\"=\" * 60)","        ","        # Display table info","        cursor.execute(\"\"\"","            SELECT name FROM sqlite_master ","            WHERE type='table' AND (name LIKE 'ai_%' OR name LIKE '%_profile%' OR name LIKE 'url_%')","            ORDER BY name","        \"\"\")","        ","        ai_tables = cursor.fetchall()","        logging.info(f\"\\nüìä Created {len(ai_tables)} AI tables:\")","        for table in ai_tables:","            cursor.execute(f\"SELECT COUNT(*) FROM {table[0]}\")","            count = cursor.fetchone()[0]","            logging.info(f\"   ‚Ä¢ {table[0]}: {count} records\")","        ","        return True","        ","    except Exception as e:","        logging.error(f\"‚ùå Error creating AI tables: {e}\")","        conn.rollback()","        return False","        ","    finally:","        conn.close()","","","def verify_existing_tables():","    \"\"\"Verify existing tables are not affected\"\"\"","    conn = sqlite3.connect(DB_PATH)","    cursor = conn.cursor()","    ","    try:","        # Check if main tables still exist","        cursor.execute(\"\"\"","            SELECT name FROM sqlite_master ","            WHERE type='table' AND (","                name LIKE 'tcpdump_%' OR ","                name LIKE 'tshark_%' OR","                name LIKE 'suricata_%'","            )","            ORDER BY name DESC","            LIMIT 5","        \"\"\")","        ","        existing_tables = cursor.fetchall()","        logging.info(\"\\n‚úì Verified existing tables (sample):\")","        for table in existing_tables:","            logging.info(f\"   ‚Ä¢ {table[0]}\")","        ","        return True","        ","    except Exception as e:","        logging.error(f\"‚ùå Error verifying tables: {e}\")","        return False","        ","    finally:","        conn.close()","","","if __name__ == \"__main__\":","    logging.info(\"=\" * 60)","    logging.info(\"NetGuard Pro - AI Database Initialization\")","    logging.info(\"=\" * 60)","    logging.info(\"\")","    ","    # Verify existing tables first","    logging.info(\"Step 1: Verifying existing tables...\")","    if not verify_existing_tables():","        logging.error(\"Failed to verify existing tables!\")","        exit(1)","    ","    logging.info(\"\\nStep 2: Creating AI tables...\")","    if not create_ai_tables():","        logging.error(\"Failed to create AI tables!\")","        exit(1)","    ","    logging.info(\"\\n‚úÖ AI Database initialization complete!\")","    logging.info(\"No existing functionality was affected.\")","",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000003,1000001,1000004,1000005,1000006,1000007,1000004,1000008,1000004,1000009,1000004,1000010,1000011,1000012,1000013,1000014,1000012,1000015,1000016,1000017,1000018,1000019,1000020,1000021,1000022,1000023,1000024,1000025,1000026,1000027,1000028,1000029,1000030,1000031,1000032,1000033,1000034,1000035,1000036,1000037,1000038,1000039,1000017,1000040,1000019,1000041,1000042,1000043,1000044,1000045,1000046,1000047,1000048,1000049,1000050,1000051,1000052,1000053,1000054,1000020,1000032,1000033,1000034,1000055,1000056,1000057,1000058,1000038,1000059,1000017,1000060,1000019,1000061,1000062,1000063,1000064,1000065,1000066,1000067,1000068,1000069,1000070,1000071,1000072,1000073,1000074,1000075,1000032,1000033,1000034,1000076,1000077,1000038,1000078,1000017,1000079,1000019,1000080,1000081,1000082,1000083,1000084,1000049,1000085,1000086,1000065,1000087,1000088,1000032,1000033,1000034,1000089,1000090,1000091,1000092,1000038,1000093,1000017,1000094,1000019,1000095,1000096,1000048,1000097,1000098,1000099,1000100,1000101,1000102,1000103,1000032,1000033,1000034,1000104,1000105,1000106,1000107,1000038,1000108,1000017,1000109,1000019,1000020,1000110,1000111,1000112,1000113,1000114,1000115,1000116,1000032,1000033,1000034,1000117,1000118,1000038,1000119,1000017,1000120,1000019,1000121,1000122,1000097,1000123,1000033,1000034,1000124,1000038,1000125,1000126,1000127,1000128,1000129,1000130,1000131,1000132,1000133,1000134,1000135,1000038,1000136,1000137,1000138,1000139,1000140,1000038,1000141,1000038,1000142,1000143,1000144,1000143,1000038,1000145,1000017,1000146,1000147,1000148,1000034,1000038,1000149,1000150,1000151,1000152,1000153,1000154,1000038,1000155,1000038,1000156,1000157,1000158,1000159,1000038,1000160,1000161,1000004,1000004,1000162,1000163,1000013,1000014,1000012,1000015,1000164,1000017,1000146,1000165,1000166,1000167,1000168,1000033,1000169,1000170,1000034,1000038,1000171,1000172,1000173,1000174,1000038,1000155,1000038,1000156,1000175,1000159,1000038,1000160,1000161,1000004,1000004,1000176,1000177,1000178,1000177,1000179,1000012,1000180,1000181,1000182,1000183,1000184,1000012,1000185,1000186,1000187,1000184,1000012,1000188,1000189,1000004,1000004]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}