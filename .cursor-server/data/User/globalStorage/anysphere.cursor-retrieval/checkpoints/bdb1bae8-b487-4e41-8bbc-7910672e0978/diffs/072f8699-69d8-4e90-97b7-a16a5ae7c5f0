{"fsPath":"\\home\\jarvis\\NetGuard\\web\\app.py","fileUuid":"072f8699-69d8-4e90-97b7-a16a5ae7c5f0","fileSizeBytes":43334,"numLines":1159,"diffChanges":[{"originalStartLineNumberOneIndexed":849,"originalEndLineNumberExclusiveOneIndexed":849,"modifiedStartLineNumberOneIndexed":849,"modifiedEndLineNumberExclusiveOneIndexed":1035,"addedLines":["","@app.route('/alerts')","def alerts_dashboard():","    \"\"\"Security Alerts Dashboard\"\"\"","    conn = get_db_connection()","    conn.row_factory = sqlite3.Row","    cursor = conn.cursor()","    ","    # Get all active alerts","    cursor.execute(\"\"\"","        SELECT * FROM security_alerts","        WHERE status = 'active'","        ORDER BY ","            CASE severity","                WHEN 'CRITICAL' THEN 1","                WHEN 'HIGH' THEN 2","                WHEN 'MEDIUM' THEN 3","                WHEN 'LOW' THEN 4","                ELSE 5","            END,","            created_at DESC","    \"\"\")","    active_alerts = [dict(row) for row in cursor.fetchall()]","    ","    # Parse JSON fields","    for alert in active_alerts:","        if alert.get('affected_devices'):","            alert['affected_devices'] = json.loads(alert['affected_devices'])","        if alert.get('threat_indicators'):","            alert['threat_indicators'] = json.loads(alert['threat_indicators'])","        if alert.get('remediation_steps'):","            alert['remediation_steps'] = json.loads(alert['remediation_steps'])","    ","    # Get alert statistics","    cursor.execute(\"\"\"","        SELECT severity, COUNT(*) as count","        FROM security_alerts","        WHERE status = 'active'","        GROUP BY severity","    \"\"\")","    severity_counts = {row['severity']: row['count'] for row in cursor.fetchall()}","    ","    # Recent alerts (last 24h)","    cursor.execute(\"\"\"","        SELECT COUNT(*) as count","        FROM security_alerts","        WHERE created_at > datetime('now', '-24 hours')","    \"\"\")","    recent_count = cursor.fetchone()['count']","    ","    # Resolved count","    cursor.execute(\"\"\"","        SELECT COUNT(*) as count","        FROM security_alerts","        WHERE status = 'resolved'","    \"\"\")","    resolved_count = cursor.fetchone()['count']","    ","    conn.close()","    ","    statistics = {","        'severity_counts': severity_counts,","        'total_active': sum(severity_counts.values()),","        'recent_24h': recent_count,","        'total_resolved': resolved_count","    }","    ","    return render_template('alerts.html', alerts=active_alerts, statistics=statistics)","","","@app.route('/alerts/<alert_id>/resolve', methods=['POST'])","def resolve_security_alert(alert_id):","    \"\"\"Resolve a security alert\"\"\"","    conn = get_db_connection()","    cursor = conn.cursor()","    ","    data = request.get_json() or {}","    notes = data.get('notes', 'Alert resolved via dashboard')","    ","    cursor.execute(\"\"\"","        UPDATE security_alerts","        SET status = 'resolved',","            resolved_at = CURRENT_TIMESTAMP,","            resolved_by = 'user',","            updated_at = CURRENT_TIMESTAMP","        WHERE alert_id = ?","    \"\"\", (alert_id,))","    ","    cursor.execute(\"\"\"","        INSERT INTO alert_history (alert_id, action, action_by, notes)","        VALUES (?, 'resolved', 'user', ?)","    \"\"\", (alert_id, notes))","    ","    conn.commit()","    conn.close()","    ","    return jsonify({'success': True, 'message': 'Alert resolved'})","","","@app.route('/alerts/<alert_id>/auto-remediate', methods=['POST'])","def auto_remediate_alert(alert_id):","    \"\"\"Execute auto-remediation for an alert\"\"\"","    import subprocess","    ","    conn = get_db_connection()","    conn.row_factory = sqlite3.Row","    cursor = conn.cursor()","    ","    cursor.execute(\"\"\"","        SELECT alert_id, auto_remediation_command","        FROM security_alerts","        WHERE alert_id = ? AND auto_remediation_available = 1","    \"\"\", (alert_id,))","    ","    alert = cursor.fetchone()","    ","    if not alert:","        return jsonify({'success': False, 'message': 'Alert not found or auto-remediation not available'})","    ","    try:","        # Execute remediation command","        result = subprocess.run(","            alert['auto_remediation_command'],","            shell=True,","            capture_output=True,","            text=True,","            timeout=30","        )","        ","        success = result.returncode == 0","        ","        # Log action","        cursor.execute(\"\"\"","            INSERT INTO alert_history (alert_id, action, action_by, notes)","            VALUES (?, 'auto_remediation', 'user', ?)","        \"\"\", (alert_id, f\"Executed: {alert['auto_remediation_command']}\"))","        ","        if success:","            # Mark as resolved","            cursor.execute(\"\"\"","                UPDATE security_alerts","                SET status = 'resolved',","                    resolved_at = CURRENT_TIMESTAMP,","                    resolved_by = 'auto_remediation',","                    updated_at = CURRENT_TIMESTAMP","                WHERE alert_id = ?","            \"\"\", (alert_id,))","        ","        conn.commit()","        conn.close()","        ","        return jsonify({","            'success': success,","            'message': 'Remediation executed successfully' if success else 'Remediation failed',","            'output': result.stdout or result.stderr","        })","        ","    except Exception as e:","        conn.close()","        return jsonify({'success': False, 'message': str(e)})","","","@app.route('/alerts/<alert_id>/false-positive', methods=['POST'])","def mark_alert_false_positive(alert_id):","    \"\"\"Mark alert as false positive\"\"\"","    conn = get_db_connection()","    cursor = conn.cursor()","    ","    cursor.execute(\"\"\"","        UPDATE security_alerts","        SET false_positive = 1,","            status = 'false_positive',","            updated_at = CURRENT_TIMESTAMP","        WHERE alert_id = ?","    \"\"\", (alert_id,))","    ","    cursor.execute(\"\"\"","        INSERT INTO alert_history (alert_id, action, action_by, notes)","        VALUES (?, 'marked_false_positive', 'user', 'Marked as false positive')","    \"\"\", (alert_id,))","    ","    conn.commit()","    conn.close()","    ","    return jsonify({'success': True, 'message': 'Alert marked as false positive'})",""],"tokenizedAddedLines":[5,1000648,1000649,1000650,22,18,23,179,1000651,381,1000652,1000653,531,532,533,534,535,536,537,1000654,1000655,384,1000656,179,1000657,1000658,1000659,1000660,1000661,1000662,1000663,1000664,179,1000665,381,1000666,1000667,1000653,1000668,384,1000669,179,1000670,381,1000671,1000667,1000672,384,1000673,179,1000674,381,1000671,1000667,1000675,384,1000676,179,26,179,1000677,1000678,1000679,1000680,1000681,191,179,1000682,5,5,1000683,1000684,1000685,22,23,179,1000686,1000687,179,381,1000688,1000689,1000690,1000691,1000692,577,1000693,179,381,1000694,1000695,1000696,179,579,26,179,1000697,5,5,1000698,1000699,1000700,1000701,179,22,18,23,179,381,1000702,1000667,1000703,1000693,179,1000704,179,1000705,1000706,179,34,1000707,1000708,1000709,1000710,1000711,1000712,1000713,1000714,47,1000715,47,1000716,555,1000717,1000718,1000719,47,1000720,1000721,412,1000722,1000723,1000724,1000725,1000726,1000727,1000728,47,636,39,47,637,1000729,1000730,1000731,212,47,53,39,1000732,5,5,1000733,1000734,1000735,22,23,179,381,1000688,1000736,1000737,1000692,577,1000693,179,381,1000694,1000738,1000693,179,579,26,179,1000739,5]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}