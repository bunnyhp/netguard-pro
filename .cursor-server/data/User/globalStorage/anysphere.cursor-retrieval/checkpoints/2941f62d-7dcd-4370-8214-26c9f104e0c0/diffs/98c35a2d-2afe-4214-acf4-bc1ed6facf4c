{"fsPath":"\\home\\jarvis\\NetGuard\\web\\app.py","fileUuid":"98c35a2d-2afe-4214-acf4-bc1ed6facf4c","fileSizeBytes":31318,"numLines":781,"diffChanges":[{"originalStartLineNumberOneIndexed":591,"originalEndLineNumberExclusiveOneIndexed":591,"modifiedStartLineNumberOneIndexed":591,"modifiedEndLineNumberExclusiveOneIndexed":654,"addedLines":["        # Get network summary with device IPs","        analysis_data['network_summary'] = {","            'unique_ips': [],","            'os_distribution': {}","        }","        ","        # Try to get device data from aggregator's latest data","        try:","            # Get unique IPs from tcpdump (most comprehensive)","            cursor.execute(\"\"\"","                SELECT name FROM sqlite_master ","                WHERE type='table' AND name LIKE 'tcpdump_%' ","                AND name NOT LIKE '%_template'","                ORDER BY name DESC LIMIT 1","            \"\"\")","            tcpdump_table = cursor.fetchone()","            ","            if tcpdump_table:","                cursor.execute(f\"\"\"","                    SELECT DISTINCT src_ip FROM {tcpdump_table['name']} ","                    WHERE src_ip != '' AND src_ip NOT LIKE '127.%' AND src_ip != '::1'","                    LIMIT 20","                \"\"\")","                src_ips = [row['src_ip'] for row in cursor.fetchall()]","                ","                cursor.execute(f\"\"\"","                    SELECT DISTINCT dest_ip FROM {tcpdump_table['name']} ","                    WHERE dest_ip != '' AND dest_ip NOT LIKE '127.%' AND dest_ip != '::1'","                    LIMIT 20","                \"\"\")","                dest_ips = [row['dest_ip'] for row in cursor.fetchall()]","                ","                all_ips = list(set(src_ips + dest_ips))","                analysis_data['network_summary']['unique_ips'] = all_ips[:20]","                ","            # Get OS information from p0f","            cursor.execute(\"\"\"","                SELECT name FROM sqlite_master ","                WHERE type='table' AND name LIKE 'p0f_%' ","                AND name NOT LIKE '%_template'","                ORDER BY name DESC LIMIT 1","            \"\"\")","            p0f_table = cursor.fetchone()","            ","            if p0f_table:","                cursor.execute(f\"\"\"","                    SELECT DISTINCT src_ip, os_name, os_flavor ","                    FROM {p0f_table['name']} ","                    WHERE os_name != '' AND os_name IS NOT NULL","                    LIMIT 20","                \"\"\")","                os_data = cursor.fetchall()","                for row in os_data:","                    os_label = row['os_name']","                    if row['os_flavor']:","                        os_label = f\"{row['os_name']} ({row['os_flavor']})\"","                    if os_label not in analysis_data['network_summary']['os_distribution']:","                        analysis_data['network_summary']['os_distribution'][os_label] = 0","                    analysis_data['network_summary']['os_distribution'][os_label] += 1","                    ","        except Exception as e:","            print(f\"Error getting device IPs: {e}\")","        "],"tokenizedAddedLines":[1000479,1000480,1000481,1000482,72,47,1000483,203,1000484,1000485,423,1000486,425,426,427,1000487,273,1000488,1000489,1000490,1000491,1000492,1000493,1000494,82,1000489,1000495,1000496,1000492,1000493,1000497,82,1000498,1000499,82,1000500,1000485,423,1000501,425,426,427,1000502,273,1000503,1000489,1000504,1000505,1000506,1000492,1000493,1000507,1000508,1000509,1000510,1000511,1000512,1000513,1000514,1000515,1000516,1000517,47]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}