{"fsPath":"\\home\\jarvis\\NetGuard\\web\\app.py","fileUuid":"f7bea0f3-76cb-4c58-8ce4-ad92713e858c","fileSizeBytes":21943,"numLines":552,"diffChanges":[{"originalStartLineNumberOneIndexed":84,"originalEndLineNumberExclusiveOneIndexed":85,"modifiedStartLineNumberOneIndexed":84,"modifiedEndLineNumberExclusiveOneIndexed":90,"addedLines":["            'suspicious_activity': [],","            'http_hosts': {},","            'dns_queries': {},","            'tls_servers': {},","            'countries': {},","            'tcp_flags_distribution': {'SYN': 0, 'ACK': 0, 'FIN': 0, 'RST': 0}"],"tokenizedAddedLines":[1000314,1000315,1000316,1000317,1000318,1000319]},{"originalStartLineNumberOneIndexed":129,"originalEndLineNumberExclusiveOneIndexed":131,"modifiedStartLineNumberOneIndexed":134,"modifiedEndLineNumberExclusiveOneIndexed":174,"addedLines":["                # Collect HTTP hosts","                cursor.execute(f\"SELECT http_host, COUNT(*) as cnt FROM {table} WHERE http_host IS NOT NULL AND http_host != '' GROUP BY http_host ORDER BY cnt DESC LIMIT 10\")","                for row in cursor.fetchall():","                    host = row[0]","                    count = row[1]","                    stats['http_hosts'][host] = stats['http_hosts'].get(host, 0) + count","                ","                # Collect DNS queries","                cursor.execute(f\"SELECT dns_query, COUNT(*) as cnt FROM {table} WHERE dns_query IS NOT NULL AND dns_query != '' GROUP BY dns_query ORDER BY cnt DESC LIMIT 10\")","                for row in cursor.fetchall():","                    query = row[0]","                    count = row[1]","                    stats['dns_queries'][query] = stats['dns_queries'].get(query, 0) + count","                ","                # Collect TLS server names","                cursor.execute(f\"SELECT tls_server_name, COUNT(*) as cnt FROM {table} WHERE tls_server_name IS NOT NULL AND tls_server_name != '' GROUP BY tls_server_name ORDER BY cnt DESC LIMIT 10\")","                for row in cursor.fetchall():","                    server = row[0]","                    count = row[1]","                    stats['tls_servers'][server] = stats['tls_servers'].get(server, 0) + count","                ","                # Collect country distribution","                cursor.execute(f\"SELECT dest_country, COUNT(*) as cnt FROM {table} WHERE dest_country IS NOT NULL GROUP BY dest_country ORDER BY cnt DESC\")","                for row in cursor.fetchall():","                    country = row[0]","                    count = row[1]","                    stats['countries'][country] = stats['countries'].get(country, 0) + count","                ","                # TCP flags distribution","                cursor.execute(f\"SELECT SUM(tcp_syn), SUM(tcp_ack), SUM(tcp_fin), SUM(tcp_rst) FROM {table}\")","                flags = cursor.fetchone()","                if flags:","                    stats['tcp_flags_distribution']['SYN'] += flags[0] or 0","                    stats['tcp_flags_distribution']['ACK'] += flags[1] or 0","                    stats['tcp_flags_distribution']['FIN'] += flags[2] or 0","                    stats['tcp_flags_distribution']['RST'] += flags[3] or 0","                ","                # Step 6: Enhanced anomaly detection patterns","                ","                # 1. High port numbers (potential backdoors)"],"tokenizedAddedLines":[1000320,1000321,72,1000322,74,1000323,77,1000324,1000325,72,1000326,74,1000327,77,1000328,1000329,72,1000330,74,1000331,77,1000332,1000333,72,1000334,74,1000335,77,1000336,1000337,1000338,1000339,1000340,1000341,1000342,1000343,77,1000344,77,1000345]},{"originalStartLineNumberOneIndexed":134,"originalEndLineNumberExclusiveOneIndexed":136,"modifiedStartLineNumberOneIndexed":177,"modifiedEndLineNumberExclusiveOneIndexed":218,"addedLines":["                        'type': 'Backdoor Port Activity',","                        'detail': f'Unusual high port {row[0]}: {row[1]} connections',","                        'severity': 'high'","                    })","                ","                # 2. Port scan detection (SYN without ACK)","                cursor.execute(f\"SELECT COUNT(*) as syn_no_ack FROM {table} WHERE tcp_syn = 1 AND tcp_ack = 0\")","                syn_no_ack = cursor.fetchone()[0]","                if syn_no_ack > 50:","                    stats['suspicious_activity'].append({","                        'type': 'Port Scan Detected',","                        'detail': f'{syn_no_ack} SYN packets without ACK (scanning activity)',","                        'severity': 'high'","                    })","                ","                # 3. DNS tunneling detection (very long queries)","                cursor.execute(f\"SELECT dns_query, LENGTH(dns_query) as len FROM {table} WHERE dns_query IS NOT NULL AND LENGTH(dns_query) > 100 LIMIT 5\")","                for row in cursor.fetchall():","                    if row[0]:","                        stats['suspicious_activity'].append({","                            'type': 'DNS Tunneling Suspected',","                            'detail': f'Abnormally long DNS query ({row[1]} chars): {row[0][:50]}...',","                            'severity': 'high'","                        })","                ","                # 4. Connection resets (potential attacks or blocked connections)","                cursor.execute(f\"SELECT COUNT(*) as rst_count FROM {table} WHERE tcp_rst = 1\")","                rst_count = cursor.fetchone()[0]","                if rst_count > 100:","                    stats['suspicious_activity'].append({","                        'type': 'High RST Packet Count',","                        'detail': f'{rst_count} connection resets detected',","                        'severity': 'medium'","                    })","                ","                # 5. Suspicious countries (customize based on your threat model)","                cursor.execute(f\"SELECT dest_country, COUNT(*) as cnt FROM {table} WHERE dest_country IS NOT NULL AND dest_country NOT IN ('US', 'Local') GROUP BY dest_country HAVING cnt > 20\")","                for row in cursor.fetchall():","                    stats['suspicious_activity'].append({","                        'type': 'Foreign Traffic Pattern',","                        'detail': f'High volume to {row[0]}: {row[1]} connections',"],"tokenizedAddedLines":[1000346,1000347,1000348,105,77,1000349,1000350,1000351,1000352,101,1000353,1000354,1000348,105,77,1000355,1000356,72,1000357,1000358,1000359,1000360,1000361,1000362,77,1000363,1000364,1000365,1000366,101,1000367,1000368,104,105,77,1000369,1000370,72,101,1000371,1000372]},{"originalStartLineNumberOneIndexed":139,"originalEndLineNumberExclusiveOneIndexed":139,"modifiedStartLineNumberOneIndexed":221,"modifiedEndLineNumberExclusiveOneIndexed":231,"addedLines":["                # 6. Low TTL values (potential IP spoofing)","                cursor.execute(f\"SELECT COUNT(*) as low_ttl FROM {table} WHERE ip_ttl < 32 AND ip_ttl > 0\")","                low_ttl = cursor.fetchone()[0]","                if low_ttl > 10:","                    stats['suspicious_activity'].append({","                        'type': 'IP Spoofing Suspected',","                        'detail': f'{low_ttl} packets with abnormally low TTL (<32)',","                        'severity': 'high'","                    })","                "],"tokenizedAddedLines":[1000373,1000374,1000375,1000376,101,1000377,1000378,1000348,105,77]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}