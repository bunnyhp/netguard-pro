{"fsPath":"\\home\\jarvis\\NetGuard\\scripts\\tshark_collector.py","fileUuid":"7fefb871-f997-4703-9851-ad565c731511","fileSizeBytes":13358,"numLines":348,"diffChanges":[{"originalStartLineNumberOneIndexed":13,"originalEndLineNumberExclusiveOneIndexed":13,"modifiedStartLineNumberOneIndexed":13,"modifiedEndLineNumberExclusiveOneIndexed":14,"addedLines":["import re"],"tokenizedAddedLines":[1000174]},{"originalStartLineNumberOneIndexed":20,"originalEndLineNumberExclusiveOneIndexed":22,"modifiedStartLineNumberOneIndexed":21,"modifiedEndLineNumberExclusiveOneIndexed":23,"addedLines":["COLLECT_INTERVAL = 310  # Step 4: Increased to 5 min 10 sec for better pattern detection","CAPTURE_DURATION = 300  # Step 4: Increased to 5 minutes for comprehensive capture"],"tokenizedAddedLines":[1000175,1000176]},{"originalStartLineNumberOneIndexed":33,"originalEndLineNumberExclusiveOneIndexed":33,"modifiedStartLineNumberOneIndexed":34,"modifiedEndLineNumberExclusiveOneIndexed":56,"addedLines":["def get_geoip_info(ip_address):","    \"\"\"Get GeoIP information for an IP address - Step 5\"\"\"","    if not ip_address or ip_address == '':","        return None, None","    ","    # Skip private/local IPs","    if ip_address.startswith(('192.168.', '10.', '172.16.', '127.', 'fe80:', '::1')):","        return 'Local', 'Private Network'","    ","    try:","        result = subprocess.run(['geoiplookup', ip_address], ","                              capture_output=True, text=True, timeout=2)","        if result.returncode == 0 and result.stdout:","            # Parse output: \"GeoIP Country Edition: US, United States\"","            match = re.search(r':\\s*([A-Z]{2}),\\s*(.+)', result.stdout)","            if match:","                return match.group(1), match.group(2).strip()","    except:","        pass","    ","    return None, None",""],"tokenizedAddedLines":[1000177,1000178,1000179,1000180,162,1000181,1000182,1000183,162,52,1000184,1000185,1000186,1000187,1000188,1000189,1000190,1000191,1000192,162,1000193,5]},{"originalStartLineNumberOneIndexed":49,"originalEndLineNumberExclusiveOneIndexed":49,"modifiedStartLineNumberOneIndexed":72,"modifiedEndLineNumberExclusiveOneIndexed":93,"addedLines":["        tcp_flags TEXT,","        tcp_syn INTEGER,","        tcp_ack INTEGER,","        tcp_fin INTEGER,","        tcp_rst INTEGER,","        ip_ttl INTEGER,","        tcp_window_size INTEGER,","        http_host TEXT,","        http_uri TEXT,","        http_method TEXT,","        http_user_agent TEXT,","        http_response_code INTEGER,","        dns_query TEXT,","        dns_query_type TEXT,","        dns_response TEXT,","        tls_handshake_type TEXT,","        tls_server_name TEXT,","        dest_country TEXT,","        dest_city TEXT,","        is_suspicious INTEGER DEFAULT 0,","        threat_score INTEGER DEFAULT 0,"],"tokenizedAddedLines":[1000194,1000195,1000196,1000197,1000198,1000199,1000200,1000201,1000202,1000203,1000204,1000205,1000206,1000207,1000208,1000209,1000210,1000211,1000212,1000213,1000214]},{"originalStartLineNumberOneIndexed":65,"originalEndLineNumberExclusiveOneIndexed":65,"modifiedStartLineNumberOneIndexed":109,"modifiedEndLineNumberExclusiveOneIndexed":111,"addedLines":["        # Step 2: BPF filter (commented out for now - uncomment after testing)","        # '-f', 'not (arp or (icmp6 and ip6[40] == 135) or (icmp6 and ip6[40] == 136))',"],"tokenizedAddedLines":[1000215,1000216]},{"originalStartLineNumberOneIndexed":93,"originalEndLineNumberExclusiveOneIndexed":94,"modifiedStartLineNumberOneIndexed":139,"modifiedEndLineNumberExclusiveOneIndexed":159,"addedLines":["            '-e', 'frame.protocols',","            # Enhancement Step 1: More packet details","            '-e', 'tcp.flags',","            '-e', 'tcp.flags.syn',","            '-e', 'tcp.flags.ack',","            '-e', 'tcp.flags.fin',","            '-e', 'tcp.flags.reset',","            '-e', 'ip.ttl',","            '-e', 'tcp.window_size_value',","            # Enhancement Step 3: Deep packet inspection","            '-e', 'http.host',","            '-e', 'http.request.uri',","            '-e', 'http.request.method',","            '-e', 'http.user_agent',","            '-e', 'http.response.code',","            '-e', 'dns.qry.name',","            '-e', 'dns.qry.type',","            '-e', 'dns.a',","            '-e', 'tls.handshake.type',","            '-e', 'tls.handshake.extensions_server_name'"],"tokenizedAddedLines":[1000217,1000218,1000219,1000220,1000221,1000222,1000223,1000224,1000225,1000226,1000227,1000228,1000229,1000230,1000231,1000232,1000233,1000234,1000235,1000236]},{"originalStartLineNumberOneIndexed":124,"originalEndLineNumberExclusiveOneIndexed":124,"modifiedStartLineNumberOneIndexed":189,"modifiedEndLineNumberExclusiveOneIndexed":190,"addedLines":["                # Basic fields"],"tokenizedAddedLines":[1000237]},{"originalStartLineNumberOneIndexed":130,"originalEndLineNumberExclusiveOneIndexed":131,"modifiedStartLineNumberOneIndexed":196,"modifiedEndLineNumberExclusiveOneIndexed":197,"addedLines":["                info = ''"],"tokenizedAddedLines":[1000238]},{"originalStartLineNumberOneIndexed":136,"originalEndLineNumberExclusiveOneIndexed":136,"modifiedStartLineNumberOneIndexed":202,"modifiedEndLineNumberExclusiveOneIndexed":236,"addedLines":["                # TCP flags and details","                tcp_flags = layers.get('tcp.flags', [''])[0]","                tcp_syn = 1 if layers.get('tcp.flags.syn', [''])[0] == '1' else 0","                tcp_ack = 1 if layers.get('tcp.flags.ack', [''])[0] == '1' else 0","                tcp_fin = 1 if layers.get('tcp.flags.fin', [''])[0] == '1' else 0","                tcp_rst = 1 if layers.get('tcp.flags.reset', [''])[0] == '1' else 0","                ip_ttl = layers.get('ip.ttl', [''])[0]","                tcp_window_size = layers.get('tcp.window_size_value', [''])[0]","                ","                # HTTP details","                http_host = layers.get('http.host', [''])[0]","                http_uri = layers.get('http.request.uri', [''])[0]","                http_method = layers.get('http.request.method', [''])[0]","                http_user_agent = layers.get('http.user_agent', [''])[0]","                http_response_code = layers.get('http.response.code', [''])[0]","                ","                # DNS details","                dns_query = layers.get('dns.qry.name', [''])[0]","                dns_query_type = layers.get('dns.qry.type', [''])[0]","                dns_response = layers.get('dns.a', [''])[0]","                ","                # TLS/SSL details","                tls_handshake_type = layers.get('tls.handshake.type', [''])[0]","                tls_server_name = layers.get('tls.handshake.extensions_server_name', [''])[0]","                ","                # Step 5: GeoIP lookup for destination","                dest_country = None","                dest_city = None","                if dest_ip:","                    country_code, country_name = get_geoip_info(dest_ip)","                    if country_code:","                        dest_country = country_code","                        dest_city = country_name","                "],"tokenizedAddedLines":[1000239,1000240,1000241,1000242,1000243,1000244,1000245,1000246,103,1000247,1000248,1000249,1000250,1000251,1000252,103,1000253,1000254,1000255,1000256,103,1000257,1000258,1000259,103,1000260,1000261,1000262,1000263,1000264,1000265,1000266,1000267,103]},{"originalStartLineNumberOneIndexed":142,"originalEndLineNumberExclusiveOneIndexed":142,"modifiedStartLineNumberOneIndexed":242,"modifiedEndLineNumberExclusiveOneIndexed":245,"addedLines":["                    ip_ttl = int(ip_ttl) if ip_ttl else None","                    tcp_window_size = int(tcp_window_size) if tcp_window_size else None","                    http_response_code = int(http_response_code) if http_response_code else None"],"tokenizedAddedLines":[1000268,1000269,1000270]},{"originalStartLineNumberOneIndexed":157,"originalEndLineNumberExclusiveOneIndexed":157,"modifiedStartLineNumberOneIndexed":260,"modifiedEndLineNumberExclusiveOneIndexed":286,"addedLines":["                # Calculate threat score based on patterns","                threat_score = 0","                is_suspicious = 0","                ","                # High ports = suspicious","                if dest_port and dest_port > 50000:","                    threat_score += 3","                    is_suspicious = 1","                ","                # Multiple SYN without ACK = port scan","                if tcp_syn and not tcp_ack:","                    threat_score += 2","                ","                # RST flags = connection refused/reset","                if tcp_rst:","                    threat_score += 1","                ","                # Low TTL = potential spoofing","                if ip_ttl and ip_ttl < 32:","                    threat_score += 2","                    is_suspicious = 1","                ","                # Very small TCP window = potential attack","                if tcp_window_size and tcp_window_size < 1000:","                    threat_score += 1","                "],"tokenizedAddedLines":[1000271,1000272,1000273,103,1000274,1000275,1000276,1000277,103,1000278,1000279,1000280,103,1000281,1000282,1000283,103,1000284,1000285,1000280,1000277,103,1000286,1000287,1000283,103]},{"originalStartLineNumberOneIndexed":160,"originalEndLineNumberExclusiveOneIndexed":162,"modifiedStartLineNumberOneIndexed":289,"modifiedEndLineNumberExclusiveOneIndexed":294,"addedLines":["                     protocol, length, info, tcp_flags, tcp_syn, tcp_ack, tcp_fin, tcp_rst,","                     ip_ttl, tcp_window_size, http_host, http_uri, http_method, http_user_agent,","                     http_response_code, dns_query, dns_query_type, dns_response, ","                     tls_handshake_type, tls_server_name, dest_country, dest_city, is_suspicious, threat_score)","                    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)"],"tokenizedAddedLines":[1000288,1000289,1000290,1000291,1000292]},{"originalStartLineNumberOneIndexed":163,"originalEndLineNumberExclusiveOneIndexed":164,"modifiedStartLineNumberOneIndexed":295,"modifiedEndLineNumberExclusiveOneIndexed":300,"addedLines":["                      dest_ip, dest_port, protocol, frame_len, info[:500] if info else '', tcp_flags, tcp_syn, ","                      tcp_ack, tcp_fin, tcp_rst, ip_ttl, tcp_window_size, http_host, http_uri,","                      http_method, http_user_agent, http_response_code, dns_query, dns_query_type,","                      dns_response, tls_handshake_type, tls_server_name, dest_country, dest_city, ","                      is_suspicious, threat_score))"],"tokenizedAddedLines":[1000293,1000294,1000295,1000296,1000297]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}