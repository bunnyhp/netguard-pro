{"fsPath":"\\home\\jarvis\\NetGuard\\SERVICE_CONFIGURATION.md","fileUuid":"5d6c5a70-ab42-4b18-a9c8-6551e60345d0","fileSizeBytes":8613,"numLines":370,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":371,"addedLines":["# üîß NetGuard Pro - Service Configuration","","## ‚úÖ Service Status","","### **Active Services (2):**","","1. **tshark-collector.service** - Enhanced Packet Capture","   - Status: ‚úÖ **Running**","   - Auto-start: ‚úÖ **Enabled**","   - Restart Policy: ‚úÖ **Always** (auto-restart on crash)","   - User: root (required for packet capture)","   - Working Directory: /home/jarvis/NetGuard","","2. **network-dashboard.service** - Web Interface","   - Status: ‚úÖ **Running**","   - Auto-start: ‚úÖ **Enabled**","   - Port: 8080","   - URL: http://192.168.1.161:8080","","---","","## üõ°Ô∏è Service Features","","### **tshark-collector.service**","","**Capabilities:**","- Captures packets for 5 minutes per cycle","- Analyzes 30+ fields per packet","- Detects 6 types of threats automatically","- GeoIP location tracking","- HTTP/DNS/TLS deep inspection","- Stores in SQLite database","- Runs continuously 24/7","","**Reliability:**","- Auto-restart on crash (within 10 seconds)","- Memory limit: 500MB","- CPU limit: 50%","- Logs: `/home/jarvis/NetGuard/logs/system/tshark-service.log`","- Error logs: `/home/jarvis/NetGuard/logs/system/tshark-service-error.log`","","**Crash Protection:**","```","If service crashes ‚Üí Waits 10 seconds ‚Üí Auto-restarts","If service fails 5 times in 30 seconds ‚Üí Stops (prevents boot loop)","Manual restart: sudo systemctl restart tshark-collector.service","```","","---","","## üìã Service Management Commands","","### **Check Status:**","```bash","# Quick status","systemctl is-active tshark-collector.service","","# Detailed status","systemctl status tshark-collector.service","","# Check if enabled for auto-start","systemctl is-enabled tshark-collector.service","```","","### **Start/Stop/Restart:**","```bash","# Start service","sudo systemctl start tshark-collector.service","","# Stop service","sudo systemctl stop tshark-collector.service","","# Restart service","sudo systemctl restart tshark-collector.service","```","","### **View Logs:**","```bash","# View service logs","journalctl -u tshark-collector.service -f","","# View last 100 lines","journalctl -u tshark-collector.service -n 100","","# View collector logs","tail -f /home/jarvis/NetGuard/logs/system/tshark-service.log","","# View errors only","tail -f /home/jarvis/NetGuard/logs/system/tshark-service-error.log","```","","### **Enable/Disable Auto-start:**","```bash","# Enable auto-start on boot","sudo systemctl enable tshark-collector.service","","# Disable auto-start","sudo systemctl disable tshark-collector.service","```","","---","","## üîÑ What Happens After Reboot","","### **Automatic Startup Sequence:**","","```","1. System Boots","   ‚Üì","2. Network comes online (network-online.target)","   ‚Üì","3. tshark-collector.service starts automatically","   ‚Üì","4. network-dashboard.service starts automatically","   ‚Üì","5. Both services run continuously","   ‚Üì","6. If either crashes ‚Üí Auto-restarts within 10 seconds","```","","### **Service Dependencies:**","- **tshark-collector** requires network to be online","- **network-dashboard** can run independently","- Both are configured for automatic restart","","---","","## üö® Troubleshooting","","### **If Service Fails to Start:**","","```bash","# 1. Check service status","systemctl status tshark-collector.service","","# 2. View recent errors","journalctl -u tshark-collector.service -n 50 --no-pager","","# 3. Check if tshark is installed","which tshark","","# 4. Check permissions","ls -la /home/jarvis/NetGuard/scripts/tshark_collector.py","","# 5. Test manually","sudo python3 /home/jarvis/NetGuard/scripts/tshark_collector.py","```","","### **If Service Keeps Crashing:**","","```bash","# Check memory usage","systemctl show tshark-collector.service -p MemoryCurrent","","# Check crash count","systemctl show tshark-collector.service -p NRestarts","","# View detailed logs","journalctl -u tshark-collector.service --since \"10 minutes ago\"","","# Check disk space","df -h /home/jarvis/NetGuard","```","","### **Common Issues & Solutions:**","","**Issue 1: Service won't start**","```bash","# Solution: Check if another tshark is running","sudo pkill -f tshark","sudo systemctl restart tshark-collector.service","```","","**Issue 2: Permission denied**","```bash","# Solution: Ensure /home/jarvis has correct permissions","sudo chmod 755 /home/jarvis","sudo chmod -R 755 /home/jarvis/NetGuard/captures","```","","**Issue 3: Database locked**","```bash","# Solution: Check if multiple processes accessing database","lsof /home/jarvis/NetGuard/network.db","```","","---","","## üìä Service Monitoring","","### **Health Checks:**","","```bash","# 1. Is service running?","systemctl is-active tshark-collector.service","","# 2. How many times has it restarted?","systemctl show tshark-collector.service -p NRestarts","","# 3. How much memory is it using?","systemctl status tshark-collector.service | grep Memory","","# 4. How long has it been running?","systemctl status tshark-collector.service | grep Active","","# 5. Check last capture","ls -lt /home/jarvis/NetGuard/captures/tshark/*.pcap | head -1","```","","### **Performance Metrics:**","","```bash","# CPU and Memory usage","systemctl show tshark-collector.service -p CPUUsageNSec -p MemoryCurrent","","# Restart count","systemctl show tshark-collector.service -p NRestarts","","# Service uptime","systemctl show tshark-collector.service -p ActiveEnterTimestamp","```","","---","","## üîê Security Configuration","","### **Service Runs as:**","- **User**: root (required for packet capture)","- **Group**: root","- **Working Directory**: /home/jarvis/NetGuard","","### **Resource Limits:**","- **Memory Maximum**: 500MB","- **CPU Quota**: 50% (prevents CPU hogging)","- **File Descriptors**: 65,535 (plenty for network capture)","","### **Security Policies:**","- Automatic restart on failure","- Isolated temporary directory","- Environment variables sanitized","- Python unbuffered output (real-time logs)","","---","","## üìù Service File Location","","**Service Definition:**","```","/etc/systemd/system/tshark-collector.service","```","","**Source (for backup/editing):**","```","/home/jarvis/NetGuard/services/tshark-collector.service","```","","**To Edit Service:**","```bash","# 1. Edit source file","nano /home/jarvis/NetGuard/services/tshark-collector.service","","# 2. Copy to systemd","sudo cp /home/jarvis/NetGuard/services/tshark-collector.service /etc/systemd/system/","","# 3. Reload systemd","sudo systemctl daemon-reload","","# 4. Restart service","sudo systemctl restart tshark-collector.service","```","","---","","## üéØ What's Protected Against Reboot","","### **‚úÖ Will Survive Reboot:**","1. tshark collector service (auto-starts)","2. Web dashboard service (auto-starts)","3. Database schema and data","4. Configuration files","5. Capture directories","6. Service logs","","### **‚ö†Ô∏è Will Be Lost After Reboot:**","- Capture PCAP files in /captures/tshark/ (auto-cleaned)","- Temporary network connections","- Process IDs (will get new PIDs)","","### **Recommended Before Reboot:**","```bash","# 1. Backup database","cp /home/jarvis/NetGuard/network.db /home/jarvis/NetGuard/network.db.backup","","# 2. Check services are enabled","systemctl is-enabled tshark-collector.service network-dashboard.service","","# 3. Archive important captures (optional)","tar -czf captures_backup_$(date +%Y%m%d).tar.gz captures/","","# 4. Verify auto-start","systemctl list-unit-files | grep netguard","```","","---","","## üöÄ Quick Command Reference","","```bash","# Start everything","sudo systemctl start tshark-collector.service network-dashboard.service","","# Stop everything","sudo systemctl stop tshark-collector.service","","# Restart tshark only","sudo systemctl restart tshark-collector.service","","# View live logs","journalctl -u tshark-collector.service -f","","# Check if will auto-start","systemctl list-unit-files | grep tshark","","# Disable auto-start (if needed)","sudo systemctl disable tshark-collector.service","```","","---","","## ‚úÖ Current Service Status Summary","","**‚úì tshark-collector.service**","- Status: **RUNNING** ‚úÖ","- Auto-start: **ENABLED** ‚úÖ  ","- Restart Policy: **ALWAYS** ‚úÖ","- Capturing: Every 5 minutes ‚úÖ","- Enhanced Features: All 7 active ‚úÖ","","**‚úì network-dashboard.service**","- Status: **RUNNING** ‚úÖ","- Auto-start: **ENABLED** ‚úÖ","- Port: 8080 ‚úÖ","- Accessible: http://192.168.1.161:8080 ‚úÖ","","**üéâ System is fully configured and will survive reboots!**","","---","","## üîÑ Reboot Safety Checklist","","Before rebooting, verify:","- [ ] Services are **enabled**: `systemctl is-enabled tshark-collector.service`","- [ ] Database exists: `ls -lh /home/jarvis/NetGuard/network.db`","- [ ] Service files in place: `ls /etc/systemd/system/tshark-collector.service`","- [ ] Logs directory writable: `ls -ld /home/jarvis/NetGuard/logs`","- [ ] Captures directory exists: `ls -ld /home/jarvis/NetGuard/captures/tshark`","","After reboot, verify:","- [ ] Check service started: `systemctl status tshark-collector.service`","- [ ] Check dashboard: `curl http://localhost:8080`","- [ ] Check data collecting: `ls /home/jarvis/NetGuard/captures/tshark/`","- [ ] View logs: `journalctl -u tshark-collector.service -n 20`","","**DO NOT REBOOT until you've reviewed this checklist and confirmed you want to proceed!**","","---","","**Service is now production-ready and will survive reboots!** üéâ","",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000001,1000003,1000001,1000004,1000005,1000006,1000007,1000008,1000009,1000001,1000010,1000005,1000006,1000011,1000012,1000001,1000013,1000001,1000014,1000001,1000015,1000001,1000016,1000017,1000018,1000019,1000020,1000021,1000022,1000023,1000001,1000024,1000025,1000026,1000027,1000028,1000029,1000001,1000030,1000031,1000032,1000033,1000034,1000031,1000001,1000013,1000001,1000035,1000001,1000036,1000037,1000038,1000039,1000001,1000040,1000041,1000001,1000042,1000043,1000031,1000001,1000044,1000037,1000045,1000046,1000001,1000047,1000048,1000001,1000049,1000050,1000031,1000001,1000051,1000037,1000052,1000053,1000001,1000054,1000055,1000001,1000056,1000057,1000001,1000058,1000059,1000031,1000001,1000060,1000037,1000061,1000062,1000001,1000063,1000064,1000031,1000001,1000013,1000001,1000065,1000001,1000066,1000001,1000031,1000067,1000068,1000069,1000068,1000070,1000068,1000071,1000068,1000072,1000068,1000073,1000031,1000001,1000074,1000075,1000076,1000077,1000001,1000013,1000001,1000078,1000001,1000079,1000001,1000037,1000080,1000041,1000001,1000081,1000082,1000001,1000083,1000084,1000001,1000085,1000086,1000001,1000087,1000088,1000031,1000001,1000089,1000001,1000037,1000090,1000091,1000001,1000092,1000093,1000001,1000094,1000095,1000001,1000096,1000097,1000031,1000001,1000098,1000001,1000099,1000037,1000100,1000101,1000050,1000031,1000001,1000102,1000037,1000103,1000104,1000105,1000031,1000001,1000106,1000037,1000107,1000108,1000031,1000001,1000013,1000001,1000109,1000001,1000110,1000001,1000037,1000111,1000039,1000001,1000112,1000093,1000001,1000113,1000114,1000001,1000115,1000116,1000001,1000117,1000118,1000031,1000001,1000119,1000001,1000037,1000120,1000121,1000001,1000122,1000093,1000001,1000123,1000124,1000031,1000001,1000013,1000001,1000125,1000001,1000126,1000127,1000128,1000129,1000001,1000130,1000131,1000132,1000133,1000001,1000134,1000135,1000136,1000137,1000138,1000001,1000013,1000001,1000139,1000001,1000140,1000031,1000141,1000031,1000001,1000142,1000031,1000143,1000031,1000001,1000144,1000037,1000145,1000146,1000001,1000147,1000148,1000001,1000149,1000150,1000001,1000151,1000050,1000031,1000001,1000013,1000001,1000152,1000001,1000153,1000154,1000155,1000156,1000157,1000158,1000159,1000001,1000160,1000161,1000162,1000163,1000001,1000164,1000037,1000165,1000166,1000001,1000167,1000168,1000001,1000169,1000170,1000001,1000171,1000172,1000031,1000001,1000013,1000001,1000173,1000001,1000037,1000174,1000175,1000001,1000176,1000048,1000001,1000177,1000050,1000001,1000178,1000053,1000001,1000179,1000180,1000001,1000181,1000064,1000031,1000001,1000013,1000001,1000182,1000001,1000183,1000184,1000185,1000186,1000187,1000188,1000001,1000189,1000184,1000190,1000191,1000192,1000001,1000193,1000001,1000013,1000001,1000194,1000001,1000195,1000196,1000197,1000198,1000199,1000200,1000001,1000201,1000202,1000203,1000204,1000205,1000001,1000206,1000001,1000013,1000001,1000207,1000001,1000001]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}