{"fsPath":"\\home\\jarvis\\NetGuard\\scripts\\ngrep_collector.py","fileUuid":"314f9544-01a7-4d65-a2ee-7fd5731ce9b9","fileSizeBytes":11714,"numLines":331,"diffChanges":[{"originalStartLineNumberOneIndexed":26,"originalEndLineNumberExclusiveOneIndexed":27,"modifiedStartLineNumberOneIndexed":26,"modifiedEndLineNumberExclusiveOneIndexed":27,"addedLines":["    level=logging.DEBUG,  # Changed to DEBUG for troubleshooting"],"tokenizedAddedLines":[1000228]},{"originalStartLineNumberOneIndexed":36,"originalEndLineNumberExclusiveOneIndexed":36,"modifiedStartLineNumberOneIndexed":36,"modifiedEndLineNumberExclusiveOneIndexed":37,"addedLines":["log_fd = None  # Keep file descriptor open"],"tokenizedAddedLines":[1000229]},{"originalStartLineNumberOneIndexed":74,"originalEndLineNumberExclusiveOneIndexed":75,"modifiedStartLineNumberOneIndexed":75,"modifiedEndLineNumberExclusiveOneIndexed":76,"addedLines":["    global ngrep_process, log_fd"],"tokenizedAddedLines":[1000230]},{"originalStartLineNumberOneIndexed":77,"originalEndLineNumberExclusiveOneIndexed":78,"modifiedStartLineNumberOneIndexed":78,"modifiedEndLineNumberExclusiveOneIndexed":79,"addedLines":["        # Clear old log and reset position"],"tokenizedAddedLines":[1000231]},{"originalStartLineNumberOneIndexed":80,"originalEndLineNumberExclusiveOneIndexed":83,"modifiedStartLineNumberOneIndexed":81,"modifiedEndLineNumberExclusiveOneIndexed":82,"addedLines":["        save_position(0)  # Reset position since we're starting fresh"],"tokenizedAddedLines":[1000232]},{"originalStartLineNumberOneIndexed":86,"originalEndLineNumberExclusiveOneIndexed":87,"modifiedStartLineNumberOneIndexed":85,"modifiedEndLineNumberExclusiveOneIndexed":86,"addedLines":["        # Start ngrep with output to file"],"tokenizedAddedLines":[1000233]},{"originalStartLineNumberOneIndexed":88,"originalEndLineNumberExclusiveOneIndexed":90,"modifiedStartLineNumberOneIndexed":87,"modifiedEndLineNumberExclusiveOneIndexed":88,"addedLines":["        # -W: byline output (makes output more readable)"],"tokenizedAddedLines":[1000234]},{"originalStartLineNumberOneIndexed":91,"originalEndLineNumberExclusiveOneIndexed":94,"modifiedStartLineNumberOneIndexed":89,"modifiedEndLineNumberExclusiveOneIndexed":96,"addedLines":["        # -q: quiet (don't print # progress)","        # Pattern: Match GET, POST, password, pwd, login, user","        ","        log_fd = open(NGREP_LOG, 'w', buffering=1)  # Line buffering","        ","        # Note: ngrep pattern must be a single argument with proper regex","        # Using empty pattern and tcp filter to capture all TCP, then filter in parser"],"tokenizedAddedLines":[1000235,1000236,72,1000237,72,1000238,1000239]},{"originalStartLineNumberOneIndexed":98,"originalEndLineNumberExclusiveOneIndexed":99,"modifiedStartLineNumberOneIndexed":100,"modifiedEndLineNumberExclusiveOneIndexed":100},{"originalStartLineNumberOneIndexed":100,"originalEndLineNumberExclusiveOneIndexed":103,"modifiedStartLineNumberOneIndexed":101,"modifiedEndLineNumberExclusiveOneIndexed":104,"addedLines":["            '',  # Empty pattern = match all","            'tcp port 80 or tcp port 443 or tcp port 8080'","        ], stdout=log_fd, stderr=subprocess.PIPE, bufsize=0)  # No buffering for immediate write"],"tokenizedAddedLines":[1000240,1000241,1000242]},{"originalStartLineNumberOneIndexed":108,"originalEndLineNumberExclusiveOneIndexed":108,"modifiedStartLineNumberOneIndexed":109,"modifiedEndLineNumberExclusiveOneIndexed":110,"addedLines":["            logging.info(f\"âœ“ Writing to: {NGREP_LOG}\")"],"tokenizedAddedLines":[1000243]},{"originalStartLineNumberOneIndexed":112,"originalEndLineNumberExclusiveOneIndexed":112,"modifiedStartLineNumberOneIndexed":114,"modifiedEndLineNumberExclusiveOneIndexed":115,"addedLines":["            log_fd.close()"],"tokenizedAddedLines":[1000244]},{"originalStartLineNumberOneIndexed":119,"originalEndLineNumberExclusiveOneIndexed":120,"modifiedStartLineNumberOneIndexed":122,"modifiedEndLineNumberExclusiveOneIndexed":125,"addedLines":["    \"\"\"Parse ngrep log entry (multiple lines)","    Format: T 2025/10/11 04:04:28.179202 192.168.1.100:59780 -> 93.184.216.34:80 [AP] #4","    \"\"\""],"tokenizedAddedLines":[1000245,1000246,61]},{"originalStartLineNumberOneIndexed":128,"originalEndLineNumberExclusiveOneIndexed":130,"modifiedStartLineNumberOneIndexed":133,"modifiedEndLineNumberExclusiveOneIndexed":140,"addedLines":["            # Skip interface/filter info lines","            if line.startswith('interface:') or line.startswith('filter:') or line.startswith('match') or line.startswith('####'):","                continue","            ","            # Parse connection line: T 2025/10/11 04:04:28.179202 192.168.1.100:59780 -> 93.184.216.34:80 [AP]","            # Or IPv6: T 2025/10/11 04:12:30.074187 2603:8080:bb00:395f:d0d8:3c2f:e475:3837:38896 -> 2600:1408:ec00:36::1736:7f24:80 [AP]","            if '->' in line and (line.startswith('T ') or line.startswith('U ')):"],"tokenizedAddedLines":[1000247,1000248,197,100,1000249,1000250,1000251]},{"originalStartLineNumberOneIndexed":138,"originalEndLineNumberExclusiveOneIndexed":139,"modifiedStartLineNumberOneIndexed":148,"modifiedEndLineNumberExclusiveOneIndexed":149,"addedLines":["                # Try IPv4 format first"],"tokenizedAddedLines":[1000252]},{"originalStartLineNumberOneIndexed":145,"originalEndLineNumberExclusiveOneIndexed":148,"modifiedStartLineNumberOneIndexed":155,"modifiedEndLineNumberExclusiveOneIndexed":170,"addedLines":["                else:","                    # Try IPv6 format: extract last segment as port","                    # Format: ipv6:port -> ipv6:port","                    match = re.search(r'([0-9a-f:]+):(\\d+)\\s*->\\s*([0-9a-f:]+):(\\d+)', line, re.IGNORECASE)","                    if match:","                        data['src_ip'] = match.group(1)","                        data['src_port'] = int(match.group(2))","                        data['dest_ip'] = match.group(3)","                        data['dest_port'] = int(match.group(4))","                    else:","                        # Can't parse, skip this entry","                        continue","            ","            # Collect matched data (lines after the T/U line)","            elif line.strip() and not line.startswith('T ') and not line.startswith('U '):"],"tokenizedAddedLines":[119,1000253,1000254,1000255,1000256,1000257,1000258,1000259,1000260,1000261,1000262,1000263,100,1000264,1000265]},{"originalStartLineNumberOneIndexed":165,"originalEndLineNumberExclusiveOneIndexed":165,"modifiedStartLineNumberOneIndexed":187,"modifiedEndLineNumberExclusiveOneIndexed":188,"addedLines":["            logging.debug(f\"ngrep log file does not exist: {NGREP_LOG}\")"],"tokenizedAddedLines":[1000266]},{"originalStartLineNumberOneIndexed":169,"originalEndLineNumberExclusiveOneIndexed":169,"modifiedStartLineNumberOneIndexed":192,"modifiedEndLineNumberExclusiveOneIndexed":193,"addedLines":["        logging.debug(f\"Last position: {last_pos}\")"],"tokenizedAddedLines":[1000267]},{"originalStartLineNumberOneIndexed":176,"originalEndLineNumberExclusiveOneIndexed":176,"modifiedStartLineNumberOneIndexed":200,"modifiedEndLineNumberExclusiveOneIndexed":202,"addedLines":["        logging.debug(f\"Read {len(new_lines)} new lines from ngrep log\")","        "],"tokenizedAddedLines":[1000268,72]},{"originalStartLineNumberOneIndexed":182,"originalEndLineNumberExclusiveOneIndexed":182,"modifiedStartLineNumberOneIndexed":208,"modifiedEndLineNumberExclusiveOneIndexed":214,"addedLines":["        ","        # Interesting patterns to filter","        interesting_patterns = ['GET', 'POST', 'password', 'pwd', 'login', 'user', 'HTTP', 'Host:']","        ","        matched_entries = 0","        total_entries = 0"],"tokenizedAddedLines":[72,1000269,1000270,72,1000271,1000272]},{"originalStartLineNumberOneIndexed":187,"originalEndLineNumberExclusiveOneIndexed":187,"modifiedStartLineNumberOneIndexed":219,"modifiedEndLineNumberExclusiveOneIndexed":224,"addedLines":["                    total_entries += 1","                    # Check if entry contains interesting data","                    entry_text = ' '.join(current_entry_lines)","                    if any(pattern in entry_text for pattern in interesting_patterns):","                        matched_entries += 1"],"tokenizedAddedLines":[1000273,1000274,1000275,1000276,1000277]},{"originalStartLineNumberOneIndexed":190,"originalEndLineNumberExclusiveOneIndexed":190,"modifiedStartLineNumberOneIndexed":227,"modifiedEndLineNumberExclusiveOneIndexed":228,"addedLines":["                            logging.debug(f\"Parsed entry: {parsed.get('src_ip')} -> {parsed.get('dest_ip')}\")"],"tokenizedAddedLines":[1000278]},{"originalStartLineNumberOneIndexed":196,"originalEndLineNumberExclusiveOneIndexed":196,"modifiedStartLineNumberOneIndexed":234,"modifiedEndLineNumberExclusiveOneIndexed":238,"addedLines":["            total_entries += 1","            entry_text = ' '.join(current_entry_lines)","            if any(pattern in entry_text for pattern in interesting_patterns):","                matched_entries += 1"],"tokenizedAddedLines":[1000279,1000280,1000281,1000282]},{"originalStartLineNumberOneIndexed":199,"originalEndLineNumberExclusiveOneIndexed":199,"modifiedStartLineNumberOneIndexed":241,"modifiedEndLineNumberExclusiveOneIndexed":244,"addedLines":["                    logging.debug(f\"Parsed entry: {parsed.get('src_ip')} -> {parsed.get('dest_ip')}\")","        ","        logging.debug(f\"Total entries: {total_entries}, Matched: {matched_entries}, Parsed successfully: {len(entries)}\")"],"tokenizedAddedLines":[1000283,72,1000284]},{"originalStartLineNumberOneIndexed":274,"originalEndLineNumberExclusiveOneIndexed":274,"modifiedStartLineNumberOneIndexed":319,"modifiedEndLineNumberExclusiveOneIndexed":321,"addedLines":["        if log_fd:","            log_fd.close()"],"tokenizedAddedLines":[1000285,1000244]},{"originalStartLineNumberOneIndexed":278,"originalEndLineNumberExclusiveOneIndexed":278,"modifiedStartLineNumberOneIndexed":325,"modifiedEndLineNumberExclusiveOneIndexed":327,"addedLines":["        if log_fd:","            log_fd.close()"],"tokenizedAddedLines":[1000285,1000244]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}