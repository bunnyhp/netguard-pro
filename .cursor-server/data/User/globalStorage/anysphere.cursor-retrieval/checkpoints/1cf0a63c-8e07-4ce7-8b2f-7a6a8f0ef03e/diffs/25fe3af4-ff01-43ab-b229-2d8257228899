{"fsPath":"\\home\\jarvis\\NetGuard\\web\\app.py","fileUuid":"25fe3af4-ff01-43ab-b229-2d8257228899","fileSizeBytes":26448,"numLines":688,"diffChanges":[{"originalStartLineNumberOneIndexed":555,"originalEndLineNumberExclusiveOneIndexed":555,"modifiedStartLineNumberOneIndexed":555,"modifiedEndLineNumberExclusiveOneIndexed":684,"addedLines":["","@app.route('/ai-dashboard')","def ai_dashboard():","    \"\"\"AI-powered threat detection dashboard\"\"\"","    conn = get_db_connection()","    cursor = conn.cursor()","    ","    # Get latest AI prediction","    cursor.execute(\"\"\"","        SELECT * FROM ai_predictions ","        ORDER BY id DESC LIMIT 1","    \"\"\")","    latest_prediction = cursor.fetchone()","    ","    # Get active alerts","    cursor.execute(\"\"\"","        SELECT * FROM ai_alerts ","        WHERE resolved = 0 ","        ORDER BY ","            CASE priority ","                WHEN 'CRITICAL' THEN 1","                WHEN 'HIGH' THEN 2","                WHEN 'MEDIUM' THEN 3","                WHEN 'LOW' THEN 4","                ELSE 5","            END,","            timestamp DESC","        LIMIT 10","    \"\"\")","    active_alerts = [dict(row) for row in cursor.fetchall()]","    ","    # Get recent threat patterns","    cursor.execute(\"\"\"","        SELECT * FROM threat_patterns ","        WHERE status = 'active'","        ORDER BY confidence DESC","        LIMIT 5","    \"\"\")","    threat_patterns = [dict(row) for row in cursor.fetchall()]","    ","    # Get URL classifications with high risk","    cursor.execute(\"\"\"","        SELECT * FROM url_classifications ","        WHERE risk_score > 0.5","        ORDER BY risk_score DESC","        LIMIT 10","    \"\"\")","    risky_urls = [dict(row) for row in cursor.fetchall()]","    ","    # Get analysis history (last 24 hours)","    cursor.execute(\"\"\"","        SELECT * FROM ai_analysis_history ","        ORDER BY id DESC","        LIMIT 24","    \"\"\")","    analysis_history = [dict(row) for row in cursor.fetchall()]","    ","    # Get device profiles","    cursor.execute(\"\"\"","        SELECT * FROM device_profiles ","        ORDER BY last_updated DESC","        LIMIT 10","    \"\"\")","    devices = [dict(row) for row in cursor.fetchall()]","    ","    conn.close()","    ","    return render_template('ai_dashboard.html',","                         prediction=dict(latest_prediction) if latest_prediction else None,","                         alerts=active_alerts,","                         threat_patterns=threat_patterns,","                         risky_urls=risky_urls,","                         analysis_history=analysis_history,","                         devices=devices)","","","@app.route('/ai-dashboard/alert/<alert_id>/resolve', methods=['POST'])","def resolve_alert(alert_id):","    \"\"\"Mark an alert as resolved\"\"\"","    conn = get_db_connection()","    cursor = conn.cursor()","    ","    cursor.execute(\"\"\"","        UPDATE ai_alerts ","        SET resolved = 1, resolved_at = ?, resolved_by = 'user'","        WHERE alert_id = ?","    \"\"\", (datetime.now().isoformat(), alert_id))","    ","    conn.commit()","    conn.close()","    ","    return jsonify({'success': True})","","","@app.route('/ai-dashboard/api/stats')","def ai_stats_api():","    \"\"\"API endpoint for AI dashboard statistics\"\"\"","    conn = get_db_connection()","    cursor = conn.cursor()","    ","    # Get counts","    cursor.execute(\"SELECT COUNT(*) as count FROM ai_alerts WHERE resolved = 0\")","    active_alerts = cursor.fetchone()['count']","    ","    cursor.execute(\"SELECT COUNT(*) as count FROM ai_predictions\")","    total_analyses = cursor.fetchone()['count']","    ","    cursor.execute(\"SELECT COUNT(*) as count FROM threat_patterns WHERE status = 'active'\")","    active_patterns = cursor.fetchone()['count']","    ","    cursor.execute(\"SELECT COUNT(*) as count FROM url_classifications WHERE risk_score > 0.7\")","    high_risk_urls = cursor.fetchone()['count']","    ","    # Get latest threat level","    cursor.execute(\"SELECT threat_level, network_health_score FROM ai_predictions ORDER BY id DESC LIMIT 1\")","    latest = cursor.fetchone()","    ","    conn.close()","    ","    return jsonify({","        'active_alerts': active_alerts,","        'total_analyses': total_analyses,","        'active_patterns': active_patterns,","        'high_risk_urls': high_risk_urls,","        'threat_level': latest['threat_level'] if latest else 'UNKNOWN',","        'health_score': latest['network_health_score'] if latest else 0","    })","",""],"tokenizedAddedLines":[5,1000377,1000378,1000379,22,23,179,1000380,1000381,1000382,1000383,1000384,1000385,179,1000386,1000381,1000387,1000388,1000389,1000390,1000391,1000392,1000393,1000394,1000395,1000396,1000397,1000398,1000384,1000399,179,1000400,1000381,1000401,1000402,1000403,1000404,1000384,1000405,179,1000406,1000381,1000407,1000408,1000409,1000398,1000384,1000410,179,1000411,1000381,1000412,1000413,1000414,1000384,1000415,179,1000416,1000381,1000417,1000418,1000398,1000384,1000419,179,26,179,1000420,1000421,1000422,1000423,1000424,1000425,1000426,5,5,1000427,1000428,1000429,22,23,179,1000381,1000430,1000431,1000432,1000433,179,1000434,26,179,1000435,5,5,1000436,1000437,1000438,22,23,179,1000439,1000440,1000441,179,1000442,1000443,179,1000444,1000445,179,1000446,1000447,179,1000448,1000449,1000450,179,26,179,1000451,1000452,1000453,1000454,1000455,1000456,1000457,1000458,5,5]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}