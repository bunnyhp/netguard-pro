{"fsPath":"\\home\\jarvis\\NetGuard\\scripts\\enhanced_iot_security_scanner.py","fileUuid":"b9819a88-bf2d-4c8a-bd94-2bef30cd3056","fileSizeBytes":14069,"numLines":375,"diffChanges":[{"originalStartLineNumberOneIndexed":4,"originalEndLineNumberExclusiveOneIndexed":6,"modifiedStartLineNumberOneIndexed":4,"modifiedEndLineNumberExclusiveOneIndexed":5,"addedLines":["Simplified version that works reliably"],"tokenizedAddedLines":[1000645]},{"originalStartLineNumberOneIndexed":13,"originalEndLineNumberExclusiveOneIndexed":15,"modifiedStartLineNumberOneIndexed":12,"modifiedEndLineNumberExclusiveOneIndexed":12},{"originalStartLineNumberOneIndexed":16,"originalEndLineNumberExclusiveOneIndexed":17,"modifiedStartLineNumberOneIndexed":13,"modifiedEndLineNumberExclusiveOneIndexed":13},{"originalStartLineNumberOneIndexed":18,"originalEndLineNumberExclusiveOneIndexed":20,"modifiedStartLineNumberOneIndexed":14,"modifiedEndLineNumberExclusiveOneIndexed":14},{"originalStartLineNumberOneIndexed":25,"originalEndLineNumberExclusiveOneIndexed":26,"modifiedStartLineNumberOneIndexed":19,"modifiedEndLineNumberExclusiveOneIndexed":19},{"originalStartLineNumberOneIndexed":41,"originalEndLineNumberExclusiveOneIndexed":45,"modifiedStartLineNumberOneIndexed":34,"modifiedEndLineNumberExclusiveOneIndexed":34},{"originalStartLineNumberOneIndexed":47,"originalEndLineNumberExclusiveOneIndexed":48,"modifiedStartLineNumberOneIndexed":36,"modifiedEndLineNumberExclusiveOneIndexed":38,"addedLines":["        \"\"\"Initialize IoT security database tables\"\"\"","        try:"],"tokenizedAddedLines":[1000646,1000647]},{"originalStartLineNumberOneIndexed":59,"originalEndLineNumberExclusiveOneIndexed":60,"modifiedStartLineNumberOneIndexed":49,"modifiedEndLineNumberExclusiveOneIndexed":50,"addedLines":["                    severity INTEGER NOT NULL,"],"tokenizedAddedLines":[1000648]},{"originalStartLineNumberOneIndexed":64,"originalEndLineNumberExclusiveOneIndexed":68,"modifiedStartLineNumberOneIndexed":54,"modifiedEndLineNumberExclusiveOneIndexed":55,"addedLines":["                    recommendation TEXT"],"tokenizedAddedLines":[1000649]},{"originalStartLineNumberOneIndexed":71,"originalEndLineNumberExclusiveOneIndexed":72,"modifiedStartLineNumberOneIndexed":58,"modifiedEndLineNumberExclusiveOneIndexed":59,"addedLines":["            # IoT communications table"],"tokenizedAddedLines":[1000650]},{"originalStartLineNumberOneIndexed":78,"originalEndLineNumberExclusiveOneIndexed":79,"modifiedStartLineNumberOneIndexed":65,"modifiedEndLineNumberExclusiveOneIndexed":65},{"originalStartLineNumberOneIndexed":81,"originalEndLineNumberExclusiveOneIndexed":81,"modifiedStartLineNumberOneIndexed":67,"modifiedEndLineNumberExclusiveOneIndexed":68,"addedLines":["                    packet_count INTEGER,"],"tokenizedAddedLines":[1000651]},{"originalStartLineNumberOneIndexed":82,"originalEndLineNumberExclusiveOneIndexed":83,"modifiedStartLineNumberOneIndexed":69,"modifiedEndLineNumberExclusiveOneIndexed":69},{"originalStartLineNumberOneIndexed":84,"originalEndLineNumberExclusiveOneIndexed":87,"modifiedStartLineNumberOneIndexed":70,"modifiedEndLineNumberExclusiveOneIndexed":71,"addedLines":["                    risk_level INTEGER DEFAULT 0"],"tokenizedAddedLines":[1000652]},{"originalStartLineNumberOneIndexed":90,"originalEndLineNumberExclusiveOneIndexed":91,"modifiedStartLineNumberOneIndexed":74,"modifiedEndLineNumberExclusiveOneIndexed":75,"addedLines":["            # IoT security scores table"],"tokenizedAddedLines":[1000653]},{"originalStartLineNumberOneIndexed":92,"originalEndLineNumberExclusiveOneIndexed":93,"modifiedStartLineNumberOneIndexed":76,"modifiedEndLineNumberExclusiveOneIndexed":77,"addedLines":["                CREATE TABLE IF NOT EXISTS iot_security_scores ("],"tokenizedAddedLines":[1000654]},{"originalStartLineNumberOneIndexed":94,"originalEndLineNumberExclusiveOneIndexed":95,"modifiedStartLineNumberOneIndexed":78,"modifiedEndLineNumberExclusiveOneIndexed":79,"addedLines":["                    device_ip TEXT UNIQUE NOT NULL,"],"tokenizedAddedLines":[1000655]},{"originalStartLineNumberOneIndexed":96,"originalEndLineNumberExclusiveOneIndexed":101,"modifiedStartLineNumberOneIndexed":80,"modifiedEndLineNumberExclusiveOneIndexed":85,"addedLines":["                    overall_score INTEGER NOT NULL,","                    vulnerability_score INTEGER NOT NULL,","                    communication_score INTEGER NOT NULL,","                    behavioral_score INTEGER NOT NULL,","                    last_updated DATETIME DEFAULT CURRENT_TIMESTAMP"],"tokenizedAddedLines":[1000656,1000657,1000658,1000659,1000660]},{"originalStartLineNumberOneIndexed":104,"originalEndLineNumberExclusiveOneIndexed":105,"modifiedStartLineNumberOneIndexed":88,"modifiedEndLineNumberExclusiveOneIndexed":89,"addedLines":["            # IoT domain patterns table"],"tokenizedAddedLines":[1000661]},{"originalStartLineNumberOneIndexed":113,"originalEndLineNumberExclusiveOneIndexed":116,"modifiedStartLineNumberOneIndexed":97,"modifiedEndLineNumberExclusiveOneIndexed":98,"addedLines":["                    risk_level INTEGER DEFAULT 0"],"tokenizedAddedLines":[1000652]},{"originalStartLineNumberOneIndexed":119,"originalEndLineNumberExclusiveOneIndexed":120,"modifiedStartLineNumberOneIndexed":101,"modifiedEndLineNumberExclusiveOneIndexed":102,"addedLines":["            # IoT security alerts table"],"tokenizedAddedLines":[1000662]},{"originalStartLineNumberOneIndexed":129,"originalEndLineNumberExclusiveOneIndexed":132,"modifiedStartLineNumberOneIndexed":111,"modifiedEndLineNumberExclusiveOneIndexed":111},{"originalStartLineNumberOneIndexed":134,"originalEndLineNumberExclusiveOneIndexed":151,"modifiedStartLineNumberOneIndexed":113,"modifiedEndLineNumberExclusiveOneIndexed":114,"addedLines":["                    resolved_at DATETIME"],"tokenizedAddedLines":[1000663]},{"originalStartLineNumberOneIndexed":154,"originalEndLineNumberExclusiveOneIndexed":169,"modifiedStartLineNumberOneIndexed":117,"modifiedEndLineNumberExclusiveOneIndexed":117},{"originalStartLineNumberOneIndexed":171,"originalEndLineNumberExclusiveOneIndexed":232,"modifiedStartLineNumberOneIndexed":119,"modifiedEndLineNumberExclusiveOneIndexed":123,"addedLines":["            logging.info(\"âœ“ IoT security database tables initialized\")","            ","        except Exception as e:","            logging.error(f\"Error initializing database: {e}\")"],"tokenizedAddedLines":[1000664,317,1000665,1000666]},{"originalStartLineNumberOneIndexed":234,"originalEndLineNumberExclusiveOneIndexed":235,"modifiedStartLineNumberOneIndexed":125,"modifiedEndLineNumberExclusiveOneIndexed":127,"addedLines":["        \"\"\"Get IoT devices from database\"\"\"","        try:"],"tokenizedAddedLines":[1000667,1000647]},{"originalStartLineNumberOneIndexed":239,"originalEndLineNumberExclusiveOneIndexed":240,"modifiedStartLineNumberOneIndexed":131,"modifiedEndLineNumberExclusiveOneIndexed":131},{"originalStartLineNumberOneIndexed":241,"originalEndLineNumberExclusiveOneIndexed":249,"modifiedStartLineNumberOneIndexed":132,"modifiedEndLineNumberExclusiveOneIndexed":133,"addedLines":["                SELECT * FROM devices "],"tokenizedAddedLines":[1000668]},{"originalStartLineNumberOneIndexed":250,"originalEndLineNumberExclusiveOneIndexed":272,"modifiedStartLineNumberOneIndexed":134,"modifiedEndLineNumberExclusiveOneIndexed":146,"addedLines":["                    device_type = 'IoT' OR","                    device_category LIKE '%camera%' OR","                    device_category LIKE '%tv%' OR","                    device_category LIKE '%speaker%' OR","                    device_category LIKE '%thermostat%' OR","                    device_category LIKE '%plug%' OR","                    vendor IN ('Amazon', 'Google', 'Samsung', 'LG', 'Sony', 'TP-Link')","                )","                AND last_seen > datetime('now', '-24 hours')","            \"\"\")","            ","            devices = [dict(row) for row in cursor.fetchall()]"],"tokenizedAddedLines":[1000669,1000670,1000671,1000672,1000673,1000674,1000675,1000676,1000677,1000678,317,1000679]},{"originalStartLineNumberOneIndexed":275,"originalEndLineNumberExclusiveOneIndexed":277,"modifiedStartLineNumberOneIndexed":149,"modifiedEndLineNumberExclusiveOneIndexed":155,"addedLines":["        except Exception as e:","            logging.error(f\"Error getting IoT devices: {e}\")","            return []","    ","    def scan_device_vulnerabilities(self, device):","        \"\"\"Scan device for basic vulnerabilities\"\"\""],"tokenizedAddedLines":[1000665,1000680,1000681,128,1000682,1000683]},{"originalStartLineNumberOneIndexed":279,"originalEndLineNumberExclusiveOneIndexed":443,"modifiedStartLineNumberOneIndexed":157,"modifiedEndLineNumberExclusiveOneIndexed":160,"addedLines":["        ","        try:","            # Check for common IoT vulnerabilities"],"tokenizedAddedLines":[41,1000647,1000684]},{"originalStartLineNumberOneIndexed":446,"originalEndLineNumberExclusiveOneIndexed":447,"modifiedStartLineNumberOneIndexed":163,"modifiedEndLineNumberExclusiveOneIndexed":164,"addedLines":["            # Check for unencrypted HTTP traffic"],"tokenizedAddedLines":[1000685]},{"originalStartLineNumberOneIndexed":448,"originalEndLineNumberExclusiveOneIndexed":454,"modifiedStartLineNumberOneIndexed":165,"modifiedEndLineNumberExclusiveOneIndexed":166,"addedLines":["                SELECT COUNT(*) as http_count"],"tokenizedAddedLines":[1000686]},{"originalStartLineNumberOneIndexed":461,"originalEndLineNumberExclusiveOneIndexed":464,"modifiedStartLineNumberOneIndexed":173,"modifiedEndLineNumberExclusiveOneIndexed":176,"addedLines":["                 AND dest_port = 80","                 AND timestamp > datetime('now', '-1 hour')","                 LIMIT 100)"],"tokenizedAddedLines":[1000687,388,1000688]},{"originalStartLineNumberOneIndexed":466,"originalEndLineNumberExclusiveOneIndexed":530,"modifiedStartLineNumberOneIndexed":178,"modifiedEndLineNumberExclusiveOneIndexed":189,"addedLines":["            http_count = cursor.fetchone()[0] if cursor.fetchone() else 0","            ","            if http_count > 0:","                vulnerabilities.append({","                    'type': 'unencrypted_http',","                    'severity': 3,","                    'description': f'Device using unencrypted HTTP traffic ({http_count} packets)',","                    'recommendation': 'Enable HTTPS encryption for all communications'","                })","            ","            # Check for suspicious outbound connections"],"tokenizedAddedLines":[1000689,317,1000690,1000691,1000692,1000693,1000694,1000695,1000696,317,1000697]},{"originalStartLineNumberOneIndexed":531,"originalEndLineNumberExclusiveOneIndexed":537,"modifiedStartLineNumberOneIndexed":190,"modifiedEndLineNumberExclusiveOneIndexed":191,"addedLines":["                SELECT COUNT(*) as external_count"],"tokenizedAddedLines":[1000698]},{"originalStartLineNumberOneIndexed":544,"originalEndLineNumberExclusiveOneIndexed":544,"modifiedStartLineNumberOneIndexed":198,"modifiedEndLineNumberExclusiveOneIndexed":201,"addedLines":["                 AND dest_ip NOT LIKE '192.168.%'","                 AND dest_ip NOT LIKE '10.%'","                 AND dest_ip NOT LIKE '172.%'"],"tokenizedAddedLines":[1000699,1000700,1000701]},{"originalStartLineNumberOneIndexed":545,"originalEndLineNumberExclusiveOneIndexed":546,"modifiedStartLineNumberOneIndexed":202,"modifiedEndLineNumberExclusiveOneIndexed":203,"addedLines":["                 LIMIT 100)"],"tokenizedAddedLines":[1000688]},{"originalStartLineNumberOneIndexed":548,"originalEndLineNumberExclusiveOneIndexed":581,"modifiedStartLineNumberOneIndexed":205,"modifiedEndLineNumberExclusiveOneIndexed":215,"addedLines":["            external_count = cursor.fetchone()[0] if cursor.fetchone() else 0","            ","            if external_count > 50:","                vulnerabilities.append({","                    'type': 'excessive_external_connections',","                    'severity': 2,","                    'description': f'Device making many external connections ({external_count})',","                    'recommendation': 'Review device behavior and block unnecessary external access'","                })","            "],"tokenizedAddedLines":[1000702,317,1000703,1000691,1000704,1000705,1000706,1000707,1000696,317]},{"originalStartLineNumberOneIndexed":582,"originalEndLineNumberExclusiveOneIndexed":691,"modifiedStartLineNumberOneIndexed":216,"modifiedEndLineNumberExclusiveOneIndexed":225,"addedLines":["            ","        except Exception as e:","            logging.error(f\"Error scanning device {device_ip}: {e}\")","        ","        return vulnerabilities","    ","    def generate_security_score(self, device_ip):","        \"\"\"Generate security score for device\"\"\"","        try:"],"tokenizedAddedLines":[317,1000665,1000708,41,249,128,1000709,1000710,1000647]},{"originalStartLineNumberOneIndexed":694,"originalEndLineNumberExclusiveOneIndexed":696,"modifiedStartLineNumberOneIndexed":228,"modifiedEndLineNumberExclusiveOneIndexed":235,"addedLines":["            # Count vulnerabilities","            cursor.execute(\"\"\"","                SELECT COUNT(*) as vuln_count, MAX(severity) as max_severity","                FROM iot_vulnerabilities","                WHERE device_ip = ? AND resolved = 0","            \"\"\", (device_ip,))","            "],"tokenizedAddedLines":[1000711,322,1000712,555,1000713,389,317]},{"originalStartLineNumberOneIndexed":697,"originalEndLineNumberExclusiveOneIndexed":714,"modifiedStartLineNumberOneIndexed":236,"modifiedEndLineNumberExclusiveOneIndexed":258,"addedLines":["            vuln_count = result[0] if result else 0","            max_severity = result[1] if result and result[1] else 0","            ","            # Calculate base score","            base_score = 100","            ","            # Deduct for vulnerabilities","            if max_severity == 1:  # Critical","                base_score -= 50","            elif max_severity == 2:  # High","                base_score -= 30","            elif max_severity == 3:  # Medium","                base_score -= 15","            elif max_severity == 4:  # Low","                base_score -= 5","            ","            # Deduct for multiple vulnerabilities","            base_score -= min(20, vuln_count * 5)","            ","            final_score = max(0, base_score)","            ","            # Store score"],"tokenizedAddedLines":[1000714,1000715,317,1000716,1000717,317,1000718,1000719,1000720,1000721,1000722,1000723,1000724,1000725,1000726,317,1000727,1000728,317,1000729,317,1000730]},{"originalStartLineNumberOneIndexed":716,"originalEndLineNumberExclusiveOneIndexed":727,"modifiedStartLineNumberOneIndexed":260,"modifiedEndLineNumberExclusiveOneIndexed":263,"addedLines":["                (device_ip, overall_score, vulnerability_score, communication_score, behavioral_score)","                VALUES (?, ?, ?, ?, ?)","            \"\"\", (device_ip, final_score, final_score, 80, 85))"],"tokenizedAddedLines":[1000731,1000732,1000733]},{"originalStartLineNumberOneIndexed":731,"originalEndLineNumberExclusiveOneIndexed":817,"modifiedStartLineNumberOneIndexed":267,"modifiedEndLineNumberExclusiveOneIndexed":276,"addedLines":["            return final_score","            ","        except Exception as e:","            logging.error(f\"Error generating security score for {device_ip}: {e}\")","            return 50","    ","    def simulate_domain_communications(self, device_ip):","        \"\"\"Simulate domain communication patterns\"\"\"","        try:"],"tokenizedAddedLines":[1000734,317,1000665,1000735,1000736,128,1000737,1000738,1000647]},{"originalStartLineNumberOneIndexed":820,"originalEndLineNumberExclusiveOneIndexed":830,"modifiedStartLineNumberOneIndexed":279,"modifiedEndLineNumberExclusiveOneIndexed":289,"addedLines":["            # Common IoT domains","            domains = [","                ('amazon.com', 0),","                ('google.com', 0),","                ('microsoft.com', 0),","                ('cloudflare.com', 0),","                ('akamai.net', 1)","            ]","            ","            for domain, risk_level in domains:"],"tokenizedAddedLines":[1000739,1000740,1000741,1000742,1000743,1000744,1000745,1000746,317,1000747]},{"originalStartLineNumberOneIndexed":831,"originalEndLineNumberExclusiveOneIndexed":870,"modifiedStartLineNumberOneIndexed":290,"modifiedEndLineNumberExclusiveOneIndexed":294,"addedLines":["                    INSERT OR REPLACE INTO iot_domain_patterns","                    (device_ip, domain, frequency, last_seen, risk_level)","                    VALUES (?, ?, COALESCE((SELECT frequency + 1 FROM iot_domain_patterns WHERE device_ip = ? AND domain = ?), 1), CURRENT_TIMESTAMP, ?)","                \"\"\", (device_ip, domain, device_ip, domain, risk_level))"],"tokenizedAddedLines":[1000748,444,445,446]},{"originalStartLineNumberOneIndexed":873,"originalEndLineNumberExclusiveOneIndexed":873,"modifiedStartLineNumberOneIndexed":297,"modifiedEndLineNumberExclusiveOneIndexed":300,"addedLines":["            ","        except Exception as e:","            logging.error(f\"Error simulating domain communications for {device_ip}: {e}\")"],"tokenizedAddedLines":[317,1000665,1000749]},{"originalStartLineNumberOneIndexed":885,"originalEndLineNumberExclusiveOneIndexed":887,"modifiedStartLineNumberOneIndexed":312,"modifiedEndLineNumberExclusiveOneIndexed":314,"addedLines":["            # Scan for vulnerabilities","            vulnerabilities = self.scan_device_vulnerabilities(device)"],"tokenizedAddedLines":[1000750,1000751]},{"originalStartLineNumberOneIndexed":912,"originalEndLineNumberExclusiveOneIndexed":926,"modifiedStartLineNumberOneIndexed":339,"modifiedEndLineNumberExclusiveOneIndexed":345,"addedLines":["            # Generate security score","            score = self.generate_security_score(device_ip)","            logging.info(f\"Security score for {device_ip}: {score}\")","            ","            # Simulate domain communications","            self.simulate_domain_communications(device_ip)"],"tokenizedAddedLines":[1000752,1000753,1000754,317,1000755,1000756]},{"originalStartLineNumberOneIndexed":929,"originalEndLineNumberExclusiveOneIndexed":956,"modifiedStartLineNumberOneIndexed":348,"modifiedEndLineNumberExclusiveOneIndexed":348},{"originalStartLineNumberOneIndexed":962,"originalEndLineNumberExclusiveOneIndexed":963,"modifiedStartLineNumberOneIndexed":354,"modifiedEndLineNumberExclusiveOneIndexed":360,"addedLines":["        cycle = 0","        while True:","            cycle += 1","            logging.info(f\"\\n--- Security Scan Cycle {cycle} ---\")","            ","            try:"],"tokenizedAddedLines":[1000757,621,1000758,1000759,317,255]},{"originalStartLineNumberOneIndexed":964,"originalEndLineNumberExclusiveOneIndexed":964,"modifiedStartLineNumberOneIndexed":361,"modifiedEndLineNumberExclusiveOneIndexed":363,"addedLines":["            except Exception as e:","                logging.error(f\"Error in security scan cycle: {e}\")"],"tokenizedAddedLines":[633,1000760]},{"originalStartLineNumberOneIndexed":965,"originalEndLineNumberExclusiveOneIndexed":967,"modifiedStartLineNumberOneIndexed":364,"modifiedEndLineNumberExclusiveOneIndexed":366,"addedLines":["            logging.info(f\"Waiting {SCAN_INTERVAL} seconds until next scan...\")","            time.sleep(SCAN_INTERVAL)"],"tokenizedAddedLines":[1000761,1000762]},{"originalStartLineNumberOneIndexed":969,"originalEndLineNumberExclusiveOneIndexed":969,"modifiedStartLineNumberOneIndexed":368,"modifiedEndLineNumberExclusiveOneIndexed":369,"addedLines":["    try:"],"tokenizedAddedLines":[1000763]},{"originalStartLineNumberOneIndexed":971,"originalEndLineNumberExclusiveOneIndexed":972,"modifiedStartLineNumberOneIndexed":371,"modifiedEndLineNumberExclusiveOneIndexed":376,"addedLines":["    except KeyboardInterrupt:","        logging.info(\"Scanner stopped by user\")","    except Exception as e:","        logging.error(f\"Fatal error: {e}\")","        sys.exit(1)"],"tokenizedAddedLines":[1000764,1000765,1000766,1000767,1000768]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}