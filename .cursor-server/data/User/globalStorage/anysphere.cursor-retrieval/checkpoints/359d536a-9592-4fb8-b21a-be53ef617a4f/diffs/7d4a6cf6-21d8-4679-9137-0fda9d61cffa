{"fsPath":"\\home\\jarvis\\NetGuard\\scripts\\ai_5min_aggregator.py","fileUuid":"7d4a6cf6-21d8-4679-9137-0fda9d61cffa","fileSizeBytes":26977,"numLines":685,"diffChanges":[{"originalStartLineNumberOneIndexed":282,"originalEndLineNumberExclusiveOneIndexed":282,"modifiedStartLineNumberOneIndexed":282,"modifiedEndLineNumberExclusiveOneIndexed":367,"addedLines":["        # Get IoT device information from device tracker","        data['iot_devices'] = {","            'total_iot_devices': 0,","            'device_categories': {},","            'devices': []","        }","        ","        try:","            cursor.execute(\"\"\"","                SELECT ip_address, mac_address, hostname, vendor, ","                       device_category, security_score, last_seen","                FROM devices ","                WHERE device_type = 'IoT' ","                AND last_seen > datetime('now', '-1 hour')","                ORDER BY last_seen DESC","                LIMIT 20","            \"\"\")","            ","            iot_devices = cursor.fetchall()","            ","            if iot_devices:","                device_categories = {}","                devices_list = []","                ","                for device in iot_devices:","                    dev_dict = dict(device)","                    devices_list.append(dev_dict)","                    ","                    category = dev_dict.get('device_category', 'Unknown')","                    device_categories[category] = device_categories.get(category, 0) + 1","                ","                data['iot_devices'] = {","                    'total_iot_devices': len(iot_devices),","                    'device_categories': device_categories,","                    'devices': devices_list","                }","        except Exception as e:","            logging.error(f\"Error getting IoT devices: {e}\")","        ","        # Get IoT security vulnerabilities","        data['iot_security'] = {","            'total_vulnerabilities': 0,","            'by_severity': {},","            'vulnerabilities': []","        }","        ","        try:","            cursor.execute(\"\"\"","                SELECT device_ip, device_type, vulnerability_type, ","                       severity, description, recommendation, detected_at","                FROM iot_vulnerabilities","                WHERE resolved = 0","                ORDER BY ","                    CASE severity","                        WHEN 'CRITICAL' THEN 1","                        WHEN 'HIGH' THEN 2","                        WHEN 'MEDIUM' THEN 3","                        WHEN 'LOW' THEN 4","                        ELSE 5","                    END,","                    detected_at DESC","                LIMIT 10","            \"\"\")","            ","            vulnerabilities = cursor.fetchall()","            ","            if vulnerabilities:","                by_severity = {}","                vuln_list = []","                ","                for vuln in vulnerabilities:","                    vuln_dict = dict(vuln)","                    vuln_list.append(vuln_dict)","                    ","                    severity = vuln_dict.get('severity', 'UNKNOWN')","                    by_severity[severity] = by_severity.get(severity, 0) + 1","                ","                data['iot_security'] = {","                    'total_vulnerabilities': len(vulnerabilities),","                    'by_severity': by_severity,","                    'vulnerabilities': vuln_list","                }","        except Exception as e:","            logging.error(f\"Error getting IoT vulnerabilities: {e}\")","        "],"tokenizedAddedLines":[1000407,1000408,1000409,1000410,1000411,58,53,1000412,1000413,1000414,1000415,1000416,1000417,1000418,1000419,1000420,1000421,67,1000422,67,1000423,1000424,1000425,73,1000426,1000427,1000428,1000429,1000430,1000431,73,1000432,1000433,1000434,1000435,1000436,1000437,1000438,53,1000439,1000440,1000441,1000442,1000443,58,53,1000412,1000413,1000444,1000445,1000446,1000447,1000448,1000449,1000450,1000451,1000452,1000453,1000454,1000455,1000456,1000457,1000421,67,1000458,67,1000459,1000460,1000461,73,1000462,1000463,1000464,1000429,1000465,1000466,73,1000467,1000468,1000469,1000470,1000436,1000437,1000471,53]},{"originalStartLineNumberOneIndexed":356,"originalEndLineNumberExclusiveOneIndexed":356,"modifiedStartLineNumberOneIndexed":441,"modifiedEndLineNumberExclusiveOneIndexed":451,"addedLines":["","### 11. IoT DEVICE SECURITY","- Total IoT Devices: {data['iot_devices']['total_iot_devices']}","- Device Categories: {json.dumps(data['iot_devices']['device_categories'], indent=2)}","- IoT Devices Details: {json.dumps(data['iot_devices']['devices'], indent=2, default=str)}","","### 12. IoT SECURITY VULNERABILITIES","- Total Active Vulnerabilities: {data['iot_security']['total_vulnerabilities']}","- By Severity: {json.dumps(data['iot_security']['by_severity'], indent=2)}","- Vulnerability Details: {json.dumps(data['iot_security']['vulnerabilities'], indent=2, default=str)}"],"tokenizedAddedLines":[6,1000472,1000473,1000474,1000475,6,1000476,1000477,1000478,1000479]},{"originalStartLineNumberOneIndexed":392,"originalEndLineNumberExclusiveOneIndexed":392,"modifiedStartLineNumberOneIndexed":487,"modifiedEndLineNumberExclusiveOneIndexed":493,"addedLines":["  \"iot_analysis\": {{","    \"total_iot_devices\": {data['iot_devices']['total_iot_devices']},","    \"device_categories\": {json.dumps(data['iot_devices']['device_categories'])},","    \"vulnerable_devices\": [\"ip: vulnerability description\"],","    \"security_recommendations\": [\"IoT-specific security advice\"]","  }},"],"tokenizedAddedLines":[1000480,1000481,1000482,1000483,1000484,259]},{"originalStartLineNumberOneIndexed":394,"originalEndLineNumberExclusiveOneIndexed":395,"modifiedStartLineNumberOneIndexed":495,"modifiedEndLineNumberExclusiveOneIndexed":498,"addedLines":["    \"Immediate action item 2\",","    \"IoT security recommendation 1\",","    \"IoT security recommendation 2\""],"tokenizedAddedLines":[1000485,1000486,1000487]},{"originalStartLineNumberOneIndexed":462,"originalEndLineNumberExclusiveOneIndexed":462,"modifiedStartLineNumberOneIndexed":565,"modifiedEndLineNumberExclusiveOneIndexed":566,"addedLines":["                iot_analysis TEXT,"],"tokenizedAddedLines":[1000488]},{"originalStartLineNumberOneIndexed":472,"originalEndLineNumberExclusiveOneIndexed":474,"modifiedStartLineNumberOneIndexed":576,"modifiedEndLineNumberExclusiveOneIndexed":578,"addedLines":["                http_analysis, iot_analysis, recommendations, raw_response","            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)"],"tokenizedAddedLines":[1000489,1000490]},{"originalStartLineNumberOneIndexed":482,"originalEndLineNumberExclusiveOneIndexed":482,"modifiedStartLineNumberOneIndexed":586,"modifiedEndLineNumberExclusiveOneIndexed":587,"addedLines":["            json.dumps(analysis.get('iot_analysis', {})),"],"tokenizedAddedLines":[1000491]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}