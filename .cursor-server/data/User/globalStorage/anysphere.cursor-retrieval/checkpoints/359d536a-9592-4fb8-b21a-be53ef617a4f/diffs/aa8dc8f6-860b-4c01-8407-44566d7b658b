{"fsPath":"\\home\\jarvis\\NetGuard\\scripts\\optimize_database.py","fileUuid":"aa8dc8f6-860b-4c01-8407-44566d7b658b","fileSizeBytes":4212,"numLines":111,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":112,"addedLines":["#!/usr/bin/env python3","\"\"\"","NetGuard Pro - Database Optimizer","Add indexes for better query performance","\"\"\"","","import sqlite3","import logging","","DB_PATH = \"/home/jarvis/NetGuard/network.db\"","","logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(message)s')","","def optimize_database():","    \"\"\"Add indexes to improve database performance\"\"\"","    try:","        conn = sqlite3.connect(DB_PATH)","        cursor = conn.cursor()","        ","        logging.info(\"Optimizing database...\")","        ","        # Get all table names","        cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table'\")","        tables = [row[0] for row in cursor.fetchall()]","        ","        # Common column patterns to index","        index_patterns = {","            'timestamp': ['timestamp', 'created_at', 'detected_at'],","            'ip': ['src_ip', 'dest_ip', 'ip_address', 'device_ip'],","            'mac': ['mac_address', 'device_mac'],","            'status': ['resolved', 'is_trusted'],","            'severity': ['severity']","        }","        ","        indexes_created = 0","        ","        for table in tables:","            # Skip template tables","            if table.endswith('_template'):","                continue","            ","            # Get columns for this table","            cursor.execute(f\"PRAGMA table_info({table})\")","            columns = [row[1] for row in cursor.fetchall()]","            ","            # Create indexes for common query patterns","            for index_type, column_patterns in index_patterns.items():","                for pattern in column_patterns:","                    for column in columns:","                        if column == pattern:","                            index_name = f\"idx_{table}_{column}\"","                            ","                            # Check if index already exists","                            cursor.execute(f\"\"\"","                                SELECT name FROM sqlite_master ","                                WHERE type='index' AND name='{index_name}'","                            \"\"\")","                            ","                            if not cursor.fetchone():","                                try:","                                    cursor.execute(f\"CREATE INDEX {index_name} ON {table}({column})\")","                                    indexes_created += 1","                                    logging.info(f\"  ✓ Created index: {index_name}\")","                                except Exception as e:","                                    logging.warning(f\"  ⚠ Could not create {index_name}: {e}\")","        ","        # Create composite indexes for common query patterns","        composite_indexes = [","            ('devices', ['device_type', 'last_seen']),","            ('iot_vulnerabilities', ['device_ip', 'resolved']),","            ('ai_analysis', ['timestamp', 'threat_level'])","        ]","        ","        for table, columns in composite_indexes:","            if table in tables:","                index_name = f\"idx_{table}_{'_'.join(columns)}\"","                ","                cursor.execute(f\"\"\"","                    SELECT name FROM sqlite_master ","                    WHERE type='index' AND name='{index_name}'","                \"\"\")","                ","                if not cursor.fetchone():","                    try:","                        cursor.execute(f\"CREATE INDEX {index_name} ON {table}({', '.join(columns)})\")","                        indexes_created += 1","                        logging.info(f\"  ✓ Created composite index: {index_name}\")","                    except Exception as e:","                        logging.warning(f\"  ⚠ Could not create {index_name}: {e}\")","        ","        # Run VACUUM to optimize database file","        logging.info(\"Running VACUUM to optimize database file...\")","        cursor.execute(\"VACUUM\")","        ","        # Update statistics","        logging.info(\"Analyzing database statistics...\")","        cursor.execute(\"ANALYZE\")","        ","        conn.commit()","        conn.close()","        ","        logging.info(f\"\\n✓ Database optimization complete!\")","        logging.info(f\"✓ Created {indexes_created} new indexes\")","        ","    except Exception as e:","        logging.error(f\"Error optimizing database: {e}\")","","if __name__ == \"__main__\":","    optimize_database()","",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000003,1000001,1000004,1000005,1000006,1000004,1000007,1000004,1000008,1000004,1000009,1000010,1000011,1000012,1000013,1000014,1000015,1000014,1000016,1000017,1000018,1000014,1000019,1000020,1000021,1000022,1000023,1000024,1000025,1000026,1000014,1000027,1000014,1000028,1000029,1000030,1000031,1000032,1000033,1000034,1000035,1000032,1000036,1000037,1000038,1000039,1000040,1000041,1000042,1000043,1000044,1000045,1000046,1000047,1000042,1000048,1000049,1000050,1000051,1000052,1000053,1000054,1000014,1000055,1000056,1000057,1000058,1000059,1000060,1000014,1000061,1000062,1000063,1000064,1000065,1000066,1000067,1000068,1000064,1000069,1000070,1000071,1000072,1000073,1000074,1000075,1000014,1000076,1000077,1000078,1000014,1000079,1000080,1000081,1000014,1000082,1000083,1000014,1000084,1000085,1000014,1000086,1000087,1000004,1000088,1000089,1000004,1000004]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}