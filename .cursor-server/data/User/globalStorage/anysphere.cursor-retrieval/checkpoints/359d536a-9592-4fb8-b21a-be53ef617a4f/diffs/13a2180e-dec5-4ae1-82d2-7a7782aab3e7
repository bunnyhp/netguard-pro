{"fsPath":"\\home\\jarvis\\NetGuard\\web\\app.py","fileUuid":"13a2180e-dec5-4ae1-82d2-7a7782aab3e7","fileSizeBytes":35625,"numLines":919,"diffChanges":[{"originalStartLineNumberOneIndexed":587,"originalEndLineNumberExclusiveOneIndexed":587,"modifiedStartLineNumberOneIndexed":587,"modifiedEndLineNumberExclusiveOneIndexed":588,"addedLines":["            analysis_data['iot_analysis'] = json.loads(analysis_data.get('iot_analysis', '{}'))"],"tokenizedAddedLines":[1000560]},{"originalStartLineNumberOneIndexed":723,"originalEndLineNumberExclusiveOneIndexed":723,"modifiedStartLineNumberOneIndexed":724,"modifiedEndLineNumberExclusiveOneIndexed":795,"addedLines":["","@app.route('/iot-devices')","def iot_devices():","    \"\"\"IoT Devices Dashboard\"\"\"","    conn = get_db_connection()","    cursor = conn.cursor()","    ","    # Get all IoT devices","    cursor.execute(\"\"\"","        SELECT * FROM devices ","        WHERE device_type = 'IoT'","        ORDER BY last_seen DESC","    \"\"\")","    devices = [dict(row) for row in cursor.fetchall()]","    ","    # Get vulnerabilities for each device","    cursor.execute(\"\"\"","        SELECT device_ip, COUNT(*) as vuln_count, ","               MAX(CASE severity","                   WHEN 'CRITICAL' THEN 4","                   WHEN 'HIGH' THEN 3","                   WHEN 'MEDIUM' THEN 2","                   WHEN 'LOW' THEN 1","                   ELSE 0","               END) as max_severity","        FROM iot_vulnerabilities","        WHERE resolved = 0","        GROUP BY device_ip","    \"\"\")","    ","    vuln_map = {}","    for row in cursor.fetchall():","        vuln_map[row['device_ip']] = {","            'count': row['vuln_count'],","            'max_severity': row['max_severity']","        }","    ","    # Add vulnerability info to devices","    for device in devices:","        ip = device['ip_address']","        device['vulnerabilities'] = vuln_map.get(ip, {'count': 0, 'max_severity': 0})","    ","    conn.close()","    ","    return render_template('iot_devices.html', devices=devices)","","","@app.route('/iot-devices/<device_ip>/vulnerabilities')","def device_vulnerabilities(device_ip):","    \"\"\"Get vulnerabilities for a specific device\"\"\"","    conn = get_db_connection()","    cursor = conn.cursor()","    ","    cursor.execute(\"\"\"","        SELECT * FROM iot_vulnerabilities","        WHERE device_ip = ? AND resolved = 0","        ORDER BY ","            CASE severity","                WHEN 'CRITICAL' THEN 1","                WHEN 'HIGH' THEN 2","                WHEN 'MEDIUM' THEN 3","                WHEN 'LOW' THEN 4","                ELSE 5","            END","    \"\"\", (device_ip,))","    ","    vulnerabilities = [dict(row) for row in cursor.fetchall()]","    conn.close()","    ","    return jsonify(vulnerabilities)",""],"tokenizedAddedLines":[5,1000561,1000562,1000563,22,23,179,1000564,381,1000565,1000566,1000567,384,1000568,179,1000569,381,1000570,1000571,1000572,1000573,1000574,1000575,1000576,1000577,1000578,1000579,1000580,384,179,1000581,1000582,1000583,1000584,1000585,72,179,1000586,1000587,1000588,1000589,179,26,179,1000590,5,5,1000591,1000592,1000593,22,23,179,381,1000594,1000595,1000596,1000597,1000598,1000599,1000600,1000601,1000602,1000603,1000604,179,1000605,26,179,1000606,5]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}