{"fsPath":"\\home\\jarvis\\NetGuard\\scripts\\initialize_system.py","fileUuid":"395acd26-0739-46f2-9638-ea5d5451d1ef","fileSizeBytes":8234,"numLines":214,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":215,"addedLines":["#!/usr/bin/env python3","\"\"\"","NetGuard Pro - System Initialization Script","Ensures all database tables and configurations are properly set up","\"\"\"","","import os","import sys","import sqlite3","import logging","","# Setup logging","logging.basicConfig(","    level=logging.INFO,","    format='%(asctime)s - %(levelname)s - %(message)s'",")","","DB_PATH = \"/home/jarvis/NetGuard/network.db\"","","def initialize_all_tables():","    \"\"\"Initialize all required database tables\"\"\"","    ","    logging.info(\"=\" * 60)","    logging.info(\"NetGuard Pro - System Initialization\")","    logging.info(\"=\" * 60)","    ","    if not os.path.exists(DB_PATH):","        logging.error(f\"Database not found: {DB_PATH}\")","        logging.info(\"Please ensure network collectors are running to create the database.\")","        return False","    ","    conn = sqlite3.connect(DB_PATH)","    cursor = conn.cursor()","    ","    # 1. Initialize Devices Table","    logging.info(\"1. Initializing devices table...\")","    try:","        cursor.execute(\"\"\"","            CREATE TABLE IF NOT EXISTS devices (","                ip_address TEXT PRIMARY KEY,","                mac_address TEXT,","                hostname TEXT,","                vendor TEXT,","                device_type TEXT,","                device_category TEXT,","                security_score INTEGER DEFAULT 50,","                is_trusted INTEGER DEFAULT 0,","                first_seen DATETIME,","                last_seen DATETIME,","                total_packets INTEGER DEFAULT 0,","                total_bytes INTEGER DEFAULT 0","            )","        \"\"\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_devices_ip_address ON devices (ip_address)\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_devices_mac_address ON devices (mac_address)\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_devices_last_seen ON devices (last_seen DESC)\")","        logging.info(\"   ✓ Devices table initialized\")","    except Exception as e:","        logging.error(f\"   ✗ Error initializing devices table: {e}\")","    ","    # 2. Initialize IoT Vulnerabilities Table","    logging.info(\"2. Initializing iot_vulnerabilities table...\")","    try:","        cursor.execute(\"\"\"","            CREATE TABLE IF NOT EXISTS iot_vulnerabilities (","                id INTEGER PRIMARY KEY AUTOINCREMENT,","                device_ip TEXT NOT NULL,","                device_mac TEXT,","                vulnerability_type TEXT NOT NULL,","                severity TEXT NOT NULL,","                description TEXT,","                recommendation TEXT,","                detected_at DATETIME DEFAULT CURRENT_TIMESTAMP,","                resolved INTEGER DEFAULT 0,","                resolved_at DATETIME","            )","        \"\"\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_iot_vulnerabilities_device_ip ON iot_vulnerabilities (device_ip)\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_iot_vulnerabilities_resolved ON iot_vulnerabilities (resolved)\")","        logging.info(\"   ✓ IoT vulnerabilities table initialized\")","    except Exception as e:","        logging.error(f\"   ✗ Error initializing iot_vulnerabilities table: {e}\")","    ","    # 3. Initialize Security Alerts Table","    logging.info(\"3. Initializing security_alerts table...\")","    try:","        cursor.execute(\"\"\"","            CREATE TABLE IF NOT EXISTS security_alerts (","                id INTEGER PRIMARY KEY AUTOINCREMENT,","                alert_id TEXT UNIQUE NOT NULL,","                severity TEXT NOT NULL,","                alert_type TEXT NOT NULL,","                title TEXT NOT NULL,","                description TEXT NOT NULL,","                source_ip TEXT,","                dest_ip TEXT,","                source_device TEXT,","                affected_devices TEXT,","                threat_indicators TEXT,","                remediation_steps TEXT,","                auto_remediation_available INTEGER DEFAULT 0,","                auto_remediation_command TEXT,","                status TEXT DEFAULT 'active',","                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,","                updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,","                resolved_at DATETIME,","                resolved_by TEXT,","                false_positive INTEGER DEFAULT 0,","                recurrence_count INTEGER DEFAULT 1,","                last_seen DATETIME DEFAULT CURRENT_TIMESTAMP","            )","        \"\"\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_security_alerts_alert_id ON security_alerts (alert_id)\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_security_alerts_status ON security_alerts (status)\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_security_alerts_severity ON security_alerts (severity)\")","        logging.info(\"   ✓ Security alerts table initialized\")","    except Exception as e:","        logging.error(f\"   ✗ Error initializing security_alerts table: {e}\")","    ","    # 4. Initialize Alert History Table","    logging.info(\"4. Initializing alert_history table...\")","    try:","        cursor.execute(\"\"\"","            CREATE TABLE IF NOT EXISTS alert_history (","                id INTEGER PRIMARY KEY AUTOINCREMENT,","                alert_id TEXT NOT NULL,","                action TEXT NOT NULL,","                action_by TEXT,","                notes TEXT,","                timestamp DATETIME DEFAULT CURRENT_TIMESTAMP","            )","        \"\"\")","        cursor.execute(\"CREATE INDEX IF NOT EXISTS idx_alert_history_alert_id ON alert_history (alert_id)\")","        logging.info(\"   ✓ Alert history table initialized\")","    except Exception as e:","        logging.error(f\"   ✗ Error initializing alert_history table: {e}\")","    ","    # 5. Initialize Alert Rules Table","    logging.info(\"5. Initializing alert_rules table...\")","    try:","        cursor.execute(\"\"\"","            CREATE TABLE IF NOT EXISTS alert_rules (","                id INTEGER PRIMARY KEY AUTOINCREMENT,","                rule_name TEXT UNIQUE NOT NULL,","                rule_type TEXT NOT NULL,","                condition TEXT NOT NULL,","                threshold_value REAL,","                severity TEXT NOT NULL,","                enabled INTEGER DEFAULT 1,","                auto_remediation INTEGER DEFAULT 0,","                created_at DATETIME DEFAULT CURRENT_TIMESTAMP,","                updated_at DATETIME DEFAULT CURRENT_TIMESTAMP","            )","        \"\"\")","        logging.info(\"   ✓ Alert rules table initialized\")","    except Exception as e:","        logging.error(f\"   ✗ Error initializing alert_rules table: {e}\")","    ","    conn.commit()","    ","    # 6. Verify Tables","    logging.info(\"\\n6. Verifying all tables...\")","    cursor.execute(\"\"\"","        SELECT name FROM sqlite_master ","        WHERE type='table' ","        AND name IN ('devices', 'iot_vulnerabilities', 'security_alerts', 'alert_history', 'alert_rules')","        ORDER BY name","    \"\"\")","    tables = cursor.fetchall()","    ","    expected_tables = ['alert_history', 'alert_rules', 'devices', 'iot_vulnerabilities', 'security_alerts']","    found_tables = [t[0] for t in tables]","    ","    for table in expected_tables:","        if table in found_tables:","            # Get row count","            cursor.execute(f\"SELECT COUNT(*) FROM {table}\")","            count = cursor.fetchone()[0]","            logging.info(f\"   ✓ {table:25s} - {count} rows\")","        else:","            logging.warning(f\"   ✗ {table:25s} - NOT FOUND\")","    ","    conn.close()","    ","    logging.info(\"\\n\" + \"=\" * 60)","    logging.info(\"System initialization complete!\")","    logging.info(\"=\" * 60)","    ","    # 7. Check if device_tracker needs to run","    conn = sqlite3.connect(DB_PATH)","    cursor = conn.cursor()","    cursor.execute(\"SELECT COUNT(*) FROM devices\")","    device_count = cursor.fetchone()[0]","    conn.close()","    ","    if device_count == 0:","        logging.info(\"\\n⚠️  RECOMMENDATION:\")","        logging.info(\"    No devices found in database.\")","        logging.info(\"    Run: python3 /home/jarvis/NetGuard/scripts/device_tracker.py\")","        logging.info(\"    Or start unified_device_processor service\")","    else:","        logging.info(f\"\\n✓ System is ready! {device_count} devices tracked.\")","    ","    return True","","if __name__ == \"__main__\":","    try:","        success = initialize_all_tables()","        sys.exit(0 if success else 1)","    except Exception as e:","        logging.error(f\"Fatal error during initialization: {e}\")","        sys.exit(1)","",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000003,1000001,1000004,1000005,1000006,1000007,1000008,1000004,1000009,1000010,1000011,1000012,1000013,1000004,1000014,1000004,1000015,1000016,1000017,1000018,1000019,1000018,1000017,1000020,1000021,1000022,1000023,1000017,1000024,1000025,1000017,1000026,1000027,1000028,1000029,1000030,1000031,1000032,1000033,1000034,1000035,1000036,1000037,1000038,1000039,1000040,1000041,1000042,1000043,1000044,1000045,1000046,1000047,1000048,1000049,1000050,1000017,1000051,1000052,1000028,1000029,1000053,1000054,1000055,1000056,1000057,1000058,1000059,1000060,1000061,1000062,1000063,1000043,1000044,1000064,1000065,1000066,1000049,1000067,1000017,1000068,1000069,1000028,1000029,1000070,1000054,1000071,1000058,1000072,1000073,1000074,1000075,1000076,1000077,1000078,1000079,1000080,1000081,1000082,1000083,1000084,1000085,1000086,1000087,1000088,1000089,1000090,1000043,1000044,1000091,1000092,1000093,1000094,1000049,1000095,1000017,1000096,1000097,1000028,1000029,1000098,1000054,1000099,1000100,1000101,1000102,1000103,1000043,1000044,1000104,1000105,1000049,1000106,1000017,1000107,1000108,1000028,1000029,1000109,1000054,1000110,1000111,1000112,1000113,1000058,1000114,1000115,1000084,1000116,1000043,1000044,1000117,1000049,1000118,1000017,1000119,1000017,1000120,1000121,1000122,1000123,1000124,1000125,1000126,1000127,1000128,1000017,1000129,1000130,1000017,1000131,1000132,1000133,1000134,1000135,1000136,1000137,1000138,1000017,1000139,1000017,1000140,1000141,1000018,1000017,1000142,1000024,1000025,1000143,1000144,1000139,1000017,1000145,1000146,1000147,1000148,1000149,1000150,1000151,1000017,1000152,1000004,1000153,1000028,1000154,1000155,1000049,1000156,1000157,1000004,1000004]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}