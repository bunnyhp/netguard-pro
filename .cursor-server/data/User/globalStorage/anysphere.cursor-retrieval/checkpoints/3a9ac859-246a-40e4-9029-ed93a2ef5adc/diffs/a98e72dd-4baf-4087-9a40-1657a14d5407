{"fsPath":"\\home\\jarvis\\NetGuard\\web\\app.py","fileUuid":"a98e72dd-4baf-4087-9a40-1657a14d5407","fileSizeBytes":46597,"numLines":1249,"diffChanges":[{"originalStartLineNumberOneIndexed":248,"originalEndLineNumberExclusiveOneIndexed":250,"modifiedStartLineNumberOneIndexed":248,"modifiedEndLineNumberExclusiveOneIndexed":253,"addedLines":["    \"\"\"Main dashboard with real-time data\"\"\"","    conn = get_db_connection()","    cursor = conn.cursor()","    ","    # Get all tables"],"tokenizedAddedLines":[1000740,22,23,179,1000741]},{"originalStartLineNumberOneIndexed":252,"originalEndLineNumberExclusiveOneIndexed":263,"modifiedStartLineNumberOneIndexed":255,"modifiedEndLineNumberExclusiveOneIndexed":353,"addedLines":["    # === REAL DEVICE DATA ===","    cursor.execute(\"SELECT COUNT(*) as total FROM devices\")","    total_devices = cursor.fetchone()['total']","    ","    cursor.execute(\"\"\"","        SELECT device_type, COUNT(*) as count ","        FROM devices ","        GROUP BY device_type","    \"\"\")","    device_types = {row['device_type']: row['count'] for row in cursor.fetchall()}","    ","    cursor.execute(\"\"\"","        SELECT ip_address, hostname, device_type, vendor, security_score, last_seen","        FROM devices ","        ORDER BY last_seen DESC ","        LIMIT 10","    \"\"\")","    recent_devices = [dict(row) for row in cursor.fetchall()]","    ","    # === REAL TRAFFIC DATA ===","    total_packets = 0","    protocol_distribution = {}","    ","    # Get latest tcpdump table","    tcpdump_tables = [t for t in all_tables if t.startswith('tcpdump_') and not t.endswith('_template')]","    if tcpdump_tables:","        latest_tcpdump = sorted(tcpdump_tables)[-1]","        cursor.execute(f\"SELECT COUNT(*) as count FROM {latest_tcpdump}\")","        total_packets = cursor.fetchone()['count']","        ","        cursor.execute(f\"SELECT protocol, COUNT(*) as count FROM {latest_tcpdump} GROUP BY protocol\")","        protocol_distribution = {row['protocol']: row['count'] for row in cursor.fetchall()}","    ","    # === REAL IoT DATA ===","    cursor.execute(\"SELECT COUNT(*) as count FROM iot_vulnerabilities WHERE resolved=0\")","    iot_vulns = cursor.fetchone()['count']","    ","    # === REAL AI ANALYSIS ===","    cursor.execute(\"\"\"","        SELECT threat_level, network_health_score, timestamp","        FROM ai_analysis ","        ORDER BY timestamp DESC ","        LIMIT 1","    \"\"\")","    ai_result = cursor.fetchone()","    if ai_result:","        ai_data = {","            'threat_level': ai_result['threat_level'],","            'health_score': ai_result['network_health_score'],","            'last_analysis': ai_result['timestamp']","        }","    else:","        ai_data = {'threat_level': 'UNKNOWN', 'health_score': 0, 'last_analysis': 'Never'}","    ","    # === SERVICE STATUS ===","    services = {","        'p0f': len([t for t in all_tables if t.startswith('p0f_')]),","        'tshark': len([t for t in all_tables if t.startswith('tshark_')]),","        'tcpdump': len([t for t in all_tables if t.startswith('tcpdump_')]),","        'suricata': len([t for t in all_tables if t.startswith('suricata_')]),","        'ngrep': len([t for t in all_tables if t.startswith('ngrep_')]),","        'httpry': len([t for t in all_tables if t.startswith('httpry_')]),","        'argus': len([t for t in all_tables if t.startswith('argus_')]),","        'netsniff': len([t for t in all_tables if t.startswith('netsniff_')]),","        'iftop': len([t for t in all_tables if t.startswith('iftop_')]),","        'nethogs': len([t for t in all_tables if t.startswith('nethogs_')])","    }","    ","    active_services = sum(1 for count in services.values() if count > 0)","    ","    # === TOP TALKERS ===","    top_talkers = []","    if tcpdump_tables:","        cursor.execute(f\"\"\"","            SELECT src_ip, COUNT(*) as packet_count","            FROM {latest_tcpdump}","            WHERE src_ip LIKE '192.168.%'","            GROUP BY src_ip","            ORDER BY packet_count DESC","            LIMIT 5","        \"\"\")","        top_talkers = [dict(row) for row in cursor.fetchall()]","    ","    conn.close()","    ","    # Prepare data for template","    dashboard_data = {","        'total_devices': total_devices,","        'device_types': device_types,","        'recent_devices': recent_devices,","        'total_packets': total_packets,","        'protocol_distribution': protocol_distribution,","        'iot_vulnerabilities': iot_vulns,","        'ai_analysis': ai_data,","        'active_services': active_services,","        'total_services': 10,","        'services': services,","        'top_talkers': top_talkers,"],"tokenizedAddedLines":[1000742,1000743,1000744,179,381,1000745,1000746,1000747,384,1000748,179,381,1000749,1000746,1000750,1000751,384,1000752,179,1000753,1000754,1000755,179,1000756,1000757,1000758,1000759,1000760,1000761,47,1000762,1000763,179,1000764,1000765,1000766,179,1000767,381,1000768,463,1000769,1000770,384,1000771,1000772,1000773,1000774,1000775,1000776,72,1000777,1000778,179,1000779,1000780,1000781,1000782,1000783,1000784,1000785,1000786,1000787,1000788,1000789,1000790,191,179,1000791,179,1000792,1000793,1000758,1000794,1000795,1000796,1000797,1000798,1000799,1000800,560,1000801,179,26,179,1000802,1000803,1000804,1000805,1000806,1000807,1000808,1000809,1000810,1000811,1000812,1000813,1000814]},{"originalStartLineNumberOneIndexed":266,"originalEndLineNumberExclusiveOneIndexed":267,"modifiedStartLineNumberOneIndexed":356,"modifiedEndLineNumberExclusiveOneIndexed":357,"addedLines":["    return render_template('index.html', data=dashboard_data)"],"tokenizedAddedLines":[1000815]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}