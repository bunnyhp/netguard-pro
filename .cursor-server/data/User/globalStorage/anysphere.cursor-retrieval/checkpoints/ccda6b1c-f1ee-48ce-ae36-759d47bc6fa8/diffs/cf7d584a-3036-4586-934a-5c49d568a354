{"fsPath":"\\home\\jarvis\\NetGuard\\scripts\\iot_security_scanner.py","fileUuid":"cf7d584a-3036-4586-934a-5c49d568a354","fileSizeBytes":19639,"numLines":499,"diffChanges":[{"originalStartLineNumberOneIndexed":332,"originalEndLineNumberExclusiveOneIndexed":332,"modifiedStartLineNumberOneIndexed":332,"modifiedEndLineNumberExclusiveOneIndexed":419,"addedLines":["    def check_unencrypted_traffic(self, device):","        \"\"\"Check if device is sending unencrypted traffic\"\"\"","        try:","            conn = sqlite3.connect(DB_PATH)","            cursor = conn.cursor()","            ","            # Get latest traffic table","            cursor.execute(\"\"\"","                SELECT name FROM sqlite_master ","                WHERE type='table' AND (name LIKE 'tcpdump_%' OR name LIKE 'tshark_%')","                AND name NOT LIKE '%_template'","                ORDER BY name DESC LIMIT 1","            \"\"\")","            ","            table_result = cursor.fetchone()","            if table_result:","                table_name = table_result[0]","                ","                # Count HTTP vs HTTPS","                cursor.execute(f\"\"\"","                    SELECT ","                        COUNT(CASE WHEN dest_port = 80 THEN 1 END) as http_count,","                        COUNT(CASE WHEN dest_port = 443 THEN 1 END) as https_count","                    FROM {table_name}","                    WHERE src_ip = ?","                    AND dest_port IN (80, 443)","                \"\"\", (device['ip_address'],))","                ","                result = cursor.fetchone()","                if result and result[0] > 5:  # More than 5 HTTP connections","                    http_count = result[0]","                    https_count = result[1]","                    total_web = http_count + https_count","                    http_ratio = (http_count / total_web * 100) if total_web > 0 else 0","                    ","                    if http_ratio > 30:  # More than 30% unencrypted","                        self.record_vulnerability(","                            device=device,","                            vuln_type=\"Unencrypted Traffic\",","                            severity=\"MEDIUM\",","                            description=f\"Device sends {http_ratio:.0f}% of web traffic unencrypted (HTTP:{http_count}, HTTPS:{https_count}). Sensitive data may be exposed.\",","                            recommendation=\"Configure device to use HTTPS. Check device security settings and disable HTTP if possible.\"","                        )","            ","            conn.close()","        except Exception as e:","            logging.error(f\"Error checking unencrypted traffic: {e}\")","    ","    def check_device_security_score(self, device):","        \"\"\"Evaluate overall device security posture\"\"\"","        issues = []","        severity = \"LOW\"","        ","        # Check if device has a MAC address","        if not device.get('mac_address'):","            issues.append(\"No MAC address identified\")","            severity = \"MEDIUM\"","        ","        # Check if device has a hostname","        if not device.get('hostname') or device.get('hostname') == '':","            issues.append(\"No hostname resolution\")","        ","        # Check security score","        security_score = device.get('security_score', 50)","        if security_score < 40:","            issues.append(f\"Low security score ({security_score}/100)\")","            severity = \"HIGH\"","        elif security_score < 60:","            issues.append(f\"Below-average security score ({security_score}/100)\")","            if severity == \"LOW\":","                severity = \"MEDIUM\"","        ","        # Check if it's an unknown device type","        if device.get('device_type') == 'Unknown':","            issues.append(\"Unknown device type\")","            if severity == \"LOW\":","                severity = \"MEDIUM\"","        ","        if len(issues) >= 2:  # Multiple issues","            self.record_vulnerability(","                device=device,","                vuln_type=\"Poor Security Posture\",","                severity=severity,","                description=f\"Device has {len(issues)} security concerns: {'; '.join(issues)}\",","                recommendation=\"Review device configuration, verify it's authorized, improve security settings, and ensure firmware is up to date.\"","            )","    "],"tokenizedAddedLines":[1000286,1000287,37,38,39,40,1000288,41,132,133,134,135,55,40,136,137,1000289,139,1000290,141,1000291,1000292,1000293,143,144,1000294,147,139,1000295,1000296,1000297,1000298,1000299,1000300,151,1000301,1000302,1000303,1000304,1000305,1000306,1000307,1000308,40,59,61,1000309,34,1000310,1000311,1000312,1000313,82,1000314,1000315,1000316,1000317,82,1000318,1000319,1000320,82,1000321,1000322,1000323,1000324,1000325,1000326,1000327,1000328,1000329,82,1000330,1000331,1000332,1000328,1000329,82,1000333,100,101,1000334,1000335,1000336,1000337,106,34]},{"originalStartLineNumberOneIndexed":343,"originalEndLineNumberExclusiveOneIndexed":343,"modifiedStartLineNumberOneIndexed":430,"modifiedEndLineNumberExclusiveOneIndexed":432,"addedLines":["        self.check_unencrypted_traffic(device)","        self.check_device_security_score(device)"],"tokenizedAddedLines":[1000338,1000339]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}