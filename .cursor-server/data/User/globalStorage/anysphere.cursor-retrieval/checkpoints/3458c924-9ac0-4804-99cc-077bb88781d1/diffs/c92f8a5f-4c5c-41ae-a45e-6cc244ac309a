{"fsPath":"\\home\\jarvis\\NetGuard\\web\\app.py","fileUuid":"c92f8a5f-4c5c-41ae-a45e-6cc244ac309a","fileSizeBytes":16532,"numLines":460,"diffChanges":[{"originalStartLineNumberOneIndexed":70,"originalEndLineNumberExclusiveOneIndexed":70,"modifiedStartLineNumberOneIndexed":70,"modifiedEndLineNumberExclusiveOneIndexed":154,"addedLines":["def get_tshark_statistics(tables):","    \"\"\"Get comprehensive statistics for tshark data\"\"\"","    try:","        conn = get_db_connection()","        cursor = conn.cursor()","        ","        # Combine all tshark tables for analysis","        stats = {","            'total_packets': 0,","            'protocols': {},","            'top_sources': {},","            'top_destinations': {},","            'port_activity': {},","            'packet_sizes': {'small': 0, 'medium': 0, 'large': 0},","            'suspicious_activity': []","        }","        ","        for table in tables:","            try:","                # Get protocol distribution","                cursor.execute(f\"SELECT protocol, COUNT(*) as cnt FROM {table} WHERE protocol IS NOT NULL AND protocol != '' GROUP BY protocol\")","                for row in cursor.fetchall():","                    proto = row[0]","                    count = row[1]","                    stats['protocols'][proto] = stats['protocols'].get(proto, 0) + count","                    stats['total_packets'] += count","                ","                # Get top source IPs","                cursor.execute(f\"SELECT src_ip, COUNT(*) as cnt FROM {table} WHERE src_ip IS NOT NULL AND src_ip != '' GROUP BY src_ip ORDER BY cnt DESC LIMIT 10\")","                for row in cursor.fetchall():","                    ip = row[0]","                    count = row[1]","                    stats['top_sources'][ip] = stats['top_sources'].get(ip, 0) + count","                ","                # Get top destination IPs","                cursor.execute(f\"SELECT dest_ip, COUNT(*) as cnt FROM {table} WHERE dest_ip IS NOT NULL AND dest_ip != '' GROUP BY dest_ip ORDER BY cnt DESC LIMIT 10\")","                for row in cursor.fetchall():","                    ip = row[0]","                    count = row[1]","                    stats['top_destinations'][ip] = stats['top_destinations'].get(ip, 0) + count","                ","                # Get port activity","                cursor.execute(f\"SELECT dest_port, COUNT(*) as cnt FROM {table} WHERE dest_port IS NOT NULL GROUP BY dest_port ORDER BY cnt DESC LIMIT 15\")","                for row in cursor.fetchall():","                    port = row[0]","                    count = row[1]","                    stats['port_activity'][port] = stats['port_activity'].get(port, 0) + count","                ","                # Analyze packet sizes","                cursor.execute(f\"SELECT length FROM {table} WHERE length IS NOT NULL\")","                for row in cursor.fetchall():","                    size = row[0]","                    if size <= 100:","                        stats['packet_sizes']['small'] += 1","                    elif size <= 500:","                        stats['packet_sizes']['medium'] += 1","                    else:","                        stats['packet_sizes']['large'] += 1","                ","                # Detect suspicious patterns","                # High port numbers (potential backdoors)","                cursor.execute(f\"SELECT DISTINCT dest_port, COUNT(*) as cnt FROM {table} WHERE dest_port > 50000 GROUP BY dest_port HAVING cnt > 5\")","                for row in cursor.fetchall():","                    stats['suspicious_activity'].append({","                        'type': 'High Port Activity',","                        'detail': f'Port {row[0]}: {row[1]} connections',","                        'severity': 'medium'","                    })","                ","            except Exception as e:","                print(f\"Error processing table {table}: {e}\")","                continue","        ","        # Sort and limit","        stats['protocols'] = dict(sorted(stats['protocols'].items(), key=lambda x: x[1], reverse=True)[:10])","        stats['top_sources'] = dict(sorted(stats['top_sources'].items(), key=lambda x: x[1], reverse=True)[:10])","        stats['top_destinations'] = dict(sorted(stats['top_destinations'].items(), key=lambda x: x[1], reverse=True)[:10])","        ","        conn.close()","        return stats","    except Exception as e:","        print(f\"Error getting tshark statistics: {e}\")","        return None",""],"tokenizedAddedLines":[1000252,1000253,34,35,36,47,1000254,1000255,1000256,1000257,1000258,1000259,1000260,1000261,1000262,206,47,1000263,113,1000264,1000265,1000266,1000267,1000268,1000269,1000270,1000271,1000272,1000273,1000266,1000274,1000268,1000275,1000271,1000276,1000277,1000266,1000274,1000268,1000278,1000271,1000279,1000280,1000266,1000281,1000268,1000282,1000271,1000283,1000284,1000266,1000285,1000286,1000287,1000288,1000289,1000290,1000291,1000271,1000292,1000293,1000294,1000266,1000295,1000296,1000297,1000298,1000299,1000271,1000300,1000301,1000302,47,1000303,1000304,1000305,1000306,47,39,1000307,53,1000308,1000309,5]},{"originalStartLineNumberOneIndexed":341,"originalEndLineNumberExclusiveOneIndexed":341,"modifiedStartLineNumberOneIndexed":425,"modifiedEndLineNumberExclusiveOneIndexed":430,"addedLines":["    # Enhanced statistics for tshark","    stats = None","    if tool_name == 'tshark' and tables:","        stats = get_tshark_statistics(tables)","    "],"tokenizedAddedLines":[1000310,1000311,1000312,1000313,60]},{"originalStartLineNumberOneIndexed":342,"originalEndLineNumberExclusiveOneIndexed":343,"modifiedStartLineNumberOneIndexed":431,"modifiedEndLineNumberExclusiveOneIndexed":432,"addedLines":["                         tables=table_info, latest_data=latest_data, stats=stats)"],"tokenizedAddedLines":[1000314]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}