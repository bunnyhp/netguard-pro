{"fsPath":"\\home\\jarvis\\NetGuard\\scripts\\check_services.sh","fileUuid":"aca3a055-9d76-43b1-a160-c922e1fff718","fileSizeBytes":6755,"numLines":204,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":205,"addedLines":["#!/bin/bash","","##############################################################################","# NetGuard Pro - Service Health Check Script","# Verifies all services are running and healthy","##############################################################################","","# Colors","GREEN='\\033[0;32m'","RED='\\033[0;31m'","YELLOW='\\033[1;33m'","CYAN='\\033[0;36m'","NC='\\033[0m'","","clear","","echo \"════════════════════════════════════════════════════════════════════\"","echo \"           NetGuard Pro - Service Health Check\"","echo \"════════════════════════════════════════════════════════════════════\"","echo \"\"","","# List of all services","SERVICES=(","    \"tshark-collector\"","    \"p0f-collector\"","    \"argus-collector\"","    \"ngrep-collector\"","    \"netsniff-collector\"","    \"httpry-collector\"","    \"iftop-collector\"","    \"nethogs-collector\"","    \"suricata-collector\"","    \"tcpdump-collector\"","    \"ai-aggregator\"","    \"flask-dashboard\"",")","","# Counters","RUNNING=0","STOPPED=0","ENABLED=0","DISABLED=0","","echo \"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\"","echo \"  SERVICE STATUS REPORT\"","echo \"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\"","echo \"\"","","printf \"%-25s %-15s %-15s %-15s\\n\" \"SERVICE\" \"STATUS\" \"BOOT ENABLED\" \"PID\"","printf \"%-25s %-15s %-15s %-15s\\n\" \"$(printf '%.0s─' {1..25})\" \"$(printf '%.0s─' {1..15})\" \"$(printf '%.0s─' {1..15})\" \"$(printf '%.0s─' {1..15})\"","","for service in \"${SERVICES[@]}\"; do","    # Check if service is active","    if systemctl is-active --quiet \"${service}.service\" 2>/dev/null; then","        STATUS=\"${GREEN}●${NC} Running\"","        ((RUNNING++))","        PID=$(systemctl show \"${service}.service\" -p MainPID --value 2>/dev/null)","    else","        STATUS=\"${RED}●${NC} Stopped\"","        ((STOPPED++))","        PID=\"-\"","    fi","    ","    # Check if service is enabled","    if systemctl is-enabled --quiet \"${service}.service\" 2>/dev/null; then","        BOOT_ENABLED=\"${GREEN}Yes${NC}\"","        ((ENABLED++))","    else","        BOOT_ENABLED=\"${RED}No${NC}\"","        ((DISABLED++))","    fi","    ","    printf \"%-25s \" \"${service}\"","    echo -ne \"${STATUS}    \"","    echo -ne \"${BOOT_ENABLED}         \"","    echo -e \"${PID}\"","done","","echo \"\"","echo \"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\"","echo \"  SUMMARY\"","echo \"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\"","echo \"\"","echo -e \"  Running Services:     ${GREEN}${RUNNING}${NC} / ${#SERVICES[@]}\"","echo -e \"  Stopped Services:     ${RED}${STOPPED}${NC}\"","echo -e \"  Boot-Enabled:         ${GREEN}${ENABLED}${NC}\"","echo -e \"  Not Enabled:          ${RED}${DISABLED}${NC}\"","echo \"\"","","# Check crash protection","echo \"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\"","echo \"  CRASH PROTECTION STATUS\"","echo \"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\"","echo \"\"","","CRASH_PROTECTED=0","for service in \"${SERVICES[@]}\"; do","    RESTART_POLICY=$(systemctl show \"${service}.service\" -p Restart --value 2>/dev/null)","    if [ \"$RESTART_POLICY\" = \"always\" ]; then","        ((CRASH_PROTECTED++))","    fi","done","","echo -e \"  Services with auto-restart:  ${GREEN}${CRASH_PROTECTED}${NC} / ${#SERVICES[@]}\"","echo \"\"","","# Check recent failures","echo \"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\"","echo \"  RECENT FAILURES (Last 24 hours)\"","echo \"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\"","echo \"\"","","FAILURES_FOUND=0","for service in \"${SERVICES[@]}\"; do","    FAILED_COUNT=$(journalctl -u \"${service}.service\" --since \"24 hours ago\" | grep -c \"Failed\" || echo 0)","    if [ \"$FAILED_COUNT\" -gt 0 ]; then","        echo -e \"  ${YELLOW}⚠${NC} ${service}: ${FAILED_COUNT} failures\"","        ((FAILURES_FOUND++))","    fi","done","","if [ \"$FAILURES_FOUND\" -eq 0 ]; then","    echo -e \"  ${GREEN}✓${NC} No service failures detected\"","fi","","echo \"\"","","# Database check","echo \"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\"","echo \"  DATABASE STATUS\"","echo \"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\"","echo \"\"","","DB_PATH=\"/home/jarvis/NetGuard/db/netguard.db\"","if [ -f \"$DB_PATH\" ]; then","    DB_SIZE=$(du -h \"$DB_PATH\" | cut -f1)","    echo -e \"  ${GREEN}✓${NC} Database exists: $DB_SIZE\"","    ","    # Count tables","    TABLE_COUNT=$(sqlite3 \"$DB_PATH\" \"SELECT COUNT(*) FROM sqlite_master WHERE type='table';\" 2>/dev/null || echo \"0\")","    echo -e \"  ${GREEN}✓${NC} Tables: $TABLE_COUNT\"","else","    echo -e \"  ${RED}✗${NC} Database not found\"","fi","","echo \"\"","","# Flask check","echo \"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\"","echo \"  WEB DASHBOARD\"","echo \"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\"","echo \"\"","","# Check Flask service","if systemctl is-active --quiet \"flask-dashboard.service\" 2>/dev/null; then","    echo -e \"  ${GREEN}✓${NC} Flask Dashboard Service: Running\"","    FLASK_PID=$(systemctl show \"flask-dashboard.service\" -p MainPID --value)","    echo -e \"  ${GREEN}✓${NC} PID: $FLASK_PID\"","elif pgrep -f \"python3.*app.py\" > /dev/null; then","    echo -e \"  ${YELLOW}⚠${NC} Flask running manually (not as service)\"","    FLASK_PID=$(pgrep -f \"python3.*app.py\")","    echo -e \"  ${YELLOW}⚠${NC} PID: $FLASK_PID\"","else","    echo -e \"  ${RED}✗${NC} Flask Dashboard: Not Running\"","fi","","# Test HTTP response","if curl -s -f -o /dev/null http://localhost:8080/ 2>/dev/null; then","    echo -e \"  ${GREEN}✓${NC} HTTP Endpoint: Responding\"","    echo -e \"  ${CYAN}→${NC} URL: http://localhost:8080/\"","else","    echo -e \"  ${RED}✗${NC} HTTP Endpoint: Not Responding\"","fi","","echo \"\"","","# Overall health","echo \"════════════════════════════════════════════════════════════════════\"","echo \"  OVERALL SYSTEM HEALTH\"","echo \"════════════════════════════════════════════════════════════════════\"","echo \"\"","","if [ \"$STOPPED\" -eq 0 ] && [ \"$DISABLED\" -eq 0 ]; then","    echo -e \"  ${GREEN}✅ EXCELLENT${NC} - All services running and enabled\"","elif [ \"$STOPPED\" -le 2 ] && [ \"$DISABLED\" -eq 0 ]; then","    echo -e \"  ${YELLOW}⚠ GOOD${NC} - Most services running, some need attention\"","else","    echo -e \"  ${RED}❌ NEEDS ATTENTION${NC} - Multiple services stopped or disabled\"","fi","","echo \"\"","echo \"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\"","echo \"  MANAGEMENT COMMANDS\"","echo \"━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\"","echo \"\"","echo \"  Start all services:    sudo systemctl start '*-collector.service' ai-aggregator.service flask-dashboard.service\"","echo \"  Stop all services:     sudo systemctl stop '*-collector.service' ai-aggregator.service flask-dashboard.service\"","echo \"  Restart all services:  sudo systemctl restart '*-collector.service' ai-aggregator.service flask-dashboard.service\"","echo \"  View service logs:     journalctl -u <service-name> -f\"","echo \"  Check specific:        systemctl status <service-name>\"","echo \"\"","echo \"════════════════════════════════════════════════════════════════════\"","",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000003,1000004,1000002,1000001,1000005,1000006,1000007,1000008,1000009,1000010,1000001,1000011,1000001,1000012,1000013,1000012,1000014,1000001,1000015,1000016,1000017,1000018,1000019,1000020,1000021,1000022,1000023,1000024,1000025,1000026,1000027,1000028,1000029,1000001,1000030,1000031,1000032,1000033,1000034,1000001,1000035,1000036,1000035,1000014,1000001,1000037,1000038,1000001,1000039,1000040,1000041,1000042,1000043,1000044,1000045,1000046,1000047,1000048,1000049,1000050,1000051,1000052,1000053,1000054,1000045,1000055,1000056,1000049,1000050,1000057,1000058,1000059,1000060,1000061,1000001,1000014,1000035,1000062,1000035,1000014,1000063,1000064,1000065,1000066,1000014,1000001,1000067,1000035,1000068,1000035,1000014,1000001,1000069,1000039,1000070,1000071,1000072,1000049,1000061,1000001,1000073,1000014,1000001,1000074,1000035,1000075,1000035,1000014,1000001,1000076,1000039,1000077,1000078,1000079,1000080,1000049,1000061,1000001,1000081,1000082,1000083,1000001,1000014,1000001,1000084,1000035,1000085,1000035,1000014,1000001,1000086,1000087,1000088,1000089,1000050,1000090,1000091,1000092,1000093,1000094,1000083,1000001,1000014,1000001,1000095,1000035,1000096,1000035,1000014,1000001,1000097,1000098,1000099,1000100,1000101,1000102,1000103,1000104,1000105,1000093,1000106,1000083,1000001,1000107,1000108,1000109,1000110,1000093,1000111,1000083,1000001,1000014,1000001,1000112,1000012,1000113,1000012,1000014,1000001,1000114,1000115,1000116,1000117,1000093,1000118,1000083,1000001,1000014,1000035,1000119,1000035,1000014,1000120,1000121,1000122,1000123,1000124,1000014,1000012,1000001,1000001]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}