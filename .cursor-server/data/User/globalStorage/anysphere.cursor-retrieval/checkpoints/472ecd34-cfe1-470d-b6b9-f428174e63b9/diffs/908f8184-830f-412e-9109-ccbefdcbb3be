{"fsPath":"\\home\\jarvis\\NetGuard\\scripts\\install_all_services.sh","fileUuid":"908f8184-830f-412e-9109-ccbefdcbb3be","fileSizeBytes":7600,"numLines":231,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":232,"addedLines":["#!/bin/bash","","##############################################################################","# NetGuard Pro - Complete Service Installation & Reboot-Proof Setup","# This script installs all NetGuard services with crash protection","##############################################################################","","set -e","","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"   NetGuard Pro - Complete Service Installation & Setup\"","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"\"","","# Colors for output","GREEN='\\033[0;32m'","RED='\\033[0;31m'","YELLOW='\\033[1;33m'","NC='\\033[0m' # No Color","","# Base directory","NETGUARD_DIR=\"/home/jarvis/NetGuard\"","SERVICE_DIR=\"$NETGUARD_DIR/services\"","LOG_DIR=\"$NETGUARD_DIR/logs/system\"","","# Create log directory if it doesn't exist","mkdir -p \"$LOG_DIR\"","","echo \"ğŸ“ NetGuard Directory: $NETGUARD_DIR\"","echo \"ğŸ“ Service Files: $SERVICE_DIR\"","echo \"ğŸ“ Log Directory: $LOG_DIR\"","echo \"\"","","# List of all NetGuard collector services","COLLECTOR_SERVICES=(","    \"tshark-collector\"","    \"p0f-collector\"","    \"argus-collector\"","    \"ngrep-collector\"","    \"netsniff-collector\"","    \"httpry-collector\"","    \"iftop-collector\"","    \"nethogs-collector\"","    \"suricata-collector\"","    \"tcpdump-collector\"",")","","# AI aggregator service (in /etc/systemd/system)","AI_SERVICE=\"ai-aggregator\"","","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"  Step 1: Installing Collector Services\"","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"\"","","for service in \"${COLLECTOR_SERVICES[@]}\"; do","    SERVICE_FILE=\"$SERVICE_DIR/${service}.service\"","    ","    if [ -f \"$SERVICE_FILE\" ]; then","        echo -n \"ğŸ“¦ Installing ${service}.service... \"","        ","        # Copy service file to systemd","        sudo cp \"$SERVICE_FILE\" /etc/systemd/system/","        ","        # Reload systemd","        sudo systemctl daemon-reload","        ","        # Enable service (auto-start on boot)","        sudo systemctl enable \"${service}.service\" 2>/dev/null || true","        ","        echo -e \"${GREEN}âœ“ Installed & Enabled${NC}\"","    else","        echo -e \"${RED}âœ— Service file not found: $SERVICE_FILE${NC}\"","    fi","done","","echo \"\"","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"  Step 2: Installing AI Aggregator Service\"","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"\"","","if [ -f \"/etc/systemd/system/${AI_SERVICE}.service\" ]; then","    echo -n \"ğŸ“¦ Enabling ${AI_SERVICE}.service... \"","    sudo systemctl daemon-reload","    sudo systemctl enable \"${AI_SERVICE}.service\" 2>/dev/null || true","    echo -e \"${GREEN}âœ“ Enabled${NC}\"","else","    echo -e \"${YELLOW}âš  AI Aggregator service not found in /etc/systemd/system${NC}\"","fi","","echo \"\"","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"  Step 3: Verifying Service Configurations\"","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"\"","","ALL_SERVICES=(\"${COLLECTOR_SERVICES[@]}\" \"$AI_SERVICE\")","","for service in \"${ALL_SERVICES[@]}\"; do","    SERVICE_PATH=\"/etc/systemd/system/${service}.service\"","    ","    if [ -f \"$SERVICE_PATH\" ]; then","        # Check for critical restart settings","        if grep -q \"Restart=always\" \"$SERVICE_PATH\"; then","            RESTART_CHECK=\"${GREEN}âœ“${NC}\"","        else","            RESTART_CHECK=\"${RED}âœ—${NC}\"","        fi","        ","        if grep -q \"WantedBy=multi-user.target\" \"$SERVICE_PATH\"; then","            BOOT_CHECK=\"${GREEN}âœ“${NC}\"","        else","            BOOT_CHECK=\"${RED}âœ—${NC}\"","        fi","        ","        echo -e \"${service}: Restart=${RESTART_CHECK} | Boot=${BOOT_CHECK}\"","    fi","done","","echo \"\"","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"  Step 4: Starting All Services\"","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"\"","","for service in \"${ALL_SERVICES[@]}\"; do","    echo -n \"ğŸš€ Starting ${service}... \"","    ","    if sudo systemctl start \"${service}.service\" 2>/dev/null; then","        sleep 1","        if systemctl is-active --quiet \"${service}.service\"; then","            echo -e \"${GREEN}âœ“ Running${NC}\"","        else","            echo -e \"${YELLOW}âš  Started but not active${NC}\"","        fi","    else","        echo -e \"${RED}âœ— Failed to start${NC}\"","    fi","done","","echo \"\"","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"  Step 5: Service Status Summary\"","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"\"","","printf \"%-25s %-10s %-10s %-15s\\n\" \"SERVICE\" \"STATUS\" \"ENABLED\" \"RESTART POLICY\"","printf \"%-25s %-10s %-10s %-15s\\n\" \"-------\" \"------\" \"-------\" \"--------------\"","","for service in \"${ALL_SERVICES[@]}\"; do","    # Check if service is active","    if systemctl is-active --quiet \"${service}.service\"; then","        STATUS=\"${GREEN}Active${NC}\"","    else","        STATUS=\"${RED}Inactive${NC}\"","    fi","    ","    # Check if service is enabled","    if systemctl is-enabled --quiet \"${service}.service\" 2>/dev/null; then","        ENABLED=\"${GREEN}Yes${NC}\"","    else","        ENABLED=\"${RED}No${NC}\"","    fi","    ","    # Get restart policy","    RESTART_POLICY=$(systemctl show \"${service}.service\" -p Restart --value 2>/dev/null || echo \"unknown\")","    ","    printf \"%-25s \" \"${service}\"","    echo -ne \"${STATUS}   \"","    echo -ne \"${ENABLED}      \"","    echo -e \"${RESTART_POLICY}\"","done","","echo \"\"","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"  Step 6: Flask Web Dashboard\"","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"\"","","# Check if Flask is running","if pgrep -f \"python3.*app.py\" > /dev/null; then","    echo -e \"${GREEN}âœ“ Flask dashboard is running${NC}\"","    FLASK_PID=$(pgrep -f \"python3.*app.py\")","    echo \"  PID: $FLASK_PID\"","else","    echo -e \"${YELLOW}âš  Flask dashboard is not running${NC}\"","    echo \"  Starting Flask...\"","    cd \"$NETGUARD_DIR/web\"","    nohup python3 app.py > /dev/null 2>&1 &","    sleep 2","    if pgrep -f \"python3.*app.py\" > /dev/null; then","        echo -e \"${GREEN}âœ“ Flask started successfully${NC}\"","    else","        echo -e \"${RED}âœ— Failed to start Flask${NC}\"","    fi","fi","","echo \"\"","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"  ğŸ¯ REBOOT-PROOF CONFIGURATION SUMMARY\"","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"\"","echo \"âœ… All services configured with:\"","echo \"   â€¢ Restart=always (auto-restart on crash)\"","echo \"   â€¢ RestartSec=10 (10 second delay between restarts)\"","echo \"   â€¢ WantedBy=multi-user.target (auto-start on boot)\"","echo \"\"","echo \"âœ… Crash Protection Features:\"","echo \"   â€¢ Automatic restart on failure\"","echo \"   â€¢ Exponential backoff on repeated failures\"","echo \"   â€¢ Resource limits (CPU, Memory) to prevent system overload\"","echo \"   â€¢ Comprehensive logging for all services\"","echo \"\"","echo \"âœ… Service Management Commands:\"","echo \"   â€¢ Check all services:  sudo systemctl status '*-collector.service'\"","echo \"   â€¢ Stop all services:   sudo systemctl stop '*-collector.service'\"","echo \"   â€¢ Start all services:  sudo systemctl start '*-collector.service'\"","echo \"   â€¢ View logs:           journalctl -u <service-name> -f\"","echo \"\"","echo \"âœ… After Reboot:\"","echo \"   â€¢ All services will start automatically\"","echo \"   â€¢ Data collection continues without intervention\"","echo \"   â€¢ Flask dashboard needs manual start (or add to cron)\"","echo \"\"","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"  âœ… Installation Complete!\"","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"\"","",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000003,1000004,1000002,1000001,1000005,1000001,1000006,1000007,1000006,1000008,1000001,1000009,1000010,1000011,1000012,1000013,1000001,1000014,1000015,1000016,1000017,1000001,1000018,1000019,1000001,1000020,1000021,1000022,1000008,1000001,1000023,1000024,1000025,1000026,1000027,1000028,1000029,1000030,1000031,1000032,1000033,1000034,1000035,1000001,1000036,1000037,1000001,1000038,1000039,1000038,1000008,1000001,1000040,1000041,1000042,1000043,1000044,1000045,1000046,1000047,1000045,1000048,1000049,1000045,1000050,1000051,1000045,1000052,1000053,1000054,1000055,1000056,1000001,1000008,1000038,1000057,1000038,1000008,1000001,1000058,1000059,1000060,1000061,1000062,1000063,1000064,1000065,1000001,1000008,1000038,1000066,1000038,1000008,1000001,1000067,1000001,1000068,1000069,1000042,1000070,1000071,1000072,1000073,1000074,1000075,1000076,1000045,1000077,1000078,1000074,1000079,1000076,1000045,1000080,1000055,1000056,1000001,1000008,1000038,1000081,1000038,1000008,1000001,1000068,1000082,1000042,1000083,1000084,1000085,1000086,1000074,1000087,1000076,1000053,1000088,1000055,1000056,1000001,1000008,1000038,1000089,1000038,1000008,1000001,1000090,1000091,1000001,1000068,1000092,1000093,1000094,1000053,1000095,1000055,1000042,1000096,1000097,1000098,1000053,1000099,1000055,1000042,1000100,1000101,1000042,1000102,1000103,1000104,1000105,1000056,1000001,1000008,1000038,1000106,1000038,1000008,1000001,1000107,1000108,1000109,1000110,1000111,1000063,1000112,1000113,1000114,1000115,1000116,1000117,1000118,1000053,1000119,1000055,1000065,1000001,1000008,1000038,1000120,1000038,1000008,1000121,1000122,1000123,1000124,1000008,1000125,1000126,1000127,1000128,1000129,1000008,1000130,1000131,1000132,1000133,1000134,1000008,1000135,1000136,1000137,1000138,1000008,1000038,1000139,1000038,1000008,1000001,1000001]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}