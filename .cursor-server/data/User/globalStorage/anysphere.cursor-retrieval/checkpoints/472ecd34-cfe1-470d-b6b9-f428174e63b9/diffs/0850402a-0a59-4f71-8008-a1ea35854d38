{"fsPath":"\\home\\jarvis\\NetGuard\\REBOOT_CRASH_PROTECTION.md","fileUuid":"0850402a-0a59-4f71-8008-a1ea35854d38","fileSizeBytes":9994,"numLines":410,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":411,"addedLines":["# NetGuard Pro - Reboot & Crash Protection Guide","","## üõ°Ô∏è Overview","","All NetGuard services are configured with **industrial-grade reliability** features to ensure:","- ‚úÖ Automatic start on system boot","- ‚úÖ Automatic restart on crash/failure  ","- ‚úÖ Protection against repeated crashes","- ‚úÖ Resource limits to prevent system overload","- ‚úÖ Comprehensive logging for troubleshooting","","---","","## üìã Protected Services","","### Data Collection Services (10 tools)","1. **tshark-collector** - Packet analysis","2. **p0f-collector** - OS fingerprinting","3. **argus-collector** - Flow analysis","4. **ngrep-collector** - Pattern matching","5. **netsniff-collector** - Packet inspection","6. **httpry-collector** - HTTP logging","7. **iftop-collector** - Bandwidth monitoring","8. **nethogs-collector** - Process monitoring","9. **suricata-collector** - IDS/IPS","10. **tcpdump-collector** - Raw packet capture","","### Analysis & Dashboard Services","11. **ai-aggregator** - AI data aggregation & analysis","12. **flask-dashboard** - Web interface","","---","","## üîß Crash Protection Features","","### 1. Auto-Restart Configuration","Every service has these settings:","","```ini","[Service]","Restart=always              # Always restart on failure","RestartSec=10              # Wait 10 seconds between restarts","StartLimitBurst=5          # Allow up to 5 rapid restarts","StartLimitIntervalSec=60   # Within 60 seconds","```","","**What this means:**","- If a service crashes, it automatically restarts after 10 seconds","- If it crashes repeatedly (5 times in 60 seconds), systemd stops trying temporarily","- After the limit interval, systemd will try again","- This prevents infinite crash loops","","### 2. Resource Limits","Each service is protected with:","","```ini","MemoryMax=500M            # Maximum RAM usage","CPUQuota=50%              # Maximum CPU usage (50% of one core)","LimitNOFILE=65535         # Maximum open files","```","","**Why this matters:**","- Prevents memory leaks from crashing the system","- Ensures fair CPU distribution","- Allows handling high packet rates","","### 3. Boot-Time Activation","","```ini","[Install]","WantedBy=multi-user.target","```","","**What this does:**","- Services start automatically when system reaches multi-user mode (normal boot)","- No manual intervention needed after reboot","","### 4. Network Dependency","","```ini","[Unit]","After=network-online.target","Wants=network-online.target","```","","**Why this matters:**","- Services wait for network interfaces to be ready","- Prevents failures due to missing network adapters","","---","","## üöÄ Installation & Setup","","### Quick Setup (Automated)","","```bash","# Make scripts executable","cd /home/jarvis/NetGuard/scripts","chmod +x install_all_services.sh check_services.sh reboot_test_setup.sh","","# Run complete setup (installs, enables, and tests all services)","sudo bash reboot_test_setup.sh","```","","This script will:","1. ‚úÖ Install all 12 services","2. ‚úÖ Enable boot-time auto-start","3. ‚úÖ Verify crash protection settings","4. ‚úÖ Start all services","5. ‚úÖ Test auto-restart functionality","6. ‚úÖ Display health report","","---","","## üìä Monitoring & Management","","### Check Service Health","","```bash","# Comprehensive health check","bash /home/jarvis/NetGuard/scripts/check_services.sh","```","","This shows:","- ‚úÖ Which services are running","- ‚úÖ Which are enabled for boot","- ‚úÖ PIDs of running processes","- ‚úÖ Recent failures (last 24h)","- ‚úÖ Database status","- ‚úÖ Web dashboard status","- ‚úÖ Overall system health","","### Manual Service Management","","```bash","# Check status of a specific service","sudo systemctl status tshark-collector.service","","# Start a service","sudo systemctl start tshark-collector.service","","# Stop a service","sudo systemctl stop tshark-collector.service","","# Restart a service","sudo systemctl restart tshark-collector.service","","# View live logs","journalctl -u tshark-collector.service -f","","# View last 50 log entries","journalctl -u tshark-collector.service -n 50","```","","### Bulk Operations","","```bash","# Start ALL collector services","sudo systemctl start '*-collector.service'","","# Stop ALL collector services","sudo systemctl stop '*-collector.service'","","# Restart ALL collector services","sudo systemctl restart '*-collector.service'","","# Start everything (collectors + AI + dashboard)","sudo systemctl start '*-collector.service' ai-aggregator.service flask-dashboard.service","```","","---","","## üß™ Testing Crash Protection","","### Test 1: Manual Crash Simulation","","```bash","# Find PID of a service","systemctl status tshark-collector.service | grep \"Main PID\"","","# Kill it","sudo kill -9 <PID>","","# Wait 10 seconds and check if it restarted","sleep 11","systemctl status tshark-collector.service","```","","**Expected result:** Service should show a new PID and be \"active (running)\"","","### Test 2: Automated Crash Test","","```bash","# Run the reboot test script (includes crash test)","sudo bash /home/jarvis/NetGuard/scripts/reboot_test_setup.sh","```","","### Test 3: Reboot Test","","```bash","# Check all services are running","bash /home/jarvis/NetGuard/scripts/check_services.sh","","# Reboot","sudo reboot","","# After reboot, SSH back in and check again","bash /home/jarvis/NetGuard/scripts/check_services.sh","```","","**Expected result:** All services should auto-start after reboot","","---","","## üìù Log Files","","### Systemd Journal Logs","```bash","# View all NetGuard service logs","journalctl -u '*-collector.service' -u ai-aggregator.service -u flask-dashboard.service -f","```","","### Application Logs","Located in `/home/jarvis/NetGuard/logs/system/`:","","- `tshark-service.log` / `tshark-service-error.log`","- `p0f-service.log` / `p0f-service-error.log`","- `tcpdump-service.log` / `tcpdump-service-error.log`","- `flask-dashboard.log` / `flask-dashboard-error.log`","- ... (one pair for each service)","","```bash","# View logs","tail -f /home/jarvis/NetGuard/logs/system/tshark-service.log","","# View errors","tail -f /home/jarvis/NetGuard/logs/system/tshark-service-error.log","```","","---","","## üîç Troubleshooting","","### Service Won't Start","","```bash","# Check detailed status","sudo systemctl status <service-name>.service","","# Check full logs","journalctl -u <service-name>.service -n 100 --no-pager","","# Check for permission errors","ls -la /home/jarvis/NetGuard/captures/<tool-name>/","","# Fix permissions if needed","sudo chown -R jarvis:jarvis /home/jarvis/NetGuard/captures/","sudo chmod -R 755 /home/jarvis/NetGuard/captures/","```","","### Service Keeps Crashing","","```bash","# Check if hitting restart limit","systemctl show <service-name>.service -p NRestarts","","# Reset failed state","sudo systemctl reset-failed <service-name>.service","","# Check resource usage","systemctl show <service-name>.service -p MemoryCurrent -p CPUUsageNSec","","# Check crash logs","journalctl -u <service-name>.service --since \"1 hour ago\" | grep -i error","```","","### Service Not Auto-Starting on Boot","","```bash","# Check if enabled","systemctl is-enabled <service-name>.service","","# Enable if not","sudo systemctl enable <service-name>.service","","# Check for dependency issues","systemctl list-dependencies <service-name>.service","```","","---","","## üéØ Best Practices","","### 1. Regular Health Checks","```bash","# Add to cron for hourly checks","crontab -e","","# Add this line:","0 * * * * /bin/bash /home/jarvis/NetGuard/scripts/check_services.sh >> /home/jarvis/NetGuard/logs/health-checks.log 2>&1","```","","### 2. Monitor Disk Space","```bash","# Services generate logs and capture files","# Check disk usage regularly","df -h /home/jarvis/NetGuard/","","# Clean old captures if needed (older than 7 days)","find /home/jarvis/NetGuard/captures/ -type f -mtime +7 -delete","```","","### 3. Database Maintenance","```bash","# Vacuum database monthly to optimize","sqlite3 /home/jarvis/NetGuard/db/netguard.db \"VACUUM;\"","","# Check database size","du -h /home/jarvis/NetGuard/db/netguard.db","```","","### 4. Update Service Files","If you modify a service file:","```bash","# Reload systemd configuration","sudo systemctl daemon-reload","","# Restart the service","sudo systemctl restart <service-name>.service","```","","---","","## üìã Quick Reference Commands","","| Task | Command |","|------|---------|","| Health check | `bash /home/jarvis/NetGuard/scripts/check_services.sh` |","| Start all | `sudo systemctl start '*-collector.service' ai-aggregator.service flask-dashboard.service` |","| Stop all | `sudo systemctl stop '*-collector.service' ai-aggregator.service flask-dashboard.service` |","| Restart all | `sudo systemctl restart '*-collector.service' ai-aggregator.service flask-dashboard.service` |","| View logs | `journalctl -u <service> -f` |","| Check status | `systemctl status <service>` |","| Enable boot | `sudo systemctl enable <service>` |","| Disable boot | `sudo systemctl disable <service>` |","","---","","## ‚úÖ Verification Checklist","","After setup, verify:","","- [ ] All 12 services show as \"active (running)\"","- [ ] All 12 services show as \"enabled\" for boot","- [ ] Crash test passes (service auto-restarts)","- [ ] Flask dashboard accessible at http://localhost:8080","- [ ] Database file exists and is growing","- [ ] Log files are being written","- [ ] Reboot test passes (services auto-start)","- [ ] AI analysis cycles every 5 minutes","- [ ] No services hitting restart limits","","Run: `bash /home/jarvis/NetGuard/scripts/check_services.sh` to verify all items.","","---","","## üÜò Emergency Commands","","### Stop Everything Immediately","```bash","sudo systemctl stop '*-collector.service' ai-aggregator.service flask-dashboard.service","```","","### Prevent Auto-Start on Next Boot","```bash","sudo systemctl disable '*-collector.service' ai-aggregator.service flask-dashboard.service","```","","### Re-Enable Everything","```bash","sudo systemctl enable '*-collector.service' ai-aggregator.service flask-dashboard.service","sudo systemctl start '*-collector.service' ai-aggregator.service flask-dashboard.service","```","","---","","## üìû Support","","If services continue to fail after following this guide:","","1. Run the health check script and save output","2. Check service logs for errors","3. Verify network interfaces are up","4. Check disk space availability","5. Review systemd journal for system-level issues","","```bash","# Generate diagnostic report","bash /home/jarvis/NetGuard/scripts/check_services.sh > /tmp/netguard-diagnostic.txt","journalctl --since \"1 hour ago\" >> /tmp/netguard-diagnostic.txt","df -h >> /tmp/netguard-diagnostic.txt","```","","---","","**Last Updated:** $(date)  ","**Version:** NetGuard Pro v2.0  ","**Status:** Production Ready","",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000001,1000003,1000004,1000005,1000006,1000007,1000008,1000001,1000009,1000001,1000010,1000001,1000011,1000012,1000013,1000014,1000015,1000016,1000017,1000018,1000019,1000020,1000021,1000001,1000022,1000023,1000024,1000001,1000009,1000001,1000025,1000001,1000026,1000027,1000001,1000028,1000029,1000030,1000031,1000032,1000033,1000034,1000001,1000035,1000036,1000037,1000038,1000039,1000001,1000040,1000041,1000001,1000028,1000042,1000043,1000044,1000034,1000001,1000045,1000046,1000047,1000048,1000001,1000049,1000001,1000028,1000050,1000051,1000034,1000001,1000052,1000053,1000054,1000001,1000055,1000001,1000028,1000056,1000057,1000058,1000034,1000001,1000045,1000059,1000060,1000001,1000009,1000001,1000061,1000001,1000062,1000001,1000063,1000064,1000065,1000066,1000001,1000067,1000068,1000034,1000001,1000069,1000070,1000071,1000072,1000073,1000074,1000075,1000001,1000009,1000001,1000076,1000001,1000077,1000001,1000063,1000078,1000079,1000034,1000001,1000080,1000081,1000082,1000083,1000084,1000085,1000086,1000087,1000001,1000088,1000001,1000063,1000089,1000090,1000001,1000091,1000092,1000001,1000093,1000094,1000001,1000095,1000096,1000001,1000097,1000098,1000001,1000099,1000100,1000034,1000001,1000101,1000001,1000063,1000102,1000103,1000001,1000104,1000105,1000001,1000106,1000107,1000001,1000108,1000109,1000034,1000001,1000009,1000001,1000110,1000001,1000111,1000001,1000063,1000112,1000113,1000001,1000114,1000115,1000001,1000116,1000117,1000118,1000034,1000001,1000119,1000001,1000120,1000001,1000063,1000121,1000122,1000034,1000001,1000123,1000001,1000063,1000124,1000079,1000001,1000125,1000126,1000001,1000127,1000079,1000034,1000001,1000128,1000001,1000009,1000001,1000129,1000001,1000130,1000063,1000131,1000132,1000034,1000001,1000133,1000134,1000001,1000135,1000136,1000137,1000138,1000139,1000001,1000063,1000140,1000141,1000001,1000142,1000143,1000034,1000001,1000009,1000001,1000144,1000001,1000145,1000001,1000063,1000146,1000147,1000001,1000148,1000149,1000001,1000150,1000151,1000001,1000152,1000153,1000154,1000034,1000001,1000155,1000001,1000063,1000156,1000157,1000001,1000158,1000159,1000001,1000160,1000161,1000001,1000162,1000163,1000034,1000001,1000164,1000001,1000063,1000165,1000166,1000001,1000167,1000168,1000001,1000169,1000170,1000034,1000001,1000009,1000001,1000171,1000001,1000172,1000063,1000173,1000174,1000001,1000175,1000176,1000034,1000001,1000177,1000063,1000178,1000179,1000180,1000001,1000181,1000182,1000034,1000001,1000183,1000063,1000184,1000185,1000001,1000186,1000187,1000034,1000001,1000188,1000189,1000063,1000190,1000191,1000001,1000192,1000193,1000034,1000001,1000009,1000001,1000194,1000001,1000195,1000196,1000197,1000198,1000199,1000200,1000201,1000202,1000203,1000204,1000001,1000009,1000001,1000205,1000001,1000206,1000001,1000207,1000208,1000209,1000210,1000211,1000212,1000213,1000214,1000215,1000001,1000216,1000001,1000009,1000001,1000217,1000001,1000218,1000063,1000219,1000034,1000001,1000220,1000063,1000221,1000034,1000001,1000222,1000063,1000223,1000109,1000034,1000001,1000009,1000001,1000224,1000001,1000225,1000001,1000226,1000227,1000228,1000229,1000230,1000001,1000063,1000231,1000232,1000233,1000234,1000034,1000001,1000009,1000001,1000235,1000236,1000237,1000001,1000001]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}