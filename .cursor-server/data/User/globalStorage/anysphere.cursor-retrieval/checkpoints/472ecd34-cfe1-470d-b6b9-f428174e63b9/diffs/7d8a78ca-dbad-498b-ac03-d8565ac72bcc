{"fsPath":"\\home\\jarvis\\NetGuard\\scripts\\reboot_test_setup.sh","fileUuid":"7d8a78ca-dbad-498b-ac03-d8565ac72bcc","fileSizeBytes":7006,"numLines":227,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":228,"addedLines":["#!/bin/bash","","##############################################################################","# NetGuard Pro - Reboot-Proof Setup & Testing Script","# Makes the system bulletproof against crashes and reboots","##############################################################################","","set -e","","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"   NetGuard Pro - Reboot-Proof Configuration\"","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"\"","","# Check if running as root for service operations","if [ \"$EUID\" -ne 0 ]; then ","    echo \"âŒ This script must be run as root (use sudo)\"","    echo \"   Example: sudo bash $0\"","    exit 1","fi","","GREEN='\\033[0;32m'","YELLOW='\\033[1;33m'","CYAN='\\033[0;36m'","NC='\\033[0m'","","NETGUARD_DIR=\"/home/jarvis/NetGuard\"","","cd \"$NETGUARD_DIR\"","","echo \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"","echo \"  Phase 1: Installing All Services\"","echo \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"","echo \"\"","","# Install Flask dashboard service","echo \"ğŸ“¦ Installing Flask Dashboard Service...\"","cp \"$NETGUARD_DIR/services/flask-dashboard.service\" /etc/systemd/system/","systemctl daemon-reload","systemctl enable flask-dashboard.service","echo -e \"${GREEN}âœ“ Flask dashboard service installed${NC}\"","echo \"\"","","# Install all collector services","echo \"ğŸ“¦ Installing Collector Services...\"","for service_file in \"$NETGUARD_DIR/services\"/*-collector.service; do","    if [ -f \"$service_file\" ]; then","        service_name=$(basename \"$service_file\")","        cp \"$service_file\" /etc/systemd/system/","        echo \"  âœ“ Installed $service_name\"","    fi","done","","# Install AI aggregator (already in /etc/systemd/system)","if [ -f \"/etc/systemd/system/ai-aggregator.service\" ]; then","    echo \"  âœ“ AI Aggregator already installed\"","else","    echo \"  âš  AI Aggregator not found (may need manual installation)\"","fi","","systemctl daemon-reload","echo -e \"${GREEN}âœ“ All services copied to /etc/systemd/system${NC}\"","echo \"\"","","echo \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"","echo \"  Phase 2: Enabling Auto-Start on Boot\"","echo \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"","echo \"\"","","SERVICES=(","    \"tshark-collector\"","    \"p0f-collector\"","    \"argus-collector\"","    \"ngrep-collector\"","    \"netsniff-collector\"","    \"httpry-collector\"","    \"iftop-collector\"","    \"nethogs-collector\"","    \"suricata-collector\"","    \"tcpdump-collector\"","    \"ai-aggregator\"","    \"flask-dashboard\"",")","","for service in \"${SERVICES[@]}\"; do","    echo -n \"  Enabling ${service}... \"","    if systemctl enable \"${service}.service\" 2>/dev/null; then","        echo -e \"${GREEN}âœ“${NC}\"","    else","        echo -e \"${YELLOW}âš  Already enabled${NC}\"","    fi","done","","echo \"\"","echo -e \"${GREEN}âœ“ All services enabled for auto-start${NC}\"","echo \"\"","","echo \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"","echo \"  Phase 3: Verifying Crash Protection Settings\"","echo \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"","echo \"\"","","echo \"Checking restart policies...\"","echo \"\"","","for service in \"${SERVICES[@]}\"; do","    RESTART_POLICY=$(systemctl show \"${service}.service\" -p Restart --value 2>/dev/null || echo \"unknown\")","    RESTART_SEC=$(systemctl show \"${service}.service\" -p RestartSec --value 2>/dev/null || echo \"unknown\")","    ","    if [ \"$RESTART_POLICY\" = \"always\" ]; then","        echo -e \"  ${GREEN}âœ“${NC} ${service}: Restart=${RESTART_POLICY}, Delay=${RESTART_SEC}\"","    else","        echo -e \"  ${YELLOW}âš ${NC} ${service}: Restart=${RESTART_POLICY} (should be 'always')\"","    fi","done","","echo \"\"","","echo \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"","echo \"  Phase 4: Starting All Services\"","echo \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"","echo \"\"","","for service in \"${SERVICES[@]}\"; do","    echo -n \"  Starting ${service}... \"","    ","    # Stop first if running","    systemctl stop \"${service}.service\" 2>/dev/null || true","    sleep 1","    ","    # Start service","    if systemctl start \"${service}.service\" 2>/dev/null; then","        sleep 2","        if systemctl is-active --quiet \"${service}.service\"; then","            echo -e \"${GREEN}âœ“ Running${NC}\"","        else","            echo -e \"${YELLOW}âš  Started but not active yet${NC}\"","        fi","    else","        echo -e \"${RED}âœ— Failed${NC}\"","    fi","done","","echo \"\"","","echo \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"","echo \"  Phase 5: Crash Test (Simulated)\"","echo \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"","echo \"\"","","echo \"Testing auto-restart by killing a service...\"","echo \"\"","","# Test with tshark-collector","TEST_SERVICE=\"tshark-collector\"","echo \"  Target: ${TEST_SERVICE}\"","echo \"\"","","# Get PID before kill","PID_BEFORE=$(systemctl show \"${TEST_SERVICE}.service\" -p MainPID --value)","echo \"  PID before kill: $PID_BEFORE\"","","# Kill the service","echo \"  Killing service...\"","systemctl kill \"${TEST_SERVICE}.service\" 2>/dev/null || true","","# Wait for restart","echo \"  Waiting for auto-restart (10 seconds)...\"","sleep 11","","# Check if restarted","PID_AFTER=$(systemctl show \"${TEST_SERVICE}.service\" -p MainPID --value)","echo \"  PID after restart: $PID_AFTER\"","","if systemctl is-active --quiet \"${TEST_SERVICE}.service\"; then","    if [ \"$PID_BEFORE\" != \"$PID_AFTER\" ]; then","        echo -e \"  ${GREEN}âœ“ Service auto-restarted successfully!${NC}\"","    else","        echo -e \"  ${YELLOW}âš  Service is running but PID didn't change${NC}\"","    fi","else","    echo -e \"  ${RED}âœ— Service failed to restart${NC}\"","fi","","echo \"\"","","echo \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"","echo \"  Phase 6: Final Status Check\"","echo \"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\"","echo \"\"","","# Run the health check script","if [ -f \"$NETGUARD_DIR/scripts/check_services.sh\" ]; then","    bash \"$NETGUARD_DIR/scripts/check_services.sh\"","else","    echo \"Health check script not found, showing basic status:\"","    echo \"\"","    for service in \"${SERVICES[@]}\"; do","        systemctl status \"${service}.service\" --no-pager | head -3","        echo \"\"","    done","fi","","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"  âœ… REBOOT-PROOF SETUP COMPLETE!\"","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","echo \"\"","echo \"ğŸ¯ All services are now:\"","echo \"   â€¢ Auto-starting on boot\"","echo \"   â€¢ Auto-restarting on crash\"","echo \"   â€¢ Protected with resource limits\"","echo \"   â€¢ Logging to /home/jarvis/NetGuard/logs/system/\"","echo \"\"","echo \"ğŸ“Š Test reboot safety:\"","echo \"   sudo reboot\"","echo \"\"","echo \"   After reboot, run:\"","echo \"   bash /home/jarvis/NetGuard/scripts/check_services.sh\"","echo \"\"","echo \"ğŸ”§ Management:\"","echo \"   Start all:   sudo systemctl start '*-collector.service' ai-aggregator.service flask-dashboard.service\"","echo \"   Stop all:    sudo systemctl stop '*-collector.service' ai-aggregator.service flask-dashboard.service\"","echo \"   Status:      bash /home/jarvis/NetGuard/scripts/check_services.sh\"","echo \"\"","echo \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"","",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000003,1000004,1000002,1000001,1000005,1000001,1000006,1000007,1000006,1000008,1000001,1000009,1000010,1000011,1000012,1000013,1000014,1000001,1000015,1000016,1000017,1000018,1000001,1000019,1000001,1000020,1000001,1000021,1000022,1000021,1000008,1000001,1000023,1000024,1000025,1000026,1000027,1000028,1000008,1000001,1000029,1000030,1000031,1000032,1000033,1000034,1000035,1000036,1000037,1000001,1000038,1000039,1000040,1000041,1000042,1000014,1000001,1000026,1000043,1000008,1000001,1000021,1000044,1000021,1000008,1000001,1000045,1000046,1000047,1000048,1000049,1000050,1000051,1000052,1000053,1000054,1000055,1000056,1000057,1000058,1000001,1000059,1000060,1000061,1000062,1000063,1000064,1000036,1000037,1000001,1000008,1000065,1000008,1000001,1000021,1000066,1000021,1000008,1000001,1000067,1000008,1000001,1000059,1000068,1000069,1000070,1000071,1000072,1000063,1000073,1000036,1000037,1000001,1000008,1000001,1000021,1000074,1000021,1000008,1000001,1000059,1000075,1000070,1000076,1000077,1000078,1000070,1000079,1000080,1000081,1000082,1000083,1000084,1000085,1000086,1000063,1000087,1000036,1000037,1000001,1000008,1000001,1000021,1000088,1000021,1000008,1000001,1000089,1000008,1000001,1000090,1000091,1000092,1000008,1000001,1000093,1000094,1000095,1000001,1000096,1000097,1000098,1000001,1000099,1000100,1000101,1000001,1000102,1000103,1000104,1000001,1000105,1000106,1000107,1000063,1000108,1000036,1000041,1000109,1000014,1000001,1000008,1000001,1000021,1000110,1000021,1000008,1000001,1000111,1000112,1000113,1000041,1000114,1000115,1000116,1000117,1000118,1000119,1000014,1000001,1000006,1000120,1000006,1000008,1000121,1000122,1000123,1000124,1000125,1000008,1000126,1000127,1000008,1000128,1000129,1000008,1000130,1000131,1000132,1000133,1000008,1000006,1000001,1000001]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}