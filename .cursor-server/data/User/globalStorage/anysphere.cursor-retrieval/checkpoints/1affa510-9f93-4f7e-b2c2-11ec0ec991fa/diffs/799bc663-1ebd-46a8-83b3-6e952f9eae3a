{"fsPath":"\\home\\jarvis\\NetGuard\\scripts\\suricata_collector.py","fileUuid":"799bc663-1ebd-46a8-83b3-6e952f9eae3a","fileSizeBytes":27262,"numLines":717,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":718,"addedLines":["#!/usr/bin/env python3","\"\"\"","NetGuard Pro - Suricata EVE Log Collector","Processes Suricata EVE JSON logs and inserts data into SQLite database","Handles 11 categories: alerts, http, dns, tls, files, flow, ssh, smtp, ftp, anomaly, stats","\"\"\"","","import os","import json","import time","import sqlite3","import logging","from datetime import datetime","from pathlib import Path","","# Configuration","SURICATA_LOG_DIR = \"/var/log/suricata\"  # Default Suricata log directory","CAPTURE_DIR = \"/home/jarvis/NetGuard/captures/suricata\"","DB_PATH = \"/home/jarvis/NetGuard/network.db\"","LOG_FILE = \"/home/jarvis/NetGuard/logs/system/suricata-collector.log\"","CHECK_INTERVAL = 15  # seconds - check every 15 seconds","POSITION_FILE = \"/home/jarvis/NetGuard/logs/system/suricata_positions.json\"","","# EVE log categories","CATEGORIES = ['alerts', 'http', 'dns', 'tls', 'files', 'flow', 'ssh', 'smtp', 'ftp', 'anomaly', 'stats']","","# Setup logging","logging.basicConfig(","    level=logging.INFO,","    format='%(asctime)s - %(levelname)s - %(message)s',","    handlers=[","        logging.FileHandler(LOG_FILE),","        logging.StreamHandler()","    ]",")","","def load_positions():","    \"\"\"Load file positions (last read byte position for each log file)\"\"\"","    if os.path.exists(POSITION_FILE):","        try:","            with open(POSITION_FILE, 'r') as f:","                return json.load(f)","        except:","            return {}","    return {}","","def save_position(log_file, position):","    \"\"\"Save the last read position for a log file\"\"\"","    positions = load_positions()","    positions[log_file] = position","    with open(POSITION_FILE, 'w') as f:","        json.dump(positions, f, indent=2)","","def create_table_if_not_exists(conn, category, table_name):","    \"\"\"Create category-specific table if it doesn't exist\"\"\"","    cursor = conn.cursor()","    ","    if category == 'alerts':","        sql = f\"\"\"","        CREATE TABLE IF NOT EXISTS {table_name} (","            id INTEGER PRIMARY KEY AUTOINCREMENT,","            timestamp TEXT NOT NULL,","            flow_id INTEGER,","            event_type TEXT,","            src_ip TEXT,","            src_port INTEGER,","            dest_ip TEXT,","            dest_port INTEGER,","            proto TEXT,","            alert_signature TEXT,","            alert_category TEXT,","            alert_severity INTEGER,","            alert_signature_id INTEGER,","            alert_gid INTEGER,","            alert_rev INTEGER,","            alert_action TEXT,","            created_at DATETIME DEFAULT CURRENT_TIMESTAMP","        );","        \"\"\"","    elif category == 'http':","        sql = f\"\"\"","        CREATE TABLE IF NOT EXISTS {table_name} (","            id INTEGER PRIMARY KEY AUTOINCREMENT,","            timestamp TEXT NOT NULL,","            flow_id INTEGER,","            src_ip TEXT,","            src_port INTEGER,","            dest_ip TEXT,","            dest_port INTEGER,","            http_hostname TEXT,","            http_url TEXT,","            http_user_agent TEXT,","            http_method TEXT,","            http_protocol TEXT,","            http_status INTEGER,","            http_content_type TEXT,","            http_length INTEGER,","            created_at DATETIME DEFAULT CURRENT_TIMESTAMP","        );","        \"\"\"","    elif category == 'dns':","        sql = f\"\"\"","        CREATE TABLE IF NOT EXISTS {table_name} (","            id INTEGER PRIMARY KEY AUTOINCREMENT,","            timestamp TEXT NOT NULL,","            flow_id INTEGER,","            src_ip TEXT,","            src_port INTEGER,","            dest_ip TEXT,","            dest_port INTEGER,","            dns_type TEXT,","            dns_id INTEGER,","            dns_rrname TEXT,","            dns_rrtype TEXT,","            dns_rcode TEXT,","            dns_rdata TEXT,","            dns_ttl INTEGER,","            created_at DATETIME DEFAULT CURRENT_TIMESTAMP","        );","        \"\"\"","    elif category == 'tls':","        sql = f\"\"\"","        CREATE TABLE IF NOT EXISTS {table_name} (","            id INTEGER PRIMARY KEY AUTOINCREMENT,","            timestamp TEXT NOT NULL,","            flow_id INTEGER,","            src_ip TEXT,","            src_port INTEGER,","            dest_ip TEXT,","            dest_port INTEGER,","            tls_subject TEXT,","            tls_issuerdn TEXT,","            tls_serial TEXT,","            tls_fingerprint TEXT,","            tls_sni TEXT,","            tls_version TEXT,","            tls_notbefore TEXT,","            tls_notafter TEXT,","            created_at DATETIME DEFAULT CURRENT_TIMESTAMP","        );","        \"\"\"","    elif category == 'files':","        sql = f\"\"\"","        CREATE TABLE IF NOT EXISTS {table_name} (","            id INTEGER PRIMARY KEY AUTOINCREMENT,","            timestamp TEXT NOT NULL,","            flow_id INTEGER,","            src_ip TEXT,","            src_port INTEGER,","            dest_ip TEXT,","            dest_port INTEGER,","            file_filename TEXT,","            file_magic TEXT,","            file_state TEXT,","            file_stored INTEGER,","            file_size INTEGER,","            file_tx_id INTEGER,","            created_at DATETIME DEFAULT CURRENT_TIMESTAMP","        );","        \"\"\"","    elif category == 'flow':","        sql = f\"\"\"","        CREATE TABLE IF NOT EXISTS {table_name} (","            id INTEGER PRIMARY KEY AUTOINCREMENT,","            timestamp TEXT NOT NULL,","            flow_id INTEGER,","            src_ip TEXT,","            src_port INTEGER,","            dest_ip TEXT,","            dest_port INTEGER,","            proto TEXT,","            flow_pkts_toserver INTEGER,","            flow_pkts_toclient INTEGER,","            flow_bytes_toserver INTEGER,","            flow_bytes_toclient INTEGER,","            flow_start TEXT,","            flow_end TEXT,","            flow_age INTEGER,","            flow_state TEXT,","            flow_reason TEXT,","            created_at DATETIME DEFAULT CURRENT_TIMESTAMP","        );","        \"\"\"","    elif category == 'ssh':","        sql = f\"\"\"","        CREATE TABLE IF NOT EXISTS {table_name} (","            id INTEGER PRIMARY KEY AUTOINCREMENT,","            timestamp TEXT NOT NULL,","            flow_id INTEGER,","            src_ip TEXT,","            src_port INTEGER,","            dest_ip TEXT,","            dest_port INTEGER,","            ssh_client_software TEXT,","            ssh_server_software TEXT,","            ssh_client_proto TEXT,","            ssh_server_proto TEXT,","            created_at DATETIME DEFAULT CURRENT_TIMESTAMP","        );","        \"\"\"","    elif category == 'smtp':","        sql = f\"\"\"","        CREATE TABLE IF NOT EXISTS {table_name} (","            id INTEGER PRIMARY KEY AUTOINCREMENT,","            timestamp TEXT NOT NULL,","            flow_id INTEGER,","            src_ip TEXT,","            src_port INTEGER,","            dest_ip TEXT,","            dest_port INTEGER,","            smtp_helo TEXT,","            smtp_mail_from TEXT,","            smtp_rcpt_to TEXT,","            created_at DATETIME DEFAULT CURRENT_TIMESTAMP","        );","        \"\"\"","    elif category == 'ftp':","        sql = f\"\"\"","        CREATE TABLE IF NOT EXISTS {table_name} (","            id INTEGER PRIMARY KEY AUTOINCREMENT,","            timestamp TEXT NOT NULL,","            flow_id INTEGER,","            src_ip TEXT,","            src_port INTEGER,","            dest_ip TEXT,","            dest_port INTEGER,","            ftp_command TEXT,","            ftp_command_data TEXT,","            ftp_reply TEXT,","            ftp_completion_code TEXT,","            created_at DATETIME DEFAULT CURRENT_TIMESTAMP","        );","        \"\"\"","    elif category == 'anomaly':","        sql = f\"\"\"","        CREATE TABLE IF NOT EXISTS {table_name} (","            id INTEGER PRIMARY KEY AUTOINCREMENT,","            timestamp TEXT NOT NULL,","            flow_id INTEGER,","            src_ip TEXT,","            src_port INTEGER,","            dest_ip TEXT,","            dest_port INTEGER,","            anomaly_type TEXT,","            anomaly_event TEXT,","            anomaly_code INTEGER,","            created_at DATETIME DEFAULT CURRENT_TIMESTAMP","        );","        \"\"\"","    elif category == 'stats':","        sql = f\"\"\"","        CREATE TABLE IF NOT EXISTS {table_name} (","            id INTEGER PRIMARY KEY AUTOINCREMENT,","            timestamp TEXT NOT NULL,","            uptime INTEGER,","            packets INTEGER,","            bytes INTEGER,","            packets_dropped INTEGER,","            invalid INTEGER,","            decoder_pkts INTEGER,","            decoder_bytes INTEGER,","            decoder_ipv4 INTEGER,","            decoder_ipv6 INTEGER,","            decoder_tcp INTEGER,","            decoder_udp INTEGER,","            created_at DATETIME DEFAULT CURRENT_TIMESTAMP","        );","        \"\"\"","    else:","        return","    ","    cursor.execute(sql)","    conn.commit()","","def extract_alert_data(event):","    \"\"\"Extract alert-specific data from event\"\"\"","    alert = event.get('alert', {})","    return {","        'alert_signature': alert.get('signature', ''),","        'alert_category': alert.get('category', ''),","        'alert_severity': alert.get('severity'),","        'alert_signature_id': alert.get('signature_id'),","        'alert_gid': alert.get('gid'),","        'alert_rev': alert.get('rev'),","        'alert_action': alert.get('action', '')","    }","","def extract_http_data(event):","    \"\"\"Extract HTTP-specific data from event\"\"\"","    http = event.get('http', {})","    return {","        'http_hostname': http.get('hostname', ''),","        'http_url': http.get('url', ''),","        'http_user_agent': http.get('http_user_agent', ''),","        'http_method': http.get('http_method', ''),","        'http_protocol': http.get('protocol', ''),","        'http_status': http.get('status'),","        'http_content_type': http.get('http_content_type', ''),","        'http_length': http.get('length')","    }","","def extract_dns_data(event):","    \"\"\"Extract DNS-specific data from event\"\"\"","    dns = event.get('dns', {})","    return {","        'dns_type': dns.get('type', ''),","        'dns_id': dns.get('id'),","        'dns_rrname': dns.get('rrname', ''),","        'dns_rrtype': dns.get('rrtype', ''),","        'dns_rcode': dns.get('rcode', ''),","        'dns_rdata': dns.get('rdata', ''),","        'dns_ttl': dns.get('ttl')","    }","","def extract_tls_data(event):","    \"\"\"Extract TLS-specific data from event\"\"\"","    tls = event.get('tls', {})","    return {","        'tls_subject': tls.get('subject', ''),","        'tls_issuerdn': tls.get('issuerdn', ''),","        'tls_serial': tls.get('serial', ''),","        'tls_fingerprint': tls.get('fingerprint', ''),","        'tls_sni': tls.get('sni', ''),","        'tls_version': tls.get('version', ''),","        'tls_notbefore': tls.get('notbefore', ''),","        'tls_notafter': tls.get('notafter', '')","    }","","def extract_files_data(event):","    \"\"\"Extract file-specific data from event\"\"\"","    fileinfo = event.get('fileinfo', {})","    return {","        'file_filename': fileinfo.get('filename', ''),","        'file_magic': fileinfo.get('magic', ''),","        'file_state': fileinfo.get('state', ''),","        'file_stored': fileinfo.get('stored'),","        'file_size': fileinfo.get('size'),","        'file_tx_id': fileinfo.get('tx_id')","    }","","def extract_flow_data(event):","    \"\"\"Extract flow-specific data from event\"\"\"","    flow = event.get('flow', {})","    return {","        'flow_pkts_toserver': flow.get('pkts_toserver'),","        'flow_pkts_toclient': flow.get('pkts_toclient'),","        'flow_bytes_toserver': flow.get('bytes_toserver'),","        'flow_bytes_toclient': flow.get('bytes_toclient'),","        'flow_start': flow.get('start', ''),","        'flow_end': flow.get('end', ''),","        'flow_age': flow.get('age'),","        'flow_state': flow.get('state', ''),","        'flow_reason': flow.get('reason', '')","    }","","def extract_ssh_data(event):","    \"\"\"Extract SSH-specific data from event\"\"\"","    ssh = event.get('ssh', {})","    client = ssh.get('client', {})","    server = ssh.get('server', {})","    return {","        'ssh_client_software': client.get('software_version', ''),","        'ssh_server_software': server.get('software_version', ''),","        'ssh_client_proto': client.get('proto_version', ''),","        'ssh_server_proto': server.get('proto_version', '')","    }","","def extract_smtp_data(event):","    \"\"\"Extract SMTP-specific data from event\"\"\"","    smtp = event.get('smtp', {})","    return {","        'smtp_helo': smtp.get('helo', ''),","        'smtp_mail_from': smtp.get('mail_from', ''),","        'smtp_rcpt_to': ','.join(smtp.get('rcpt_to', []))","    }","","def extract_ftp_data(event):","    \"\"\"Extract FTP-specific data from event\"\"\"","    ftp = event.get('ftp', {})","    return {","        'ftp_command': ftp.get('command', ''),","        'ftp_command_data': ftp.get('command_data', ''),","        'ftp_reply': ','.join(ftp.get('reply', [])),","        'ftp_completion_code': ','.join(ftp.get('completion_code', []))","    }","","def extract_anomaly_data(event):","    \"\"\"Extract anomaly-specific data from event\"\"\"","    anomaly = event.get('anomaly', {})","    return {","        'anomaly_type': anomaly.get('type', ''),","        'anomaly_event': anomaly.get('event', ''),","        'anomaly_code': anomaly.get('code')","    }","","def extract_stats_data(event):","    \"\"\"Extract stats-specific data from event\"\"\"","    stats = event.get('stats', {})","    decoder = stats.get('decoder', {})","    return {","        'uptime': stats.get('uptime'),","        'packets': stats.get('capture', {}).get('kernel_packets'),","        'bytes': decoder.get('bytes'),","        'packets_dropped': stats.get('capture', {}).get('kernel_drops'),","        'invalid': decoder.get('invalid'),","        'decoder_pkts': decoder.get('pkts'),","        'decoder_bytes': decoder.get('bytes'),","        'decoder_ipv4': decoder.get('ipv4'),","        'decoder_ipv6': decoder.get('ipv6'),","        'decoder_tcp': decoder.get('tcp'),","        'decoder_udp': decoder.get('udp')","    }","","def insert_event(conn, category, table_name, event):","    \"\"\"Insert event into appropriate category table\"\"\"","    try:","        cursor = conn.cursor()","        ","        # Common fields","        timestamp = event.get('timestamp', '')","        flow_id = event.get('flow_id')","        src_ip = event.get('src_ip', '')","        src_port = event.get('src_port')","        dest_ip = event.get('dest_ip', '')","        dest_port = event.get('dest_port')","        proto = event.get('proto', '')","        event_type = event.get('event_type', '')","        ","        # Extract category-specific data","        if category == 'alerts':","            data = extract_alert_data(event)","            sql = f\"\"\"","                INSERT INTO {table_name} ","                (timestamp, flow_id, event_type, src_ip, src_port, dest_ip, dest_port, proto,","                 alert_signature, alert_category, alert_severity, alert_signature_id, ","                 alert_gid, alert_rev, alert_action)","                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","            \"\"\"","            values = (timestamp, flow_id, event_type, src_ip, src_port, dest_ip, dest_port, proto,","                     data['alert_signature'], data['alert_category'], data['alert_severity'],","                     data['alert_signature_id'], data['alert_gid'], data['alert_rev'], data['alert_action'])","                     ","        elif category == 'http':","            data = extract_http_data(event)","            sql = f\"\"\"","                INSERT INTO {table_name}","                (timestamp, flow_id, src_ip, src_port, dest_ip, dest_port,","                 http_hostname, http_url, http_user_agent, http_method, http_protocol,","                 http_status, http_content_type, http_length)","                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","            \"\"\"","            values = (timestamp, flow_id, src_ip, src_port, dest_ip, dest_port,","                     data['http_hostname'], data['http_url'], data['http_user_agent'],","                     data['http_method'], data['http_protocol'], data['http_status'],","                     data['http_content_type'], data['http_length'])","                     ","        elif category == 'dns':","            data = extract_dns_data(event)","            sql = f\"\"\"","                INSERT INTO {table_name}","                (timestamp, flow_id, src_ip, src_port, dest_ip, dest_port,","                 dns_type, dns_id, dns_rrname, dns_rrtype, dns_rcode, dns_rdata, dns_ttl)","                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","            \"\"\"","            values = (timestamp, flow_id, src_ip, src_port, dest_ip, dest_port,","                     data['dns_type'], data['dns_id'], data['dns_rrname'], data['dns_rrtype'],","                     data['dns_rcode'], data['dns_rdata'], data['dns_ttl'])","                     ","        elif category == 'tls':","            data = extract_tls_data(event)","            sql = f\"\"\"","                INSERT INTO {table_name}","                (timestamp, flow_id, src_ip, src_port, dest_ip, dest_port,","                 tls_subject, tls_issuerdn, tls_serial, tls_fingerprint, tls_sni,","                 tls_version, tls_notbefore, tls_notafter)","                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","            \"\"\"","            values = (timestamp, flow_id, src_ip, src_port, dest_ip, dest_port,","                     data['tls_subject'], data['tls_issuerdn'], data['tls_serial'],","                     data['tls_fingerprint'], data['tls_sni'], data['tls_version'],","                     data['tls_notbefore'], data['tls_notafter'])","                     ","        elif category == 'files':","            data = extract_files_data(event)","            sql = f\"\"\"","                INSERT INTO {table_name}","                (timestamp, flow_id, src_ip, src_port, dest_ip, dest_port,","                 file_filename, file_magic, file_state, file_stored, file_size, file_tx_id)","                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","            \"\"\"","            values = (timestamp, flow_id, src_ip, src_port, dest_ip, dest_port,","                     data['file_filename'], data['file_magic'], data['file_state'],","                     data['file_stored'], data['file_size'], data['file_tx_id'])","                     ","        elif category == 'flow':","            data = extract_flow_data(event)","            sql = f\"\"\"","                INSERT INTO {table_name}","                (timestamp, flow_id, src_ip, src_port, dest_ip, dest_port, proto,","                 flow_pkts_toserver, flow_pkts_toclient, flow_bytes_toserver, flow_bytes_toclient,","                 flow_start, flow_end, flow_age, flow_state, flow_reason)","                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","            \"\"\"","            values = (timestamp, flow_id, src_ip, src_port, dest_ip, dest_port, proto,","                     data['flow_pkts_toserver'], data['flow_pkts_toclient'],","                     data['flow_bytes_toserver'], data['flow_bytes_toclient'],","                     data['flow_start'], data['flow_end'], data['flow_age'],","                     data['flow_state'], data['flow_reason'])","                     ","        elif category == 'ssh':","            data = extract_ssh_data(event)","            sql = f\"\"\"","                INSERT INTO {table_name}","                (timestamp, flow_id, src_ip, src_port, dest_ip, dest_port,","                 ssh_client_software, ssh_server_software, ssh_client_proto, ssh_server_proto)","                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","            \"\"\"","            values = (timestamp, flow_id, src_ip, src_port, dest_ip, dest_port,","                     data['ssh_client_software'], data['ssh_server_software'],","                     data['ssh_client_proto'], data['ssh_server_proto'])","                     ","        elif category == 'smtp':","            data = extract_smtp_data(event)","            sql = f\"\"\"","                INSERT INTO {table_name}","                (timestamp, flow_id, src_ip, src_port, dest_ip, dest_port,","                 smtp_helo, smtp_mail_from, smtp_rcpt_to)","                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)","            \"\"\"","            values = (timestamp, flow_id, src_ip, src_port, dest_ip, dest_port,","                     data['smtp_helo'], data['smtp_mail_from'], data['smtp_rcpt_to'])","                     ","        elif category == 'ftp':","            data = extract_ftp_data(event)","            sql = f\"\"\"","                INSERT INTO {table_name}","                (timestamp, flow_id, src_ip, src_port, dest_ip, dest_port,","                 ftp_command, ftp_command_data, ftp_reply, ftp_completion_code)","                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","            \"\"\"","            values = (timestamp, flow_id, src_ip, src_port, dest_ip, dest_port,","                     data['ftp_command'], data['ftp_command_data'],","                     data['ftp_reply'], data['ftp_completion_code'])","                     ","        elif category == 'anomaly':","            data = extract_anomaly_data(event)","            sql = f\"\"\"","                INSERT INTO {table_name}","                (timestamp, flow_id, src_ip, src_port, dest_ip, dest_port,","                 anomaly_type, anomaly_event, anomaly_code)","                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)","            \"\"\"","            values = (timestamp, flow_id, src_ip, src_port, dest_ip, dest_port,","                     data['anomaly_type'], data['anomaly_event'], data['anomaly_code'])","                     ","        elif category == 'stats':","            data = extract_stats_data(event)","            sql = f\"\"\"","                INSERT INTO {table_name}","                (timestamp, uptime, packets, bytes, packets_dropped, invalid,","                 decoder_pkts, decoder_bytes, decoder_ipv4, decoder_ipv6,","                 decoder_tcp, decoder_udp)","                VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)","            \"\"\"","            values = (timestamp, data['uptime'], data['packets'], data['bytes'],","                     data['packets_dropped'], data['invalid'], data['decoder_pkts'],","                     data['decoder_bytes'], data['decoder_ipv4'], data['decoder_ipv6'],","                     data['decoder_tcp'], data['decoder_udp'])","        else:","            return False","        ","        cursor.execute(sql, values)","        return True","        ","    except Exception as e:","        logging.debug(f\"Error inserting {category} event: {e}\")","        return False","","def process_eve_log(category, log_file):","    \"\"\"Process Suricata EVE log file for a specific category\"\"\"","    try:","        if not os.path.exists(log_file):","            return 0","        ","        # Get current position","        positions = load_positions()","        last_position = positions.get(log_file, 0)","        ","        # Open file and seek to last position","        with open(log_file, 'r') as f:","            f.seek(last_position)","            new_lines = f.readlines()","            new_position = f.tell()","        ","        if not new_lines:","            return 0","        ","        # Generate table name with timestamp","        timestamp_str = datetime.now().strftime('%Y%m%d_%H%M%S')","        table_name = f\"suricata_{category}_{timestamp_str}\"","        ","        # Connect to database","        conn = sqlite3.connect(DB_PATH)","        ","        # Create table","        create_table_if_not_exists(conn, category, table_name)","        ","        # Process events","        inserted_count = 0","        for line in new_lines:","            line = line.strip()","            if not line:","                continue","            ","            try:","                event = json.loads(line)","                ","                # Filter by event type for relevant category","                event_type = event.get('event_type', '')","                ","                # Insert if matches category","                if category == 'alerts' and event_type == 'alert':","                    if insert_event(conn, category, table_name, event):","                        inserted_count += 1","                elif category == 'http' and event_type == 'http':","                    if insert_event(conn, category, table_name, event):","                        inserted_count += 1","                elif category == 'dns' and event_type == 'dns':","                    if insert_event(conn, category, table_name, event):","                        inserted_count += 1","                elif category == 'tls' and event_type == 'tls':","                    if insert_event(conn, category, table_name, event):","                        inserted_count += 1","                elif category == 'files' and event_type == 'fileinfo':","                    if insert_event(conn, category, table_name, event):","                        inserted_count += 1","                elif category == 'flow' and event_type == 'flow':","                    if insert_event(conn, category, table_name, event):","                        inserted_count += 1","                elif category == 'ssh' and event_type == 'ssh':","                    if insert_event(conn, category, table_name, event):","                        inserted_count += 1","                elif category == 'smtp' and event_type == 'smtp':","                    if insert_event(conn, category, table_name, event):","                        inserted_count += 1","                elif category == 'ftp' and event_type == 'ftp':","                    if insert_event(conn, category, table_name, event):","                        inserted_count += 1","                elif category == 'anomaly' and event_type == 'anomaly':","                    if insert_event(conn, category, table_name, event):","                        inserted_count += 1","                elif category == 'stats' and event_type == 'stats':","                    if insert_event(conn, category, table_name, event):","                        inserted_count += 1","                        ","            except json.JSONDecodeError:","                continue","        ","        conn.commit()","        conn.close()","        ","        # Save new position","        save_position(log_file, new_position)","        ","        if inserted_count > 0:","            logging.info(f\"✓ {category}: Inserted {inserted_count} events into '{table_name}'\")","        ","        return inserted_count","        ","    except Exception as e:","        logging.error(f\"✗ Error processing {category} log: {e}\")","        return 0","","def collect_suricata_data():","    \"\"\"Main collection loop for Suricata EVE logs\"\"\"","    logging.info(\"=\" * 60)","    logging.info(\"NetGuard Pro - Suricata EVE Log Collector\")","    logging.info(\"=\" * 60)","    logging.info(f\"Suricata logs: {SURICATA_LOG_DIR}\")","    logging.info(f\"Database: {DB_PATH}\")","    logging.info(f\"Check interval: {CHECK_INTERVAL} seconds\")","    logging.info(f\"Categories: {', '.join(CATEGORIES)}\")","    logging.info(\"=\" * 60)","    ","    # Create directories","    os.makedirs(CAPTURE_DIR, exist_ok=True)","    os.makedirs(os.path.dirname(LOG_FILE), exist_ok=True)","    ","    # Main EVE log file (we'll read from this)","    eve_log = os.path.join(SURICATA_LOG_DIR, \"eve.json\")","    ","    while True:","        try:","            total_inserted = 0","            ","            # Process each category from main EVE log","            for category in CATEGORIES:","                count = process_eve_log(category, eve_log)","                total_inserted += count","            ","            if total_inserted > 0:","                logging.info(f\"Total events processed: {total_inserted}\")","            ","            # Sleep before next check","            time.sleep(CHECK_INTERVAL)","            ","        except KeyboardInterrupt:","            logging.info(\"Shutting down Suricata collector...\")","            break","        except Exception as e:","            logging.error(f\"Error in collection loop: {e}\")","            time.sleep(CHECK_INTERVAL)","","if __name__ == \"__main__\":","    collect_suricata_data()","",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000003,1000004,1000001,1000005,1000006,1000007,1000008,1000009,1000010,1000011,1000012,1000005,1000013,1000014,1000015,1000016,1000017,1000018,1000019,1000005,1000020,1000021,1000005,1000022,1000023,1000024,1000025,1000026,1000027,1000028,1000029,1000030,1000005,1000031,1000032,1000033,1000034,1000035,1000036,1000037,1000038,1000039,1000005,1000040,1000041,1000042,1000043,1000044,1000045,1000005,1000046,1000047,1000048,1000049,1000050,1000051,1000052,1000053,1000054,1000055,1000056,1000057,1000058,1000059,1000060,1000061,1000062,1000063,1000064,1000065,1000066,1000067,1000068,1000069,1000070,1000071,1000072,1000051,1000052,1000053,1000054,1000055,1000057,1000058,1000059,1000060,1000073,1000074,1000075,1000076,1000077,1000078,1000079,1000080,1000069,1000070,1000071,1000081,1000051,1000052,1000053,1000054,1000055,1000057,1000058,1000059,1000060,1000082,1000083,1000084,1000085,1000086,1000087,1000088,1000069,1000070,1000071,1000089,1000051,1000052,1000053,1000054,1000055,1000057,1000058,1000059,1000060,1000090,1000091,1000092,1000093,1000094,1000095,1000096,1000097,1000069,1000070,1000071,1000098,1000051,1000052,1000053,1000054,1000055,1000057,1000058,1000059,1000060,1000099,1000100,1000101,1000102,1000103,1000104,1000069,1000070,1000071,1000105,1000051,1000052,1000053,1000054,1000055,1000057,1000058,1000059,1000060,1000061,1000106,1000107,1000108,1000109,1000110,1000111,1000112,1000113,1000114,1000069,1000070,1000071,1000115,1000051,1000052,1000053,1000054,1000055,1000057,1000058,1000059,1000060,1000116,1000117,1000118,1000119,1000069,1000070,1000071,1000120,1000051,1000052,1000053,1000054,1000055,1000057,1000058,1000059,1000060,1000121,1000122,1000123,1000069,1000070,1000071,1000124,1000051,1000052,1000053,1000054,1000055,1000057,1000058,1000059,1000060,1000125,1000126,1000127,1000128,1000069,1000070,1000071,1000129,1000051,1000052,1000053,1000054,1000055,1000057,1000058,1000059,1000060,1000130,1000131,1000132,1000069,1000070,1000071,1000133,1000051,1000052,1000053,1000054,1000134,1000135,1000136,1000137,1000138,1000139,1000140,1000141,1000142,1000143,1000144,1000069,1000070,1000071,1000145,1000146,1000049,1000147,1000148,1000005,1000149,1000150,1000151,1000152,1000153,1000154,1000155,1000156,1000157,1000158,1000159,1000160,1000005,1000161,1000162,1000163,1000152,1000164,1000165,1000166,1000167,1000168,1000169,1000170,1000171,1000160,1000005,1000172,1000173,1000174,1000152,1000175,1000176,1000177,1000178,1000179,1000180,1000181,1000160,1000005,1000182,1000183,1000184,1000152,1000185,1000186,1000187,1000188,1000189,1000190,1000191,1000192,1000160,1000005,1000193,1000194,1000195,1000152,1000196,1000197,1000198,1000199,1000200,1000201,1000160,1000005,1000202,1000203,1000204,1000152,1000205,1000206,1000207,1000208,1000209,1000210,1000211,1000212,1000213,1000160,1000005,1000214,1000215,1000216,1000217,1000218,1000152,1000219,1000220,1000221,1000222,1000160,1000005,1000223,1000224,1000225,1000152,1000226,1000227,1000228,1000160,1000005,1000229,1000230,1000231,1000152,1000232,1000233,1000234,1000235,1000160,1000005,1000236,1000237,1000238,1000152,1000239,1000240,1000241,1000160,1000005,1000242,1000243,1000244,1000245,1000152,1000246,1000247,1000248,1000249,1000250,1000251,1000252,1000253,1000254,1000255,1000256,1000160,1000005,1000257,1000258,1000259,1000260,1000261,1000262,1000263,1000264,1000265,1000266,1000267,1000268,1000269,1000270,1000261,1000271,1000272,1000273,1000274,1000275,1000276,1000277,1000278,1000279,1000280,1000281,1000282,1000283,1000284,1000285,1000286,1000274,1000287,1000288,1000289,1000290,1000291,1000280,1000292,1000293,1000294,1000295,1000284,1000296,1000297,1000274,1000287,1000288,1000298,1000299,1000280,1000292,1000300,1000301,1000284,1000302,1000303,1000274,1000287,1000288,1000304,1000305,1000291,1000280,1000292,1000306,1000307,1000308,1000284,1000309,1000310,1000274,1000287,1000288,1000311,1000312,1000280,1000292,1000313,1000314,1000284,1000315,1000316,1000274,1000287,1000317,1000318,1000319,1000320,1000280,1000321,1000322,1000323,1000324,1000325,1000284,1000326,1000327,1000274,1000287,1000288,1000328,1000329,1000280,1000292,1000330,1000331,1000284,1000332,1000333,1000274,1000287,1000288,1000334,1000335,1000280,1000292,1000336,1000284,1000337,1000338,1000274,1000287,1000288,1000339,1000329,1000280,1000292,1000340,1000341,1000284,1000342,1000343,1000274,1000287,1000288,1000344,1000335,1000280,1000292,1000345,1000284,1000346,1000347,1000274,1000287,1000348,1000349,1000350,1000312,1000280,1000351,1000352,1000353,1000354,1000355,1000356,1000261,1000357,1000358,1000261,1000359,1000360,1000361,1000005,1000362,1000363,1000259,1000364,1000365,1000261,1000366,1000367,1000368,1000261,1000369,1000370,1000371,1000372,1000373,1000261,1000374,1000365,1000261,1000375,1000376,1000377,1000261,1000378,1000379,1000261,1000380,1000381,1000261,1000382,1000383,1000384,1000385,1000386,1000387,1000388,1000389,1000390,1000391,1000392,1000393,1000391,1000394,1000395,1000396,1000397,1000398,1000396,1000397,1000399,1000396,1000397,1000400,1000396,1000397,1000401,1000396,1000397,1000402,1000396,1000397,1000403,1000396,1000397,1000404,1000396,1000397,1000405,1000396,1000397,1000406,1000396,1000397,1000407,1000396,1000397,1000408,1000409,1000387,1000261,1000410,1000411,1000261,1000412,1000413,1000261,1000414,1000415,1000261,1000416,1000261,1000359,1000417,1000418,1000005,1000419,1000420,1000421,1000422,1000421,1000423,1000424,1000425,1000426,1000421,1000049,1000427,1000428,1000429,1000049,1000430,1000431,1000049,1000432,1000034,1000433,1000388,1000434,1000435,1000436,1000437,1000388,1000438,1000439,1000388,1000440,1000441,1000388,1000442,1000443,1000444,1000445,1000446,1000441,1000005,1000447,1000448,1000005,1000005]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}