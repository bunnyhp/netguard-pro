{"fsPath":"\\home\\jarvis\\NetGuard\\web\\app.py","fileUuid":"f9b0f846-aae3-42bf-8691-21167669512a","fileSizeBytes":63558,"numLines":1660,"diffChanges":[{"originalStartLineNumberOneIndexed":1440,"originalEndLineNumberExclusiveOneIndexed":1440,"modifiedStartLineNumberOneIndexed":1440,"modifiedEndLineNumberExclusiveOneIndexed":1655,"addedLines":["","@app.route('/system-status')","def system_status():","    \"\"\"System status page showing all services and collectors\"\"\"","    import subprocess","    import os","    ","    conn = get_db_connection()","    cursor = conn.cursor()","    ","    # Get all tables","    cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table'\")","    all_tables = [row['name'] for row in cursor.fetchall()]","    ","    # Network Collectors","    collectors = [","        {","            'name': 'Suricata IDS/IPS',","            'description': 'Intrusion Detection System - Real-time threat detection',","            'icon': 'ðŸ›¡ï¸',","            'service': 'suricata',","            'tables': [t for t in all_tables if t.startswith('suricata_')]","        },","        {","            'name': 'tcpdump',","            'description': 'Professional packet capture with zero packet loss',","            'icon': 'ðŸ“¦',","            'service': 'tcpdump',","            'tables': [t for t in all_tables if t.startswith('tcpdump_')]","        },","        {","            'name': 'tshark',","            'description': 'Protocol analysis and application layer parsing',","            'icon': 'ðŸ“Š',","            'service': 'tshark',","            'tables': [t for t in all_tables if t.startswith('tshark_')]","        },","        {","            'name': 'p0f',","            'description': 'Passive OS fingerprinting and link detection',","            'icon': 'ðŸ”',","            'service': 'p0f',","            'tables': [t for t in all_tables if t.startswith('p0f_')]","        },","        {","            'name': 'ngrep',","            'description': 'Network pattern matching and content inspection',","            'icon': 'ðŸ”Ž',","            'service': 'ngrep',","            'tables': [t for t in all_tables if t.startswith('ngrep_')]","        },","        {","            'name': 'httpry',","            'description': 'HTTP traffic capture and analysis',","            'icon': 'ðŸŒ',","            'service': 'httpry',","            'tables': [t for t in all_tables if t.startswith('httpry_')]","        },","        {","            'name': 'argus',","            'description': 'Network flow monitoring and analysis',","            'icon': 'ðŸŒŠ',","            'service': 'argus',","            'tables': [t for t in all_tables if t.startswith('argus_')]","        },","        {","            'name': 'netsniff-ng',","            'description': 'High-performance packet capture',","            'icon': 'âš¡',","            'service': 'netsniff-ng',","            'tables': [t for t in all_tables if t.startswith('netsniff_')]","        },","        {","            'name': 'iftop',","            'description': 'Real-time bandwidth monitoring per connection',","            'icon': 'ðŸ“ˆ',","            'service': 'iftop',","            'tables': [t for t in all_tables if t.startswith('iftop_')]","        },","        {","            'name': 'nethogs',","            'description': 'Process-level bandwidth monitoring',","            'icon': 'ðŸ—',","            'service': 'nethogs',","            'tables': [t for t in all_tables if t.startswith('nethogs_')]","        }","    ]","    ","    # Analysis & Processing Scripts","    scripts = [","        {","            'name': 'AI 5-Min Aggregator',","            'description': 'Collects data from all tools and sends to Gemini AI for analysis',","            'icon': 'ðŸ¤–',","            'script': 'ai_5min_aggregator.py'","        },","        {","            'name': 'Device Tracker',","            'description': 'MAC address tracking, vendor lookup, and device categorization',","            'icon': 'ðŸ“±',","            'script': 'device_tracker.py'","        },","        {","            'name': 'Unified Device Processor',","            'description': 'Processes traffic data to identify unique devices',","            'icon': 'ðŸ”„',","            'script': 'unified_device_processor.py'","        },","        {","            'name': 'IoT Security Scanner',","            'description': 'Scans IoT devices for vulnerabilities and security issues',","            'icon': 'ðŸ”',","            'script': 'iot_security_scanner.py'","        },","        {","            'name': 'Device Scorer',","            'description': 'Calculates security scores (0-100) for all devices',","            'icon': 'ðŸŽ¯',","            'script': 'device_scorer.py'","        },","        {","            'name': 'Enhanced Alert System',","            'description': 'Advanced threat alerting with auto-remediation',","            'icon': 'ðŸš¨',","            'script': 'enhanced_alert_system.py'","        }","    ]","    ","    # Web Services","    web_services = [","        {","            'name': 'Flask Dashboard',","            'description': 'Main web interface for NetGuard Pro',","            'icon': 'ðŸŒ',","            'service': 'flask-dashboard',","            'port': 8080","        }","    ]","    ","    # Check service status","    for service in collectors + scripts + web_services:","        try:","            # Check if it's a systemd service","            if 'service' in service:","                result = subprocess.run(","                    ['systemctl', 'is-active', service['service']],","                    capture_output=True,","                    text=True,","                    timeout=2","                )","                service['status'] = 'running' if result.returncode == 0 else 'stopped'","            # Check if it's a script (look for running process)","            elif 'script' in service:","                result = subprocess.run(","                    ['pgrep', '-f', service['script']],","                    capture_output=True,","                    text=True,","                    timeout=2","                )","                service['status'] = 'running' if result.returncode == 0 else 'stopped'","            ","            # Also check if tables exist","            if 'tables' in service:","                service['table_count'] = len([t for t in service['tables'] if not t.endswith('_template')])","                if service['table_count'] > 0:","                    service['status'] = 'running'","        except:","            service['status'] = 'unknown'","    ","    # Database statistics","    database_stats = {","        'collector_tables': {},","        'data_tables': {}","    }","    ","    # Count collector tables","    for prefix in ['tcpdump', 'tshark', 'p0f', 'suricata', 'ngrep', 'httpry', 'argus', 'netsniff', 'iftop', 'nethogs']:","        tables = [t for t in all_tables if t.startswith(f'{prefix}_') and not t.endswith('_template')]","        if tables:","            database_stats['collector_tables'][prefix] = len(tables)","    ","    # Count data table records","    for table in ['devices', 'iot_vulnerabilities', 'security_alerts', 'ai_analysis']:","        if table in all_tables:","            try:","                cursor.execute(f\"SELECT COUNT(*) as count FROM {table}\")","                count = cursor.fetchone()['count']","                database_stats['data_tables'][table] = count","            except:","                database_stats['data_tables'][table] = 0","    ","    conn.close()","    ","    # Calculate summary","    all_services = collectors + scripts + web_services","    running = sum(1 for s in all_services if s.get('status') == 'running')","    stopped = sum(1 for s in all_services if s.get('status') == 'stopped')","    total = len(all_services)","    health = int((running / total * 100)) if total > 0 else 0","    ","    status = {","        'collectors': collectors,","        'scripts': scripts,","        'web_services': web_services,","        'database': database_stats,","        'summary': {","            'running': running,","            'stopped': stopped,","            'total': total,","            'health': health","        }","    }","    ","    return render_template('system_status.html', status=status)",""],"tokenizedAddedLines":[5,1000933,1000934,1000935,806,1000936,342,22,23,342,1000937,1000938,1000939,342,1000940,1000941,473,1000942,1000943,1000944,1000945,1000946,479,473,510,1000947,1000948,1000949,1000950,479,473,474,1000951,1000952,1000953,1000954,479,473,480,1000955,1000956,1000957,1000958,479,473,488,1000959,1000960,1000961,1000962,479,473,497,1000963,1000964,1000965,1000966,479,473,484,1000967,1000968,1000969,1000970,479,473,1000971,1000972,1000973,1000974,1000975,479,473,502,1000976,1000977,1000978,1000979,479,473,506,1000980,1000981,1000982,1000983,72,514,342,1000984,1000985,473,1000986,1000987,1000988,1000989,479,473,1000990,1000991,1000992,1000993,479,473,1000994,1000995,1000996,1000997,479,473,1000998,1000999,1001000,1001001,479,473,1001002,1001003,1001004,1001005,479,473,1001006,1001007,1001008,1001009,72,514,342,1001010,1001011,473,1001012,1001013,1000964,1001014,1001015,72,514,342,1001016,1001017,184,1001018,1001019,1001020,1001021,1001022,1001023,1001024,1001025,1001026,1001027,1001028,1001020,1001029,1001022,1001023,1001024,1001025,1001026,187,1001030,1001031,1001032,1001033,1001034,375,1001035,342,1001036,1001037,1001038,1001039,562,342,1001040,1001041,1001042,400,1001043,342,1001044,1001045,1001046,74,1001047,1001048,1001049,410,1001050,342,26,342,1001051,1001052,1001053,1001054,1001055,1001056,342,1001057,1001058,1001059,1001060,1001061,1001062,1001063,1001064,1001065,1001066,72,562,342,1001067,5]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}