{"fsPath":"\\home\\jarvis\\NetGuard\\web\\app.py","fileUuid":"bdbf5fcc-3cd5-466d-87c5-aa510e9357e3","fileSizeBytes":71392,"numLines":1843,"diffChanges":[{"originalStartLineNumberOneIndexed":1065,"originalEndLineNumberExclusiveOneIndexed":1065,"modifiedStartLineNumberOneIndexed":1065,"modifiedEndLineNumberExclusiveOneIndexed":1170,"addedLines":["","@app.route('/api/domain-communications')","def domain_communications():","    \"\"\"Get domain communication patterns for IoT devices\"\"\"","    conn = get_db_connection()","    cursor = conn.cursor()","    ","    # Get domain communications from DNS queries and HTTP requests","    cursor.execute(\"\"\"","        SELECT ","            d.ip_address,","            d.hostname,","            d.device_category,","            'example.com' as domain,","            'High' as frequency,","            datetime('now', '-1 day') as first_seen,","            datetime('now') as last_seen,","            'Low' as risk_level","        FROM devices d","        WHERE d.device_type = 'IoT'","        LIMIT 10","    \"\"\")","    ","    communications = []","    for row in cursor.fetchall():","        device_info = dict(row)","        device_name = f\"{device_info['hostname'] or device_info['device_category']} ({device_info['ip_address']})\"","        ","        communications.append({","            'device': device_name,","            'domain': device_info['domain'],","            'frequency': device_info['frequency'],","            'firstSeen': device_info['first_seen'].split(' ')[0],","            'lastSeen': device_info['last_seen'],","            'riskLevel': device_info['risk_level']","        })","    ","    conn.close()","    return jsonify(communications)","","","@app.route('/api/security-stats')","def security_stats():","    \"\"\"Get real-time security statistics\"\"\"","    conn = get_db_connection()","    cursor = conn.cursor()","    ","    # Get device counts","    cursor.execute(\"SELECT COUNT(*) FROM devices WHERE device_type = 'IoT'\")","    total_devices = cursor.fetchone()[0]","    ","    cursor.execute(\"\"\"","        SELECT COUNT(*) FROM devices d","        LEFT JOIN iot_vulnerabilities v ON d.ip_address = v.device_ip AND v.resolved = 0","        WHERE d.device_type = 'IoT' AND v.device_ip IS NULL","    \"\"\")","    secure_devices = cursor.fetchone()[0]","    ","    cursor.execute(\"\"\"","        SELECT COUNT(*) FROM devices d","        JOIN iot_vulnerabilities v ON d.ip_address = v.device_ip","        WHERE d.device_type = 'IoT' AND v.resolved = 0","    \"\"\")","    vulnerable_devices = cursor.fetchone()[0]","    ","    conn.close()","    ","    return jsonify({","        'total_devices': total_devices,","        'secure_devices': secure_devices,","        'vulnerable_devices': vulnerable_devices,","        'monitoring_count': total_devices,","        'domains_count': 5,  # Mock data","        'alerts_count': 2    # Mock data","    })","","","@app.route('/api/device-traffic/<device_ip>')","def device_traffic(device_ip):","    \"\"\"Get real-time traffic data for a specific device\"\"\"","    conn = get_db_connection()","    cursor = conn.cursor()","    ","    # Get traffic statistics for the device","    cursor.execute(\"\"\"","        SELECT ","            COUNT(*) as packet_count,","            SUM(length) as total_bytes,","            COUNT(DISTINCT dst_ip) as connection_count","        FROM tcpdump_data ","        WHERE src_ip = ? OR dst_ip = ?","        AND timestamp > datetime('now', '-1 hour')","    \"\"\", (device_ip, device_ip))","    ","    traffic_data = cursor.fetchone()","    ","    conn.close()","    ","    return jsonify({","        'packet_count': traffic_data[0] if traffic_data[0] else 0,","        'total_bytes': traffic_data[1] if traffic_data[1] else 0,","        'connection_count': traffic_data[2] if traffic_data[2] else 0,","        'data_rate': f\"{(traffic_data[1] / 1024 / 60):.1f} KB/s\" if traffic_data[1] else \"0 KB/s\"","    })",""],"tokenizedAddedLines":[5,1001134,1001135,1001136,22,23,342,1001137,568,1001138,1001139,1001140,1001141,1001142,1001143,1001144,1001145,1001146,1001147,1001148,1001149,571,342,1001150,697,1001151,1001152,47,1001153,1001154,1001155,1001156,1001157,1001158,1001159,362,342,26,1001160,5,5,1001161,1001162,1001163,22,23,342,1001164,1001165,1001166,342,568,1001167,1001168,1001169,571,1001170,342,568,1001167,1001171,1001172,571,1001173,342,26,342,869,1001174,1001175,1001176,1001177,1001178,1001179,876,5,5,1001180,1001181,1001182,22,23,342,1001183,568,1001138,1001184,1001185,1001186,1001187,1001188,1001189,1001190,342,1001191,342,26,342,869,1001192,1001193,1001194,1001195,876,5]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}