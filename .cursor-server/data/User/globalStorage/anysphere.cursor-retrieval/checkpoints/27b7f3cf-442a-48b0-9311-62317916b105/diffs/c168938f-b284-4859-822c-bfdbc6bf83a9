{"fsPath":"\\home\\jarvis\\NetGuard\\web\\app.py","fileUuid":"c168938f-b284-4859-822c-bfdbc6bf83a9","fileSizeBytes":54073,"numLines":1399,"diffChanges":[{"originalStartLineNumberOneIndexed":361,"originalEndLineNumberExclusiveOneIndexed":361,"modifiedStartLineNumberOneIndexed":361,"modifiedEndLineNumberExclusiveOneIndexed":458,"addedLines":["        # === BANDWIDTH OVER TIME ===","        bandwidth_timeline = []","        try:","            tcpdump_tables = [t for t in all_tables if t.startswith('tcpdump_') and not t.endswith('_template')]","            if len(tcpdump_tables) > 0:","                # Get last 10 tables for timeline","                recent_tables = sorted(tcpdump_tables)[-10:]","                for table in recent_tables:","                    # Extract timestamp from table name (tcpdump_YYYYMMDDHHMMSS)","                    try:","                        timestamp_str = table.replace('tcpdump_', '')","                        cursor.execute(f\"SELECT COUNT(*) as count, SUM(frame_length) as bytes FROM {table}\")","                        result = cursor.fetchone()","                        bandwidth_timeline.append({","                            'timestamp': timestamp_str,","                            'packets': result['count'] if result['count'] else 0,","                            'bytes': result['bytes'] if result['bytes'] else 0","                        })","                    except:","                        pass","        except Exception as e:","            print(f\"Bandwidth timeline error: {e}\")","        ","        # === PORT ACTIVITY ===","        top_ports = []","        try:","            tcpdump_tables = [t for t in all_tables if t.startswith('tcpdump_') and not t.endswith('_template')]","            if tcpdump_tables:","                latest_tcpdump = sorted(tcpdump_tables)[-1]","                cursor.execute(f\"\"\"","                    SELECT dest_port, COUNT(*) as count","                    FROM {latest_tcpdump}","                    WHERE dest_port IS NOT NULL AND dest_port != ''","                    GROUP BY dest_port","                    ORDER BY count DESC","                    LIMIT 10","                \"\"\")","                top_ports = [{'port': row['dest_port'], 'count': row['count']} for row in cursor.fetchall()]","        except Exception as e:","            print(f\"Port activity error: {e}\")","        ","        # === THREAT TIMELINE (from Suricata) ===","        threat_timeline = []","        try:","            # Get Suricata alerts tables","            alert_tables = [t for t in all_tables if 'suricata' in t and 'alert' in t and not t.endswith('_template')]","            if alert_tables:","                latest_alerts = sorted(alert_tables)[-1]","                cursor.execute(f\"\"\"","                    SELECT timestamp, severity, signature","                    FROM {latest_alerts}","                    ORDER BY timestamp DESC","                    LIMIT 20","                \"\"\")","                threat_timeline = [dict(row) for row in cursor.fetchall()]","        except Exception as e:","            print(f\"Threat timeline error: {e}\")","        ","        # === CONNECTION MATRIX (Top sources to destinations) ===","        connection_matrix = []","        try:","            tcpdump_tables = [t for t in all_tables if t.startswith('tcpdump_') and not t.endswith('_template')]","            if tcpdump_tables:","                latest_tcpdump = sorted(tcpdump_tables)[-1]","                cursor.execute(f\"\"\"","                    SELECT src_ip, dest_ip, COUNT(*) as connection_count","                    FROM {latest_tcpdump}","                    WHERE src_ip LIKE '192.168.%' OR dest_ip LIKE '192.168.%'","                    GROUP BY src_ip, dest_ip","                    ORDER BY connection_count DESC","                    LIMIT 15","                \"\"\")","                connection_matrix = [dict(row) for row in cursor.fetchall()]","        except Exception as e:","            print(f\"Connection matrix error: {e}\")","        ","        # === HOURLY ACTIVITY HEATMAP ===","        hourly_activity = {}","        try:","            tcpdump_tables = [t for t in all_tables if t.startswith('tcpdump_') and not t.endswith('_template')]","            if len(tcpdump_tables) > 0:","                # Process last 5 tables","                for table in sorted(tcpdump_tables)[-5:]:","                    try:","                        # Extract hour from timestamp","                        timestamp_str = table.replace('tcpdump_', '')","                        hour = timestamp_str[8:10]  # HHMMSS -> HH","                        cursor.execute(f\"SELECT COUNT(*) as count FROM {table}\")","                        count = cursor.fetchone()['count']","                        if hour not in hourly_activity:","                            hourly_activity[hour] = 0","                        hourly_activity[hour] += count","                    except:","                        pass","        except Exception as e:","            print(f\"Hourly activity error: {e}\")","        "],"tokenizedAddedLines":[1000829,1000830,184,205,1000831,1000832,1000833,1000834,1000835,1000836,1000837,1000838,1000839,1000840,1000841,1000842,1000843,147,1000844,1000845,199,1000846,47,1000847,1000848,184,205,206,207,247,1000849,249,1000850,1000851,1000852,1000853,254,1000854,199,1000855,47,1000856,1000857,184,1000858,1000859,1000860,1000861,247,1000862,1000863,1000864,535,254,1000865,199,1000866,47,1000867,1000868,184,205,206,207,247,1000869,249,1000870,1000871,1000872,1000873,254,1000874,199,1000875,47,1000876,1000877,184,205,1000831,1000878,1000879,1000836,1000880,1000837,1000881,1000882,1000883,1000884,1000885,1000886,1000844,1000845,199,1000887,47]},{"originalStartLineNumberOneIndexed":376,"originalEndLineNumberExclusiveOneIndexed":376,"modifiedStartLineNumberOneIndexed":473,"modifiedEndLineNumberExclusiveOneIndexed":478,"addedLines":["            'bandwidth_timeline': bandwidth_timeline,","            'top_ports': top_ports,","            'threat_timeline': threat_timeline,","            'connection_matrix': connection_matrix,","            'hourly_activity': hourly_activity,"],"tokenizedAddedLines":[1000888,1000889,1000890,1000891,1000892]},{"originalStartLineNumberOneIndexed":398,"originalEndLineNumberExclusiveOneIndexed":398,"modifiedStartLineNumberOneIndexed":500,"modifiedEndLineNumberExclusiveOneIndexed":505,"addedLines":["            'bandwidth_timeline': [],","            'top_ports': [],","            'threat_timeline': [],","            'connection_matrix': [],","            'hourly_activity': {},"],"tokenizedAddedLines":[1000893,1000894,1000895,1000896,1000897]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}