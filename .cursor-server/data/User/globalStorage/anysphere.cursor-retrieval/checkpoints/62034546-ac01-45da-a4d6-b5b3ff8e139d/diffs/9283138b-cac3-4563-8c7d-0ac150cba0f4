{"fsPath":"\\home\\jarvis\\NetGuard\\web\\app.py","fileUuid":"9283138b-cac3-4563-8c7d-0ac150cba0f4","fileSizeBytes":78599,"numLines":2010,"diffChanges":[{"originalStartLineNumberOneIndexed":1231,"originalEndLineNumberExclusiveOneIndexed":1231,"modifiedStartLineNumberOneIndexed":1231,"modifiedEndLineNumberExclusiveOneIndexed":1337,"addedLines":["","@app.route('/api/service-control', methods=['POST'])","def service_control():","    \"\"\"Control systemd services and scripts\"\"\"","    import subprocess","    import os","    import signal","    ","    data = request.get_json()","    service_name = data.get('service_name')","    action = data.get('action')  # start, stop, restart","    service_type = data.get('service_type')  # systemd, script, web, flask","    ","    if not service_name or not action or not service_type:","        return jsonify({'success': False, 'error': 'Missing required parameters'})","    ","    try:","        if service_type == 'systemd':","            # Handle systemd services","            if action == 'start':","                result = subprocess.run(['sudo', 'systemctl', 'start', service_name], ","                                      capture_output=True, text=True, timeout=10)","            elif action == 'stop':","                result = subprocess.run(['sudo', 'systemctl', 'stop', service_name], ","                                      capture_output=True, text=True, timeout=10)","            elif action == 'restart':","                result = subprocess.run(['sudo', 'systemctl', 'restart', service_name], ","                                      capture_output=True, text=True, timeout=10)","            else:","                return jsonify({'success': False, 'error': 'Invalid action for systemd service'})","            ","            if result.returncode == 0:","                return jsonify({'success': True, 'message': f'Service {service_name} {action}ed successfully'})","            else:","                return jsonify({'success': False, 'error': result.stderr or 'Unknown error'})","        ","        elif service_type == 'script':","            # Handle Python scripts","            script_path = f'/home/jarvis/NetGuard/scripts/{service_name}'","            ","            if action == 'start':","                # Start script in background","                result = subprocess.run(['nohup', 'python3', script_path], ","                                      stdout=subprocess.DEVNULL, ","                                      stderr=subprocess.DEVNULL,","                                      cwd='/home/jarvis/NetGuard/scripts')","                return jsonify({'success': True, 'message': f'Script {service_name} started'})","            ","            elif action == 'stop':","                # Kill script by name","                result = subprocess.run(['pkill', '-f', service_name], ","                                      capture_output=True, text=True, timeout=10)","                return jsonify({'success': True, 'message': f'Script {service_name} stopped'})","            ","            else:","                return jsonify({'success': False, 'error': 'Invalid action for script'})","        ","        elif service_type == 'flask':","            # Handle Flask dashboard","            if action == 'start':","                # Start Flask in background","                result = subprocess.run(['nohup', 'python3', 'app.py'], ","                                      stdout=subprocess.DEVNULL, ","                                      stderr=subprocess.DEVNULL,","                                      cwd='/home/jarvis/NetGuard/web')","                return jsonify({'success': True, 'message': 'Flask dashboard started'})","            ","            elif action == 'restart':","                # Kill existing Flask processes and restart","                subprocess.run(['pkill', '-f', 'python3.*app.py'], ","                             capture_output=True, timeout=5)","                import time","                time.sleep(2)","                result = subprocess.run(['nohup', 'python3', 'app.py'], ","                                      stdout=subprocess.DEVNULL, ","                                      stderr=subprocess.DEVNULL,","                                      cwd='/home/jarvis/NetGuard/web')","                return jsonify({'success': True, 'message': 'Flask dashboard restarted'})","            ","            else:","                return jsonify({'success': False, 'error': 'Invalid action for Flask'})","        ","        elif service_type == 'web':","            # Handle other web services","            if action == 'start':","                result = subprocess.run(['sudo', 'systemctl', 'start', service_name], ","                                      capture_output=True, text=True, timeout=10)","            elif action == 'stop':","                result = subprocess.run(['sudo', 'systemctl', 'stop', service_name], ","                                      capture_output=True, text=True, timeout=10)","            else:","                return jsonify({'success': False, 'error': 'Invalid action for web service'})","            ","            if result.returncode == 0:","                return jsonify({'success': True, 'message': f'Web service {service_name} {action}ed successfully'})","            else:","                return jsonify({'success': False, 'error': result.stderr or 'Unknown error'})","        ","        else:","            return jsonify({'success': False, 'error': 'Invalid service type'})","    ","    except subprocess.TimeoutExpired:","        return jsonify({'success': False, 'error': 'Operation timed out'})","    except Exception as e:","        return jsonify({'success': False, 'error': str(e)})",""],"tokenizedAddedLines":[5,1001225,1001226,1001227,899,1025,1001228,342,1001229,1001230,1001231,1001232,342,1001233,1001234,342,34,1001235,1001236,1001237,1001238,1001239,1001240,1001241,1001239,1001242,1001243,1001239,431,1001244,187,1001245,1001246,431,1001247,47,1001248,1001249,1001250,187,1001237,1001251,1001252,1001253,1001254,1001255,1001256,187,1001240,1001257,1001258,1001239,1001259,187,431,1001260,47,1001261,1001262,1001237,1001263,1001264,1001253,1001254,1001265,1001266,187,1001242,1001267,1001268,1001269,1001270,1001271,1001264,1001253,1001254,1001265,1001272,187,431,1001273,47,1001274,1001275,1001237,1001238,1001239,1001240,1001241,1001239,431,1001276,187,1001245,1001277,431,1001247,47,1001278,1001279,342,1001280,1001281,53,1001282,5]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}